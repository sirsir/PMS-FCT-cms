<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Row</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Row</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/models/row_rb.html">
                app/models/row.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ActiveRecord/Base.html">
                ActiveRecord::Base
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000325">before_destroy</a>&nbsp;&nbsp;
      <a href="#M000351">belongs_to?</a>&nbsp;&nbsp;
      <a href="#M000328">cell</a>&nbsp;&nbsp;
      <a href="#M000357">cell_values_by_custom_field_ids</a>&nbsp;&nbsp;
      <a href="#M000310">check_amount</a>&nbsp;&nbsp;
      <a href="#M000322">check_mandatory</a>&nbsp;&nbsp;
      <a href="#M000323">check_unique</a>&nbsp;&nbsp;
      <a href="#M000321">check_value</a>&nbsp;&nbsp;
      <a href="#M000354">dependencies</a>&nbsp;&nbsp;
      <a href="#M000353">dependent</a>&nbsp;&nbsp;
      <a href="#M000355">dependent_row_ids</a>&nbsp;&nbsp;
      <a href="#M000356">dependent_row_ids</a>&nbsp;&nbsp;
      <a href="#M000338">description</a>&nbsp;&nbsp;
      <a href="#M000319">field_cache</a>&nbsp;&nbsp;
      <a href="#M000337">field_description_value</a>&nbsp;&nbsp;
      <a href="#M000313">filter</a>&nbsp;&nbsp;
      <a href="#M000312">filter_by_custom_fields</a>&nbsp;&nbsp;
      <a href="#M000304">filter_by_login</a>&nbsp;&nbsp;
      <a href="#M000309">filter_by_special_search</a>&nbsp;&nbsp;
      <a href="#M000311">find_by_reference_custom_fields</a>&nbsp;&nbsp;
      <a href="#M000331">generate_xml</a>&nbsp;&nbsp;
      <a href="#M000329">get_field_type</a>&nbsp;&nbsp;
      <a href="#M000330">get_image_name</a>&nbsp;&nbsp;
      <a href="#M000315">human_attribute_name</a>&nbsp;&nbsp;
      <a href="#M000327">load_cell_hash</a>&nbsp;&nbsp;
      <a href="#M000316">missing_msg</a>&nbsp;&nbsp;
      <a href="#M000317">operation_url_options</a>&nbsp;&nbsp;
      <a href="#M000350">option_combined_cell</a>&nbsp;&nbsp;
      <a href="#M000347">option_combined_row</a>&nbsp;&nbsp;
      <a href="#M000346">option_combined_row_id</a>&nbsp;&nbsp;
      <a href="#M000318">relation_url_options</a>&nbsp;&nbsp;
      <a href="#M000352">relations</a>&nbsp;&nbsp;
      <a href="#M000306">reorder_field_sorting</a>&nbsp;&nbsp;
      <a href="#M000336">retrieve_checkbox_result</a>&nbsp;&nbsp;
      <a href="#M000335">retrieve_multi_result</a>&nbsp;&nbsp;
      <a href="#M000334">retrieve_nonmulti_result</a>&nbsp;&nbsp;
      <a href="#M000305">rows_by_page</a>&nbsp;&nbsp;
      <a href="#M000314">save</a>&nbsp;&nbsp;
      <a href="#M000349">screen_combined_cell</a>&nbsp;&nbsp;
      <a href="#M000339">screen_combined_code</a>&nbsp;&nbsp;
      <a href="#M000344">screen_combined_option_screen_ids</a>&nbsp;&nbsp;
      <a href="#M000345">screen_combined_option_screens</a>&nbsp;&nbsp;
      <a href="#M000343">screen_combined_screen_group</a>&nbsp;&nbsp;
      <a href="#M000341">screen_combined_screen_group_ids</a>&nbsp;&nbsp;
      <a href="#M000340">screen_combined_screen_ids</a>&nbsp;&nbsp;
      <a href="#M000342">screen_combined_screens</a>&nbsp;&nbsp;
      <a href="#M000348">screen_combined_values</a>&nbsp;&nbsp;
      <a href="#M000358">select_multiple_counter_from_descr</a>&nbsp;&nbsp;
      <a href="#M000308">sort</a>&nbsp;&nbsp;
      <a href="#M000307">sorting_order</a>&nbsp;&nbsp;
      <a href="#M000320">updated_at</a>&nbsp;&nbsp;
      <a href="#M000326">used_by?</a>&nbsp;&nbsp;
      <a href="#M000324">validate</a>&nbsp;&nbsp;
      <a href="#M000332">valuecheck</a>&nbsp;&nbsp;
      <a href="#M000333">valuecheck2</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">check_mandatory</td>
          <td class="context-item-value">&nbsp;[W]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">check_unique</td>
          <td class="context-item-value">&nbsp;[W]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">check_value</td>
          <td class="context-item-value">&nbsp;[W]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000310" class="method-detail">
        <a name="M000310"></a>

        <div class="method-heading">
          <a href="#M000310" class="method-signature">
          <span class="method-name">check_amount</span><span class="method-args">(amount,from,to)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000310-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000310-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 306</span>
306:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_amount</span>(<span class="ruby-identifier">amount</span>,<span class="ruby-identifier">from</span>,<span class="ruby-identifier">to</span>)
307:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">from</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">to</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>)
308:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">amount</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">from</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">to</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>)
309:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">amount</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">to</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">from</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>)
310:       <span class="ruby-keyword kw">return</span> (<span class="ruby-identifier">amount</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">from</span>.<span class="ruby-identifier">to_f</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">amount</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">to</span>.<span class="ruby-identifier">to_f</span>)
311:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000313" class="method-detail">
        <a name="M000313"></a>

        <div class="method-heading">
          <a href="#M000313" class="method-signature">
          <span class="method-name">filter</span><span class="method-args">(screen_id, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
defaults = {
</p>
<pre>
 :custom_fields =&gt; {},
 :action_source =&gt; &quot;index&quot;,
 :include_other_user =&gt; true,
 :row_ids =&gt; [],
 :sort_results =&gt; true,
 :include_updated_at_filter =&gt; true,
 :updated_since =&gt; Date.null_date,
 :updated_until =&gt; Time.now.end_of_day
</pre>
<p>
}
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000313-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000313-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 362</span>
362:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filter</span>(<span class="ruby-identifier">screen_id</span>, <span class="ruby-identifier">options</span> = {})
363:       <span class="ruby-identifier">defaults</span> = {
364:         <span class="ruby-identifier">:custom_fields</span> =<span class="ruby-operator">&gt;</span> {},
365:         <span class="ruby-identifier">:action_source</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;index&quot;</span>,
366:         <span class="ruby-identifier">:include_other_user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,
367:         <span class="ruby-identifier">:row_ids</span> =<span class="ruby-operator">&gt;</span> [],
368:         <span class="ruby-identifier">:sort_results</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,
369:         <span class="ruby-identifier">:include_updated_at_filter</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,
370:         <span class="ruby-identifier">:updated_since</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">null_date</span>.<span class="ruby-identifier">beginning_of_day</span>,
371:         <span class="ruby-identifier">:updated_until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">end_of_day</span>
372:       }
373:       
374:       <span class="ruby-identifier">options</span> = <span class="ruby-identifier">defaults</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
375: 
376:       <span class="ruby-identifier">screen_id</span> = <span class="ruby-identifier">screen_id</span>.<span class="ruby-identifier">to_i</span>
377:       
378:       <span class="ruby-identifier">screen</span> = <span class="ruby-constant">Screen</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">screen_id</span>)
379: 
380:       <span class="ruby-identifier">result</span> = {
381:         <span class="ruby-identifier">:filtered_row_ids</span> =<span class="ruby-operator">&gt;</span> [],
382:         <span class="ruby-identifier">:sort_field_id_order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">default_sort_field_id_order</span>
383:       }
384:       
385:       <span class="ruby-identifier">conditions</span> = {
386:         <span class="ruby-identifier">:rows</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:screen_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">screen_id</span> },
387:         <span class="ruby-identifier">:cells</span> =<span class="ruby-operator">&gt;</span> {}
388:       }
389: 
390:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">HeaderScreen</span>)
391:         <span class="ruby-identifier">header_custom_field_ids</span> = <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field_id</span> }
392: 
393:         <span class="ruby-identifier">revision_options</span> = {
394:           <span class="ruby-identifier">:custom_fields</span> =<span class="ruby-operator">&gt;</span> {},
395:           <span class="ruby-identifier">:action_source</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:action_source</span>],
396:           <span class="ruby-identifier">:include_other_user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:include_other_user</span>],
397:           <span class="ruby-identifier">:row_ids</span> =<span class="ruby-operator">&gt;</span> [],
398:           <span class="ruby-identifier">:sort_results</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>,
399:           <span class="ruby-identifier">:include_updated_at_filter</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:include_updated_at_filter</span>],
400:           <span class="ruby-identifier">:updated_since</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:updated_since</span>],
401:           <span class="ruby-identifier">:updated_until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:updated_until</span>]
402:         }
403: 
404:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>].<span class="ruby-identifier">each_key</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
405:           <span class="ruby-identifier">revision_options</span>[<span class="ruby-identifier">:custom_fields</span>][<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>].<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">k</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">header_custom_field_ids</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span>)
406:         <span class="ruby-keyword kw">end</span>
407:         
408:         <span class="ruby-identifier">revision_row_ids</span> = <span class="ruby-identifier">filter</span>(<span class="ruby-identifier">screen</span>.<span class="ruby-identifier">revision_screen_id</span>, <span class="ruby-identifier">revision_options</span>)[<span class="ruby-identifier">:filtered_row_ids</span>]
409:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:row_ids</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">revision_screen</span>.<span class="ruby-identifier">rows</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
410:           <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;row_id, type&quot;</span>,
411:           <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;row_id, type&quot;</span>,
412:           <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {
413:             <span class="ruby-identifier">:rows</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">revision_row_ids</span> }
414:           }
415:         ).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">rr</span><span class="ruby-operator">|</span> <span class="ruby-identifier">rr</span>.<span class="ruby-identifier">header_row_id</span> }
416:       <span class="ruby-keyword kw">end</span>
417:       
418:       <span class="ruby-identifier">conditions</span>[<span class="ruby-identifier">:cells</span>][<span class="ruby-identifier">:row_id</span>] = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:row_ids</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:row_ids</span>].<span class="ruby-identifier">empty?</span>
419: 
420:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:action_source</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;relations&quot;</span>
421:         <span class="ruby-identifier">row_ids</span> = []
422:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
423:           <span class="ruby-identifier">custom_field_id</span> = <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span>
424:           <span class="ruby-identifier">ref_row_id</span> = <span class="ruby-identifier">v</span>[<span class="ruby-value str">'row_id'</span>].<span class="ruby-identifier">to_i</span>
425: 
426:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field_id</span> }.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">custom_field_id</span>)
427: 
428:           <span class="ruby-identifier">conditions</span>[<span class="ruby-identifier">:cells</span>][<span class="ruby-identifier">:field_id</span>] = <span class="ruby-identifier">custom_field_id</span>
429:           <span class="ruby-identifier">cells</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:row</span>], <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">conditions</span> )
430: 
431:           <span class="ruby-comment cmt"># ToDo: Need to change the filtering for relation</span>
432:           <span class="ruby-comment cmt"># to not use the cell value directly</span>
433:           <span class="ruby-identifier">cells</span> = <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>.<span class="ruby-identifier">cell_ref_row_id</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">ref_row_id</span> }
434:           
435:           <span class="ruby-identifier">row_ids</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">row_id</span> }
436:         <span class="ruby-keyword kw">end</span>
437: 
438:         <span class="ruby-identifier">result</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">:filtered_row_ids</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">row_ids</span>.<span class="ruby-identifier">uniq</span>)
439:       <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt">#Action Source = Search</span>
440:         <span class="ruby-comment cmt">#~ Trigger false query when required_search? is set, but no value passed</span>
441:         <span class="ruby-identifier">required_searchs</span> = {}
442:         <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
443:           <span class="ruby-identifier">required_searchs</span>[<span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field_id</span>.<span class="ruby-identifier">to_s</span>] = <span class="ruby-value str">&quot;-1&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">required_search?</span>
444:         <span class="ruby-keyword kw">end</span>
445:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>] = <span class="ruby-identifier">required_searchs</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>])
446:         
447:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>].<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span> }
448:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>].<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cf_id</span>,<span class="ruby-identifier">cf_value</span><span class="ruby-operator">|</span>
449:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cf_value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
450:             <span class="ruby-identifier">cf_value</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'-1'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cf_value</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value str">'-1'</span>)
451:             
452:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cf_value</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value str">'selected_ids'</span>)
453:               <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'selected_ids'</span>].<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'-1'</span>)
454:               <span class="ruby-identifier">cf_value</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'selected_ids'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'selected_ids'</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
455:             <span class="ruby-keyword kw">end</span>
456: 
457:             <span class="ruby-identifier">cf_value</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'selected_date'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'selected_date'</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
458:             
459:             <span class="ruby-identifier">cf_hash_size</span> = <span class="ruby-identifier">cf_value</span>.<span class="ruby-identifier">size</span>
460:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cf_value</span>.<span class="ruby-identifier">empty?</span>
461:               <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>].<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">cf_id</span>)
462:             <span class="ruby-keyword kw">elsif</span> (<span class="ruby-identifier">cf_hash_size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">cf_hash_size</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span>) <span class="ruby-comment cmt"># Number or Date time(status = set)</span>
463:               <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>].<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">cf_id</span>) <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'from'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'to'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>)
464:             <span class="ruby-keyword kw">elsif</span> (<span class="ruby-identifier">cf_hash_size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>) <span class="ruby-comment cmt"># reference</span>
465:               <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>].<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">cf_id</span>) <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'row_id'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>)
466:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">cf_hash_size</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">6</span> <span class="ruby-comment cmt"># Issue Tracking</span>
467:               <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>].<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">cf_id</span>) <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Dued_date_to'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Dued_date_from'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Completed_date_to'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Completed_date_from'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Created_date_to'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Created_date_from'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span>
468:                   <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Completed'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Scheduled'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Delayed'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Cancelled'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Re-Scheduled'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Dued'</span>].<span class="ruby-identifier">nil?</span> )
469:             <span class="ruby-keyword kw">end</span>
470:           <span class="ruby-keyword kw">end</span>
471:         <span class="ruby-keyword kw">end</span>
472: 
473:         <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>].<span class="ruby-identifier">empty?</span>
474:           <span class="ruby-identifier">row_pattern_id</span> = <span class="ruby-keyword kw">nil</span>
475:           
476:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">include_required_search?</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>])
477:             <span class="ruby-identifier">ht_custom_field</span> = {}
478:             <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>].<span class="ruby-identifier">each_key</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
479:               <span class="ruby-identifier">ht_custom_field</span>[<span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span>] = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span>)
480:             <span class="ruby-keyword kw">end</span>
481:             
482:             <span class="ruby-identifier">conditions</span>[<span class="ruby-identifier">:cells</span>][<span class="ruby-identifier">:field_id</span>] = <span class="ruby-identifier">ht_custom_field</span>.<span class="ruby-identifier">keys</span>
483:             <span class="ruby-identifier">conditions</span>[<span class="ruby-identifier">:cells</span>][<span class="ruby-identifier">:updated_at</span>] = (<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:updated_since</span>].<span class="ruby-identifier">to_time</span><span class="ruby-operator">..</span><span class="ruby-identifier">options</span>[<span class="ruby-identifier">:updated_until</span>].<span class="ruby-identifier">to_time</span>)
484:             <span class="ruby-identifier">row_id_hits</span> = {}
485:             
486:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:row_ids</span>].<span class="ruby-identifier">empty?</span>
487:               <span class="ruby-identifier">cells</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:row</span>], <span class="ruby-identifier">:conditions</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">conditions</span>)
488:             <span class="ruby-keyword kw">else</span>
489:               <span class="ruby-identifier">cells</span> = []
490:               <span class="ruby-identifier">block</span> = <span class="ruby-value">100</span>
491:               <span class="ruby-identifier">n</span> = <span class="ruby-value">0</span>
492: 
493:               <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:row_ids</span>][<span class="ruby-identifier">n</span><span class="ruby-operator">..</span>(<span class="ruby-identifier">n</span><span class="ruby-operator">+</span><span class="ruby-identifier">block</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>)].<span class="ruby-identifier">nil?</span>
494:                 <span class="ruby-identifier">conditions</span>[<span class="ruby-identifier">:rows</span>][<span class="ruby-identifier">:id</span>] = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:row_ids</span>][<span class="ruby-identifier">n</span><span class="ruby-operator">..</span>(<span class="ruby-identifier">n</span><span class="ruby-operator">+</span><span class="ruby-identifier">block</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>)]
495:                 
496:                 <span class="ruby-identifier">cells</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:row</span>], <span class="ruby-identifier">:conditions</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">conditions</span>)
497:                 
498:                 <span class="ruby-identifier">n</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">block</span>
499:               <span class="ruby-keyword kw">end</span>
500:             <span class="ruby-keyword kw">end</span>
501: 
502:             <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
503:               <span class="ruby-identifier">row_id_hits</span>[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">row_id</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>
504:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ht_custom_field</span>[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">custom_field_id</span>].<span class="ruby-identifier">search_value?</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">field</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">DateTimeRange</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>][<span class="ruby-identifier">c</span>.<span class="ruby-identifier">custom_field_id</span>.<span class="ruby-identifier">to_s</span>])
505:                 <span class="ruby-identifier">row_id_hits</span>[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">row_id</span>] <span class="ruby-operator">+=</span><span class="ruby-value">1</span>
506:               <span class="ruby-keyword kw">end</span>
507:             }
508: 
509:             <span class="ruby-identifier">filtered_row_ids</span> = <span class="ruby-identifier">row_id_hits</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>].<span class="ruby-identifier">length</span>}.<span class="ruby-identifier">compact</span>
510:             
511:             <span class="ruby-identifier">user_row_id</span> = <span class="ruby-constant">ApplicationController</span>.<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">usage</span>[<span class="ruby-identifier">:row_id</span>]
512:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:include_other_user</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">user_row_id</span>.<span class="ruby-identifier">nil?</span>
513:               <span class="ruby-identifier">sample_row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:rows</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filtered_row_ids</span> } } )
514:               <span class="ruby-identifier">filtered_row_ids</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">filter_by_login</span>(<span class="ruby-identifier">filtered_row_ids</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sample_row</span>.<span class="ruby-identifier">nil?</span>
515:             <span class="ruby-keyword kw">end</span>
516:             
517:             <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
518:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ht_custom_field</span>[<span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">OptionCombindedReference</span>)
519:                 <span class="ruby-identifier">row_pattern_id</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_i</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
520:                 <span class="ruby-keyword kw">break</span>
521:               <span class="ruby-keyword kw">end</span>
522:             <span class="ruby-keyword kw">end</span>
523:           <span class="ruby-keyword kw">end</span>
524: 
525:           <span class="ruby-identifier">result</span>.<span class="ruby-identifier">update</span>( <span class="ruby-identifier">:filtered_row_ids</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filtered_row_ids</span>, <span class="ruby-identifier">:row_pattern_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">row_pattern_id</span> )
526:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:custom_fields</span>].<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">HeaderScreen</span>)
527:           <span class="ruby-identifier">result</span>.<span class="ruby-identifier">update</span>( <span class="ruby-identifier">:filtered_row_ids</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:row_ids</span>] )
528:         <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt">#CustomField Empty =&gt; Show All Data</span>
529:           <span class="ruby-identifier">filtered_row_ids</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:row_ids</span>].<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span><span class="ruby-identifier">screen</span>.<span class="ruby-identifier">row_ids</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:row_ids</span>]
530: 
531:           <span class="ruby-comment cmt"># For screens with large amount of data, display only the rows</span>
532:           <span class="ruby-comment cmt"># updated in the late n months</span>
533:           <span class="ruby-comment cmt"># The term 'large' is now fixed to more than 1,000 records</span>
534:           <span class="ruby-identifier">updated_since</span> = [<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">index_default_updated_at_filter</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:updated_since</span>]].<span class="ruby-identifier">max</span>
535:           <span class="ruby-identifier">filtered_row_ids</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
536:             <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:id</span>],
537:             <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {
538:               <span class="ruby-identifier">:rows</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filtered_row_ids</span>, <span class="ruby-identifier">:updated_at</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">updated_since</span>.<span class="ruby-identifier">to_time</span><span class="ruby-operator">..</span><span class="ruby-identifier">options</span>[<span class="ruby-identifier">:updated_until</span>]) }
539:             }
540:           ).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">id</span>} <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:include_updated_at_filter</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">filtered_row_ids</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1000</span>
541: 
542:           <span class="ruby-identifier">user_row_id</span> = <span class="ruby-constant">ApplicationController</span>.<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">usage</span>[<span class="ruby-identifier">:row_id</span>]
543:           <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:include_other_user</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">user_row_id</span>.<span class="ruby-identifier">nil?</span>
544:             <span class="ruby-identifier">sample_row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:rows</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filtered_row_ids</span> } } )
545:             <span class="ruby-identifier">filtered_row_ids</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">filter_by_login</span>(<span class="ruby-identifier">filtered_row_ids</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sample_row</span>.<span class="ruby-identifier">nil?</span>
546:           <span class="ruby-keyword kw">end</span>
547:           
548:           <span class="ruby-identifier">result</span>.<span class="ruby-identifier">update</span>( <span class="ruby-identifier">:filtered_row_ids</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filtered_row_ids</span> )
549:         <span class="ruby-keyword kw">end</span>
550:       <span class="ruby-keyword kw">end</span>
551: 
552:       <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:filtered_row_ids</span>] = <span class="ruby-identifier">sort</span>(<span class="ruby-identifier">result</span>[<span class="ruby-identifier">:filtered_row_ids</span>], <span class="ruby-identifier">result</span>[<span class="ruby-identifier">:sort_field_id_order</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:sort_results</span>]
553: 
554:       <span class="ruby-identifier">result</span>
555:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000312" class="method-detail">
        <a name="M000312"></a>

        <div class="method-heading">
          <a href="#M000312" class="method-signature">
          <span class="method-name">filter_by_custom_fields</span><span class="method-args">(screen_id, custom_fields, action_source, include_other_user, row_ids = [], sort_results = true)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000312-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000312-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 342</span>
342:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filter_by_custom_fields</span>(<span class="ruby-identifier">screen_id</span>, <span class="ruby-identifier">custom_fields</span>, <span class="ruby-identifier">action_source</span>, <span class="ruby-identifier">include_other_user</span>, <span class="ruby-identifier">row_ids</span> = [], <span class="ruby-identifier">sort_results</span> = <span class="ruby-keyword kw">true</span>)
343:       <span class="ruby-identifier">filter</span>(<span class="ruby-identifier">screen_id</span>,
344:         <span class="ruby-identifier">:custom_fields</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">custom_fields</span>,
345:         <span class="ruby-identifier">:action_source</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">action_source</span>,
346:         <span class="ruby-identifier">:include_other_user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">include_other_user</span>,
347:         <span class="ruby-identifier">:row_ids</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">row_ids</span>,
348:         <span class="ruby-identifier">:sort_results</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sort_results</span>
349:       )
350:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000304" class="method-detail">
        <a name="M000304"></a>

        <div class="method-heading">
          <a href="#M000304" class="method-signature">
          <span class="method-name">filter_by_login</span><span class="method-args">(rows)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000304-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000304-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/row.rb, line 14</span>
14:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filter_by_login</span>(<span class="ruby-identifier">rows</span>)
15:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">first</span>
16:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Fixnum</span>
17:         <span class="ruby-identifier">screen</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">rows</span>.<span class="ruby-identifier">first</span>).<span class="ruby-identifier">screen</span>
18:         <span class="ruby-identifier">user_row_id</span> = <span class="ruby-constant">ApplicationController</span>.<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">usage</span>[<span class="ruby-identifier">:row_id</span>]
19:         <span class="ruby-identifier">row_ids</span> = <span class="ruby-identifier">rows</span>
20:         <span class="ruby-identifier">filtered_row_ids</span> = <span class="ruby-identifier">row_ids</span>
21:         
22:         <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
23:           <span class="ruby-comment cmt"># ToDo: Find the Login reference field</span>
24:           <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Hard coded CustomField name 'Salesman_REF'&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">RAILS_ENV</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/susbkk/</span>
25: 
26:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fields</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Salesman_REF&quot;</span>
27:             <span class="ruby-identifier">cells</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
28:               <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {
29:                 <span class="ruby-identifier">:cells</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:row_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">row_ids</span>, <span class="ruby-identifier">:field_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">custom_field_id</span> }
30:               })
31:             <span class="ruby-identifier">filtered_row_ids</span> = <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">row_id</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>.<span class="ruby-identifier">cell_ref_row_id</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">user_row_id</span> }.<span class="ruby-identifier">compact</span>
32:           <span class="ruby-keyword kw">end</span>
33:         <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">ApplicationController</span>.<span class="ruby-identifier">admin_mode?</span>
34:         
35:         <span class="ruby-identifier">filtered_rows</span> = <span class="ruby-identifier">filtered_row_ids</span>
36:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Row</span>
37:         <span class="ruby-identifier">row_ids</span> = <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">id</span> }
38:         <span class="ruby-identifier">filtered_row_ids</span> = <span class="ruby-identifier">filter_by_login</span>(<span class="ruby-identifier">row_ids</span>)
39:         
40:         <span class="ruby-identifier">filtered_rows</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">filtered_row_ids</span>)
41:       <span class="ruby-keyword kw">else</span>
42:         <span class="ruby-identifier">filtered_rows</span> = []
43:       <span class="ruby-keyword kw">end</span>
44:       
45:       <span class="ruby-identifier">filtered_rows</span>
46:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000309" class="method-detail">
        <a name="M000309"></a>

        <div class="method-heading">
          <a href="#M000309" class="method-signature">
          <span class="method-name">filter_by_special_search</span><span class="method-args">(screen,custom_fields,filter_by_total_amount)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000309-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000309-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 162</span>
162:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filter_by_special_search</span>(<span class="ruby-identifier">screen</span>,<span class="ruby-identifier">custom_fields</span>,<span class="ruby-identifier">filter_by_total_amount</span>)
163:       <span class="ruby-comment cmt"># ToDo: Move this code to a client base code</span>
164:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Hard coded CustomField name 'Invoice Amount'&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">RAILS_ENV</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/susbkk/</span>
165:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Hard coded CustomField name 'PO Amount'&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">RAILS_ENV</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/susbkk/</span>
166:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Hard coded CustomField name 'Quotation Amount'&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">RAILS_ENV</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/susbkk/</span>
167:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Hard coded CustomField name 'Delivery Amount'&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">RAILS_ENV</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/susbkk/</span>
168:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Hard coded CustomField name 'Payment Amount'&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">RAILS_ENV</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/susbkk/</span>
169:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Hard coded CustomField name 'Customer_REF'&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">RAILS_ENV</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/susbkk/</span>
170:     
171:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">filter_by_total_amount</span> <span class="ruby-comment cmt"># Business Record</span>
172:         <span class="ruby-identifier">total_amount_filters</span> = {}
173:         <span class="ruby-identifier">total_amount_values</span> = {}
174:         <span class="ruby-identifier">invoice_amount_custom_field_id</span> = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;name = ?&quot;</span>, <span class="ruby-value str">&quot;Invoice Amount&quot;</span>]).<span class="ruby-identifier">id</span>
175:         <span class="ruby-identifier">po_amount_custom_field_id</span> = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;name = ?&quot;</span>, <span class="ruby-value str">&quot;PO Amount&quot;</span>]).<span class="ruby-identifier">id</span>
176:         <span class="ruby-identifier">quataion_amount_custom_field_id</span> = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;name = ?&quot;</span>, <span class="ruby-value str">&quot;Quotation Amount&quot;</span>]).<span class="ruby-identifier">id</span>
177:         <span class="ruby-identifier">delivery_amount_custom_field_id</span> = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;name = ?&quot;</span>, <span class="ruby-value str">&quot;Delivery Amount&quot;</span>]).<span class="ruby-identifier">id</span>
178:         <span class="ruby-identifier">payment_amount_custom_field_id</span> = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;name = ?&quot;</span>, <span class="ruby-value str">&quot;Payment Amount&quot;</span>]).<span class="ruby-identifier">id</span>
179:       <span class="ruby-keyword kw">end</span>
180: 
181:       <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span> }
182:       <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cf_id</span>,<span class="ruby-identifier">cf_value</span><span class="ruby-operator">|</span>
183:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cf_value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">HashWithIndifferentAccess</span>)
184:           <span class="ruby-identifier">cf_hash_size</span> = <span class="ruby-identifier">cf_value</span>.<span class="ruby-identifier">size</span>
185:           <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">cf_hash_size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">cf_hash_size</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span>)<span class="ruby-comment cmt"># Number or Date time(status = set)</span>
186:             <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'from'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'to'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>)
187:               <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">cf_id</span>)
188:               <span class="ruby-comment cmt"># Filtering all of the amount filtering to store in variable</span>
189:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">filter_by_total_amount</span> <span class="ruby-comment cmt"># Business Record</span>
190:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">invoice_amount_custom_field_id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">cf_id</span>
191:                 <span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-value str">'invoice'</span>] = {}
192:                 <span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-value str">'invoice'</span>][<span class="ruby-value str">'filter_value'</span>] = <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">cf_id</span>)
193:                 <span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-value str">'invoice'</span>][<span class="ruby-value str">'cf_id'</span>] = <span class="ruby-identifier">cf_id</span>
194:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">po_amount_custom_field_id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">cf_id</span>
195:                 <span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-value str">'po'</span>] = {}
196:                 <span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-value str">'po'</span>][<span class="ruby-value str">'filter_value'</span>] = <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">cf_id</span>)
197:                 <span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-value str">'po'</span>][<span class="ruby-value str">'cf_id'</span>] = <span class="ruby-identifier">cf_id</span>
198:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">quataion_amount_custom_field_id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">cf_id</span>
199:                 <span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-value str">'quataion'</span>] = {}
200:                 <span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-value str">'quataion'</span>][<span class="ruby-value str">'filter_value'</span>] = <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">cf_id</span>)
201:                 <span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-value str">'quataion'</span>][<span class="ruby-value str">'cf_id'</span>] = <span class="ruby-identifier">cf_id</span>
202:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">delivery_amount_custom_field_id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">cf_id</span>
203:                 <span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-value str">'delivery'</span>] = {}
204:                 <span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-value str">'delivery'</span>][<span class="ruby-value str">'filter_value'</span>] = <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">cf_id</span>)
205:                 <span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-value str">'delivery'</span>][<span class="ruby-value str">'cf_id'</span>] = <span class="ruby-identifier">cf_id</span>
206:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">payment_amount_custom_field_id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">cf_id</span>
207:                 <span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-value str">'payment'</span>] = {}
208:                 <span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-value str">'payment'</span>][<span class="ruby-value str">'filter_value'</span>] = <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">cf_id</span>)
209:                 <span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-value str">'payment'</span>][<span class="ruby-value str">'cf_id'</span>] = <span class="ruby-identifier">cf_id</span>
210:               <span class="ruby-keyword kw">end</span>
211:             <span class="ruby-keyword kw">end</span>
212: 
213:           <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># Issue Tracking</span>
214:             <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">cf_id</span>) <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Dued_date_to'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Dued_date_from'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Completed_date_to'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Completed_date_from'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Created_date_to'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Created_date_from'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span>
215:                 <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Completed'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Scheduled'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Delayed'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Cancelled'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Re-Scheduled'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cf_value</span>[<span class="ruby-value str">'Dued'</span>].<span class="ruby-identifier">nil?</span> )
216:           <span class="ruby-keyword kw">end</span>
217:         <span class="ruby-keyword kw">end</span>
218:       <span class="ruby-keyword kw">end</span>
219: 
220:       <span class="ruby-identifier">customer_custom_field_id</span> = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions</span>  =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;name = ? &quot;</span>, <span class="ruby-value str">&quot;Customer_REF&quot;</span>]).<span class="ruby-identifier">id</span>
221:       <span class="ruby-identifier">filtered_row_ids</span> = {}
222: 
223:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">empty?</span>
224: 
225:         <span class="ruby-identifier">ht_custom_field</span> = {}
226:         <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">each_key</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
227:           <span class="ruby-identifier">ht_custom_field</span>[<span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span>] = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span>)
228:         <span class="ruby-keyword kw">end</span>
229:         <span class="ruby-identifier">custom_field_ids</span> = <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">collect</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span> }
230:         <span class="ruby-identifier">cells</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
231:           <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:row</span>],
232:           <span class="ruby-identifier">:conditions</span>  =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot; rows.screen_id = ? and cells.field_id in (?) &quot;</span>, <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">custom_field_ids</span>])
233:         <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
234:           <span class="ruby-identifier">filtered_row_ids</span>[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">row_id</span>] <span class="ruby-operator">||=</span><span class="ruby-value">0</span>
235:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ht_custom_field</span>[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">custom_field_id</span>].<span class="ruby-identifier">search_value?</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>, <span class="ruby-identifier">custom_fields</span>[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">custom_field_id</span>.<span class="ruby-identifier">to_s</span>])
236:             <span class="ruby-identifier">filtered_row_ids</span>[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">row_id</span>] <span class="ruby-operator">+=</span><span class="ruby-value">1</span>
237:           <span class="ruby-keyword kw">end</span>
238:         }
239:         <span class="ruby-identifier">filtered_row_ids</span> = <span class="ruby-identifier">filtered_row_ids</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">length</span>}
240:         <span class="ruby-identifier">filtered_row_ids</span>.<span class="ruby-identifier">compact!</span>
241:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Customer&quot;</span>
242:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">filtered_row_ids</span>
243:         <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># Action,Task,Business Record</span>
244:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">filter_by_total_amount</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">total_amount_filters</span>.<span class="ruby-identifier">empty?</span>
245:             <span class="ruby-comment cmt">#find total amount</span>
246:             <span class="ruby-identifier">filtered_rows</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filtered_row_ids</span>})
247:             <span class="ruby-identifier">filtered_rows</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">filtered_row</span><span class="ruby-operator">|</span>
248:               <span class="ruby-identifier">customer_row_id</span> = <span class="ruby-identifier">filtered_row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">customer_custom_field_id</span>).<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">filtered_row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">customer_custom_field_id</span>).<span class="ruby-identifier">value</span>
249:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">customer_row_id</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span>
250:                 <span class="ruby-identifier">total_amount_filters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span>,<span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
251:                   <span class="ruby-identifier">amount</span> = <span class="ruby-identifier">filtered_row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">value</span>[<span class="ruby-value str">'cf_id'</span>]).<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">filtered_row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">value</span>[<span class="ruby-value str">'cf_id'</span>]).<span class="ruby-identifier">value</span>
252:                   <span class="ruby-identifier">total_amount_values</span>[<span class="ruby-identifier">customer_row_id</span>] = {} <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">total_amount_values</span>[<span class="ruby-identifier">customer_row_id</span>].<span class="ruby-identifier">nil?</span>
253:                   <span class="ruby-identifier">total_amount_values</span>[<span class="ruby-identifier">customer_row_id</span>][<span class="ruby-identifier">type</span>] = <span class="ruby-value">0</span><span class="ruby-value">.0</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">total_amount_values</span>[<span class="ruby-identifier">customer_row_id</span>][<span class="ruby-identifier">type</span>].<span class="ruby-identifier">nil?</span>
254:                   <span class="ruby-identifier">total_amount_values</span>[<span class="ruby-identifier">customer_row_id</span>][<span class="ruby-identifier">type</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">amount</span>.<span class="ruby-identifier">to_f</span>
255:                 <span class="ruby-keyword kw">end</span>
256:               <span class="ruby-keyword kw">end</span>
257:             <span class="ruby-keyword kw">end</span>
258:             <span class="ruby-comment cmt">#filtering by total amount</span>
259:             <span class="ruby-identifier">filtered_row_ids_by_total_amount</span> = []
260:             <span class="ruby-identifier">total_amount_values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">customer_id</span>,<span class="ruby-identifier">types</span><span class="ruby-operator">|</span>
261:               <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">true</span>
262:               <span class="ruby-identifier">types</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span>,<span class="ruby-identifier">amount</span><span class="ruby-operator">|</span>
263:                 <span class="ruby-identifier">result</span> = <span class="ruby-identifier">result</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">check_amount</span>(<span class="ruby-identifier">amount</span>,<span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-identifier">type</span>][<span class="ruby-value str">'filter_value'</span>][<span class="ruby-value str">'from'</span>],<span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-identifier">type</span>][<span class="ruby-value str">'filter_value'</span>][<span class="ruby-value str">'to'</span>])
264:                 <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">result</span>
265:               <span class="ruby-keyword kw">end</span>
266:               <span class="ruby-identifier">filtered_row_ids_by_total_amount</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">customer_id</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">result</span>
267:             <span class="ruby-keyword kw">end</span>
268:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">filtered_row_ids_by_total_amount</span>
269:           <span class="ruby-keyword kw">else</span>
270:             <span class="ruby-identifier">cust_row_cells</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:row_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filtered_row_ids</span>, <span class="ruby-identifier">:field_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">customer_custom_field_id</span>})
271:             <span class="ruby-identifier">filtered_row_ids</span>.<span class="ruby-identifier">clear</span>
272:             <span class="ruby-identifier">cust_row_cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
273:               <span class="ruby-identifier">filtered_row_ids</span> = <span class="ruby-identifier">filtered_row_ids</span> <span class="ruby-operator">|</span> [<span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_i</span>]
274:             <span class="ruby-keyword kw">end</span>
275:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">filtered_row_ids</span>
276:           <span class="ruby-keyword kw">end</span>
277:         <span class="ruby-keyword kw">end</span>
278:       <span class="ruby-keyword kw">else</span>
279:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">filter_by_total_amount</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">total_amount_filters</span>.<span class="ruby-identifier">nil?</span>)
280:           <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">rows</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
281:             <span class="ruby-identifier">customer_row_id</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">customer_custom_field_id</span>).<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">customer_custom_field_id</span>).<span class="ruby-identifier">value</span>
282:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">customer_row_id</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span>
283:               <span class="ruby-identifier">total_amount_filters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span>,<span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
284:                 <span class="ruby-identifier">amount</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">value</span>[<span class="ruby-value str">'cf_id'</span>]).<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">value</span>[<span class="ruby-value str">'cf_id'</span>]).<span class="ruby-identifier">value</span>
285:                 <span class="ruby-identifier">total_amount_values</span>[<span class="ruby-identifier">customer_row_id</span>] = {} <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">total_amount_values</span>[<span class="ruby-identifier">customer_row_id</span>].<span class="ruby-identifier">nil?</span>
286:                 <span class="ruby-identifier">total_amount_values</span>[<span class="ruby-identifier">customer_row_id</span>][<span class="ruby-identifier">type</span>] = <span class="ruby-value">0</span><span class="ruby-value">.0</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">total_amount_values</span>[<span class="ruby-identifier">customer_row_id</span>][<span class="ruby-identifier">type</span>].<span class="ruby-identifier">nil?</span>
287:                 <span class="ruby-identifier">total_amount_values</span>[<span class="ruby-identifier">customer_row_id</span>][<span class="ruby-identifier">type</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">amount</span>.<span class="ruby-identifier">to_f</span>
288:               <span class="ruby-keyword kw">end</span>
289:             <span class="ruby-keyword kw">end</span>
290:           <span class="ruby-keyword kw">end</span>
291:           <span class="ruby-identifier">filtered_row_ids_by_total_amount</span> = []
292:           <span class="ruby-identifier">total_amount_values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">customer_id</span>,<span class="ruby-identifier">types</span><span class="ruby-operator">|</span>
293:             <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">true</span>
294:             <span class="ruby-identifier">types</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span>,<span class="ruby-identifier">amount</span><span class="ruby-operator">|</span>
295:               <span class="ruby-identifier">result</span> = <span class="ruby-identifier">result</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">check_amount</span>(<span class="ruby-identifier">amount</span>,<span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-identifier">type</span>][<span class="ruby-value str">'filter_value'</span>][<span class="ruby-value str">'from'</span>],<span class="ruby-identifier">total_amount_filters</span>[<span class="ruby-identifier">type</span>][<span class="ruby-value str">'filter_value'</span>][<span class="ruby-value str">'to'</span>])
296:               <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">result</span>
297:             <span class="ruby-keyword kw">end</span>
298:             <span class="ruby-identifier">filtered_row_ids_by_total_amount</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">customer_id</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">result</span>
299:           <span class="ruby-keyword kw">end</span>
300:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">filtered_row_ids_by_total_amount</span>
301:         <span class="ruby-keyword kw">end</span>
302:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
303:       <span class="ruby-keyword kw">end</span>
304:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000311" class="method-detail">
        <a name="M000311"></a>

        <div class="method-heading">
          <a href="#M000311" class="method-signature">
          <span class="method-name">find_by_reference_custom_fields</span><span class="method-args">(screen_id, related_from_custom_fields)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000311-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000311-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 313</span>
313:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_by_reference_custom_fields</span>(<span class="ruby-identifier">screen_id</span>, <span class="ruby-identifier">related_from_custom_fields</span>)
314:       <span class="ruby-identifier">cells</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
315:         <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:row</span>],
316:         <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:field</span>],
317:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {
318:           <span class="ruby-identifier">:cells</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:field_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">related_from_custom_fields</span>.<span class="ruby-identifier">keys</span> },
319:           <span class="ruby-identifier">:rows</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:screen_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">screen_id</span> }
320:         }
321:       )
322:       
323:       <span class="ruby-identifier">row_id_hits</span> = {}
324: 
325:       <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
326:         <span class="ruby-identifier">row_id_hits</span>[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">row_id</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>
327: 
328:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">field</span>
329:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>
330:           <span class="ruby-identifier">related_from_custom_fields</span>[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">field_id</span>] = [<span class="ruby-identifier">related_from_custom_fields</span>[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">field_id</span>]].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>
331:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">related_from_custom_fields</span>[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">field_id</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>.<span class="ruby-identifier">cell_ref_row_id</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>))
332:             <span class="ruby-identifier">row_id_hits</span>[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">row_id</span>] <span class="ruby-operator">+=</span><span class="ruby-value">1</span>
333:           <span class="ruby-keyword kw">end</span>
334:         <span class="ruby-keyword kw">end</span>
335:       <span class="ruby-keyword kw">end</span>
336: 
337:       <span class="ruby-identifier">row_ids</span> = <span class="ruby-identifier">row_id_hits</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">related_from_custom_fields</span>.<span class="ruby-identifier">size</span> }.<span class="ruby-identifier">compact</span>
338: 
339:       <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">row_ids</span>)
340:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000315" class="method-detail">
        <a name="M000315"></a>

        <div class="method-heading">
          <a href="#M000315" class="method-signature">
          <span class="method-name">human_attribute_name</span><span class="method-args">(attr)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000315-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000315-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 626</span>
626:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">human_attribute_name</span>(<span class="ruby-identifier">attr</span>)
627:       <span class="ruby-identifier">attr</span>.<span class="ruby-identifier">titleize</span>
628:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000316" class="method-detail">
        <a name="M000316"></a>

        <div class="method-heading">
          <a href="#M000316" class="method-signature">
          <span class="method-name">missing_msg</span><span class="method-args">(row_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000316-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000316-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 630</span>
630:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">missing_msg</span>(<span class="ruby-identifier">row_id</span>)
631:       <span class="ruby-node">&quot;&lt;span class='error_message'&gt;Row with ID=#{row_id} is missing!&lt;/span&gt;&quot;</span>
632:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000306" class="method-detail">
        <a name="M000306"></a>

        <div class="method-heading">
          <a href="#M000306" class="method-signature">
          <span class="method-name">reorder_field_sorting</span><span class="method-args">(sort_field_id_order, new_field_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000306-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000306-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/row.rb, line 73</span>
73:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reorder_field_sorting</span>(<span class="ruby-identifier">sort_field_id_order</span>, <span class="ruby-identifier">new_field_id</span>)
74:       <span class="ruby-identifier">sort_field_id_order</span> <span class="ruby-operator">||=</span> []
75:       <span class="ruby-identifier">sort_field_id_order</span>.<span class="ruby-identifier">collect!</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f_id</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f_id</span>.<span class="ruby-identifier">to_i</span> }
76:       
77:       <span class="ruby-identifier">first_field_id</span> = <span class="ruby-identifier">sort_field_id_order</span>.<span class="ruby-identifier">first</span>
78: 
79:       <span class="ruby-identifier">field_ids</span> = ([<span class="ruby-identifier">new_field_id</span>.<span class="ruby-identifier">to_i</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">sort_field_id_order</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f_id</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f_id</span>.<span class="ruby-identifier">abs</span>}).<span class="ruby-identifier">uniq</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">2</span>]
80: 
81:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field_ids</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">first_field_id</span>.<span class="ruby-identifier">abs</span>
82:         <span class="ruby-identifier">field_ids</span>[<span class="ruby-value">0</span>] = <span class="ruby-operator">-</span><span class="ruby-identifier">first_field_id</span>
83:       <span class="ruby-keyword kw">end</span>
84: 
85:       <span class="ruby-identifier">field_ids</span>
86:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000305" class="method-detail">
        <a name="M000305"></a>

        <div class="method-heading">
          <a href="#M000305" class="method-signature">
          <span class="method-name">rows_by_page</span><span class="method-args">(rows, pageno, rpp)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
def rows_order_by_customfield(rows_ids, custom_field_id)
</p>
<pre>
  return [] if rows_ids.empty?
  custom_field = CustomField.find(custom_field_id)
  if custom_field.is_a?(CustomFields::Reference)
    orderby = &quot;Cast(CELLS.value AS UNSIGNED) ASC&quot;
  elsif custom_field.is_a?(CustomFields::DateTimeField)
    orderby = &quot;cast(CELLS.value as datetime) DESC, id&quot;
  elsif custom_field.is_a?(CustomFields::IssueTracking)
    orderby = &quot;cast(substring(CELLS.value,76,10) as datetime) DESC, cast(substring(CELLS.value,105,10) as datetime) DESC,created_at&quot; #&quot;CELLS.value DESC&quot;
  else
    orderby = &quot;cast(substring(CELLS.value,1,255) as varchar(255)) ASC&quot;
  end
  rows = Row.find(:all,
    :joins =&gt; &quot; INNER JOIN CELLS ON CELLS.ROW_ID = ROWS.ID &quot;,
    :conditions  =&gt; [&quot; rows.id in (?) and cells.field_id = ?&quot;, rows_ids, custom_field_id],
    :order =&gt; orderby)
  return rows
</pre>
<p>
end
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000305-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000305-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/row.rb, line 67</span>
67:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rows_by_page</span>(<span class="ruby-identifier">rows</span>, <span class="ruby-identifier">pageno</span>, <span class="ruby-identifier">rpp</span>)
68:       <span class="ruby-identifier">pageno_from</span> = (<span class="ruby-identifier">rpp</span><span class="ruby-operator">*</span>(<span class="ruby-identifier">pageno</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>))
69:       <span class="ruby-identifier">pageno_to</span> = ((<span class="ruby-identifier">rpp</span><span class="ruby-operator">*</span><span class="ruby-identifier">pageno</span>.<span class="ruby-identifier">to_i</span>)<span class="ruby-operator">-</span><span class="ruby-value">1</span>)
70:       <span class="ruby-identifier">rows</span>[<span class="ruby-identifier">pageno_from</span><span class="ruby-operator">..</span><span class="ruby-identifier">pageno_to</span>]
71:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000314" class="method-detail">
        <a name="M000314"></a>

        <div class="method-heading">
          <a href="#M000314" class="method-signature">
          <span class="method-name">save</span><span class="method-args">(row_or_screen, cell_attributes, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000314-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000314-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 557</span>
557:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save</span>(<span class="ruby-identifier">row_or_screen</span>, <span class="ruby-identifier">cell_attributes</span>, <span class="ruby-identifier">options</span> = {})
558:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">row_or_screen</span>
559:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Screen</span>
560:         <span class="ruby-identifier">defaults</span> = {
561:           <span class="ruby-identifier">:remark</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&quot;</span>,
562:           <span class="ruby-identifier">:check_unique</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
563:         }
564: 
565:         <span class="ruby-identifier">options</span> = <span class="ruby-identifier">defaults</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
566: 
567:         <span class="ruby-identifier">screen</span> = <span class="ruby-identifier">row_or_screen</span>
568:         <span class="ruby-comment cmt">#~ Create a new Province Target, for thins entry</span>
569:         <span class="ruby-identifier">row_model</span> = <span class="ruby-node">&quot;#{screen.prefix}_row&quot;</span>.<span class="ruby-identifier">classify</span>.<span class="ruby-identifier">constantize</span>
570:         <span class="ruby-identifier">row</span> = <span class="ruby-identifier">row_model</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:screen_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:remark</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:remark</span>])
571: 
572:         <span class="ruby-identifier">row</span>.<span class="ruby-identifier">check_unique</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:check_unique</span>]
573: 
574:         <span class="ruby-constant">Row</span>.<span class="ruby-identifier">save</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">cell_attributes</span>, <span class="ruby-identifier">options</span>)
575: 
576:         <span class="ruby-identifier">row</span>
577:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Row</span>
578:         <span class="ruby-identifier">defaults</span> = {
579:           <span class="ruby-identifier">:log_action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&quot;</span>
580:         }
581: 
582:         <span class="ruby-identifier">options</span> = <span class="ruby-identifier">defaults</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
583: 
584:         <span class="ruby-identifier">row</span> = <span class="ruby-identifier">row_or_screen</span>
585: 
586:         <span class="ruby-identifier">cell_attributes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell_attr</span><span class="ruby-operator">|</span>
587:           <span class="ruby-identifier">cell</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">cell_attr</span>[<span class="ruby-identifier">:field_id</span>]) <span class="ruby-operator">||</span> <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">new</span>
588:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">new_record?</span>
589:             <span class="ruby-identifier">row</span>.<span class="ruby-identifier">cells</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cell</span>
590:             <span class="ruby-identifier">row</span>.<span class="ruby-identifier">load_cell_hash</span>(<span class="ruby-identifier">cell</span>)
591:           <span class="ruby-keyword kw">end</span>
592:           <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">cell_attr</span>)
593:         <span class="ruby-keyword kw">end</span>
594: 
595:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
596:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">save</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">all?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span> }
597:             <span class="ruby-identifier">log_values</span> = {}
598: 
599:             <span class="ruby-identifier">cell_attributes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
600:               <span class="ruby-ivar">@@row_save_custom_field_by_id</span> <span class="ruby-operator">||=</span> {}
601:               <span class="ruby-ivar">@@row_save_custom_field_by_id</span>[<span class="ruby-identifier">a</span>[<span class="ruby-identifier">:field_id</span>]] <span class="ruby-operator">||=</span> <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">a</span>[<span class="ruby-identifier">:field_id</span>])
602: 
603:               <span class="ruby-identifier">log_values</span>[<span class="ruby-identifier">a</span>[<span class="ruby-identifier">:field_id</span>]] = <span class="ruby-ivar">@@row_save_custom_field_by_id</span>[<span class="ruby-identifier">a</span>[<span class="ruby-identifier">:field_id</span>]].<span class="ruby-identifier">text</span>(<span class="ruby-identifier">a</span>[<span class="ruby-identifier">:value</span>])
604:             <span class="ruby-keyword kw">end</span>
605: 
606:             <span class="ruby-identifier">row</span>.<span class="ruby-identifier">full_logs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">FullLog</span>.<span class="ruby-identifier">create</span>(
607:               <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:log_action</span>],
608:               <span class="ruby-identifier">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ApplicationController</span>.<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">login</span>,
609:               <span class="ruby-identifier">:seq_no</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
610:               <span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">log_values</span>,
611:               <span class="ruby-identifier">:created_at</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
612:             ) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:log_action</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">empty?</span>
613:           <span class="ruby-keyword kw">else</span>
614:             <span class="ruby-identifier">error_messages</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>
615:             <span class="ruby-identifier">error_messages</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{c.field.name}: #{c.errors.full_messages.to_s}&quot;</span> }
616: 
617:             <span class="ruby-identifier">row</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">clear</span>
618: 
619:             <span class="ruby-identifier">raise</span> <span class="ruby-identifier">error_messages</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
620:           <span class="ruby-keyword kw">end</span>
621:         <span class="ruby-keyword kw">end</span>
622:         
623:       <span class="ruby-keyword kw">end</span>
624:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000308" class="method-detail">
        <a name="M000308"></a>

        <div class="method-heading">
          <a href="#M000308" class="method-signature">
          <span class="method-name">sort</span><span class="method-args">(row_ids, field_ids)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000308-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000308-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 103</span>
103:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sort</span>(<span class="ruby-identifier">row_ids</span>, <span class="ruby-identifier">field_ids</span>)
104:       <span class="ruby-identifier">field_ids</span> <span class="ruby-operator">||=</span> []
105: 
106:       <span class="ruby-identifier">field_ids</span>.<span class="ruby-identifier">collect!</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f_id</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f_id</span>.<span class="ruby-identifier">to_i</span> }
107:       <span class="ruby-identifier">fields</span> = <span class="ruby-identifier">field_ids</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f_id</span><span class="ruby-operator">|</span> <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">f_id</span>.<span class="ruby-identifier">abs</span>) }
108:       <span class="ruby-identifier">custom_field_ids</span> = <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field_id</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field_id</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> }.<span class="ruby-identifier">compact</span>
109: 
110:       <span class="ruby-identifier">first_sorting_order</span> = <span class="ruby-identifier">sorting_order</span>(<span class="ruby-identifier">field_ids</span>)
111: 
112:       <span class="ruby-identifier">cell_include</span> = []
113:       <span class="ruby-identifier">cell_conditions</span> = {}
114: 
115:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">custom_field_ids</span>.<span class="ruby-identifier">size</span>
116:         <span class="ruby-identifier">cell_include</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">:cells</span>
117:         <span class="ruby-identifier">cell_conditions</span>.<span class="ruby-identifier">update</span>( <span class="ruby-identifier">:cells</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:field_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">custom_field_ids</span> } )
118:       <span class="ruby-keyword kw">end</span>
119:       
120:       <span class="ruby-identifier">screen</span> = <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">screen</span>
121: 
122:       <span class="ruby-identifier">rows</span> = []
123: 
124:       <span class="ruby-keyword kw">while</span> <span class="ruby-operator">!</span><span class="ruby-identifier">row_ids</span>.<span class="ruby-identifier">empty?</span>
125:         <span class="ruby-identifier">block_row_ids</span> = <span class="ruby-identifier">row_ids</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">99</span>]
126: 
127:         <span class="ruby-identifier">options</span> = {
128:           <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cell_include</span>,
129:           <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {
130:             <span class="ruby-identifier">:rows</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">block_row_ids</span> }
131:           }.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">cell_conditions</span>)
132:         }
133: 
134:         <span class="ruby-identifier">rows</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">rows</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">options</span> )
135: 
136:         <span class="ruby-identifier">row_ids</span> <span class="ruby-operator">-=</span> <span class="ruby-identifier">block_row_ids</span>
137:       <span class="ruby-keyword kw">end</span>
138: 
139:       <span class="ruby-identifier">sorting_orders</span> = <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">f</span> ) <span class="ruby-operator">?</span> <span class="ruby-identifier">first_sorting_order</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">sorting_order</span> }
140: 
141:       <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">sort</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span>
142:         <span class="ruby-identifier">result</span> = <span class="ruby-value">0</span>
143: 
144:         <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
145:           <span class="ruby-identifier">a_f</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">field_description_value</span>(<span class="ruby-identifier">f</span>)
146:           <span class="ruby-identifier">b_f</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">field_description_value</span>(<span class="ruby-identifier">f</span>)
147: 
148:           <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">case</span>
149:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">a_f</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value">1</span>
150:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">b_f</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value">-1</span>
151:           <span class="ruby-keyword kw">else</span> (<span class="ruby-identifier">a_f</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b_f</span>).<span class="ruby-identifier">to_i</span>
152:           <span class="ruby-keyword kw">end</span>
153:           <span class="ruby-identifier">result</span> <span class="ruby-operator">*=</span> <span class="ruby-value">-1</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">sorting_orders</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:asc</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">a_f</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">b_f</span>.<span class="ruby-identifier">nil?</span>
154: 
155:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">result</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
156:         <span class="ruby-keyword kw">end</span>
157: 
158:         <span class="ruby-identifier">result</span>
159:       <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">id</span>  }
160:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000307" class="method-detail">
        <a name="M000307"></a>

        <div class="method-heading">
          <a href="#M000307" class="method-signature">
          <span class="method-name">sorting_order</span><span class="method-args">(field_ids)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000307-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000307-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 88</span>
 88:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sorting_order</span>(<span class="ruby-identifier">field_ids</span>)
 89:       <span class="ruby-identifier">field_ids</span> <span class="ruby-operator">||=</span> []
 90:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field_ids</span>.<span class="ruby-identifier">empty?</span>
 91:         <span class="ruby-identifier">:asc</span>
 92:       <span class="ruby-keyword kw">else</span>
 93:         <span class="ruby-identifier">field_ids</span>.<span class="ruby-identifier">collect!</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f_id</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f_id</span>.<span class="ruby-identifier">to_i</span> }
 94:         <span class="ruby-identifier">fields</span> = <span class="ruby-identifier">field_ids</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f_id</span><span class="ruby-operator">|</span> <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">f_id</span>.<span class="ruby-identifier">abs</span>) }
 95: 
 96:         <span class="ruby-identifier">first_sorting_order</span> = <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">sorting_order</span>
 97:         <span class="ruby-identifier">first_sorting_order</span> = (<span class="ruby-identifier">first_sorting_order</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:desc</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">:asc</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:desc</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field_ids</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
 98: 
 99:         <span class="ruby-identifier">first_sorting_order</span>
100:       <span class="ruby-keyword kw">end</span>
101:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000325" class="method-detail">
        <a name="M000325"></a>

        <div class="method-heading">
          <a href="#M000325" class="method-signature">
          <span class="method-name">before_destroy</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000325-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000325-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 693</span>
693:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">before_destroy</span>
694:     <span class="ruby-identifier">used_by</span> = <span class="ruby-identifier">used_by?</span>
695:     <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">description</span>, <span class="ruby-node">&quot;is being used #{used_by.description}&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">used_by</span>.<span class="ruby-identifier">nil?</span>
696:     
697:     <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span>
698:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000351" class="method-detail">
        <a name="M000351"></a>

        <div class="method-heading">
          <a href="#M000351" class="method-signature">
          <span class="method-name">belongs_to?</span><span class="method-args">(staff_row_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000351-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000351-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/row.rb, line 993</span>
 993:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">belongs_to?</span>(<span class="ruby-identifier">staff_row_id</span>)
 994:     <span class="ruby-comment cmt"># ToDo: Find the Login reference field</span>
 995:     <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Hard coded CustomField name 'Salesman_REF'&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">RAILS_ENV</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/susbkk/</span>
 996: 
 997:     <span class="ruby-identifier">saleman_custom_field</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;name = ?&quot;</span>, <span class="ruby-value str">&quot;Salesman_REF&quot;</span>])
 998:     <span class="ruby-identifier">saleman_cell</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">saleman_custom_field</span>.<span class="ruby-identifier">id</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">saleman_custom_field</span>
 999:     <span class="ruby-identifier">saleman_cell_id</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>.<span class="ruby-identifier">cell_ref_row_id</span>(<span class="ruby-identifier">saleman_cell</span>.<span class="ruby-identifier">value</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">saleman_cell</span>
1000: 
1001:     <span class="ruby-identifier">saleman_cell_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">staff_row_id</span>.<span class="ruby-identifier">to_i</span>
1002:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000328" class="method-detail">
        <a name="M000328"></a>

        <div class="method-heading">
          <a href="#M000328" class="method-signature">
          <span class="method-name">cell</span><span class="method-args">(custom_field_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000328-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000328-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 714</span>
714:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">custom_field_id</span>)
715:     <span class="ruby-identifier">load_cell_hash</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@cell_hash</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@cell_hash</span>[<span class="ruby-identifier">custom_field_id</span>]
716:     <span class="ruby-ivar">@cell_hash</span>[<span class="ruby-identifier">custom_field_id</span>]
717:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000357" class="method-detail">
        <a name="M000357"></a>

        <div class="method-heading">
          <a href="#M000357" class="method-signature">
          <span class="method-name">cell_values_by_custom_field_ids</span><span class="method-args">(custom_field_ids = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000357-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000357-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/row.rb, line 1097</span>
1097:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cell_values_by_custom_field_ids</span>(<span class="ruby-identifier">custom_field_ids</span> = <span class="ruby-keyword kw">nil</span>)
1098:     <span class="ruby-identifier">custom_field_ids</span> <span class="ruby-operator">||=</span> []
1099:     <span class="ruby-identifier">custom_field_ids</span> = <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field_id</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fields</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>)}.<span class="ruby-identifier">compact</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">custom_field_ids</span>.<span class="ruby-identifier">empty?</span>
1100:     <span class="ruby-identifier">custom_field_ids</span>.<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cf_id</span><span class="ruby-operator">|</span>
1101:       <span class="ruby-identifier">c</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">cf_id</span>)
1102: 
1103:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">field</span>
1104:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>
1105:         <span class="ruby-identifier">ref_row</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">absolute_value</span>[<span class="ruby-identifier">:row</span>]
1106:         <span class="ruby-identifier">ref_row</span>.<span class="ruby-identifier">description</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ref_row</span>.<span class="ruby-identifier">nil?</span>
1107:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">ScreenCombindedReference</span>
1108:         <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">ScreenCombindedReference</span>.<span class="ruby-identifier">cell_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>)
1109:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">OptionCombindedReference</span>
1110:         <span class="ruby-identifier">ref_row</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">absolute_value</span>[<span class="ruby-identifier">:row</span>]
1111:         <span class="ruby-identifier">ref_row</span>.<span class="ruby-identifier">description</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ref_row</span>.<span class="ruby-identifier">nil?</span>
1112:       <span class="ruby-keyword kw">else</span>
1113:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">absolute_value</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">downcase</span>
1114:       <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>
1115:     <span class="ruby-keyword kw">end</span>
1116:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000322" class="method-detail">
        <a name="M000322"></a>

        <div class="method-heading">
          <a href="#M000322" class="method-signature">
          <span class="method-name">check_mandatory</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000322-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000322-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 673</span>
673:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_mandatory</span>
674:     <span class="ruby-ivar">@check_mandatory</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@check_mandatory</span>.<span class="ruby-identifier">nil?</span>
675: 
676:     <span class="ruby-ivar">@check_mandatory</span>
677:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000323" class="method-detail">
        <a name="M000323"></a>

        <div class="method-heading">
          <a href="#M000323" class="method-signature">
          <span class="method-name">check_unique</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000323-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000323-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 679</span>
679:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_unique</span>
680:     <span class="ruby-ivar">@check_unique</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@check_unique</span>.<span class="ruby-identifier">nil?</span>
681: 
682:     <span class="ruby-ivar">@check_unique</span>
683:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000321" class="method-detail">
        <a name="M000321"></a>

        <div class="method-heading">
          <a href="#M000321" class="method-signature">
          <span class="method-name">check_value</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000321-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000321-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 667</span>
667:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_value</span>
668:     <span class="ruby-ivar">@check_value</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@check_value</span>.<span class="ruby-identifier">nil?</span>
669: 
670:     <span class="ruby-ivar">@check_value</span>
671:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000354" class="method-detail">
        <a name="M000354"></a>

        <div class="method-heading">
          <a href="#M000354" class="method-signature">
          <span class="method-name">dependencies</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
~ ToDo: See if this function is used, if not then remove ~ It doesn&#8216;t
return anything
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000354-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000354-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/row.rb, line 1022</span>
1022:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dependencies</span>
1023:     <span class="ruby-identifier">row_relations</span> = {}
1024:     <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">dependencies</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
1025:       <span class="ruby-identifier">row_relations</span>[<span class="ruby-identifier">s</span>.<span class="ruby-identifier">id</span>] = <span class="ruby-identifier">dependencies_rows</span>(<span class="ruby-identifier">s</span>)
1026:     <span class="ruby-keyword kw">end</span>
1027:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000353" class="method-detail">
        <a name="M000353"></a>

        <div class="method-heading">
          <a href="#M000353" class="method-signature">
          <span class="method-name">dependent</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
~ ToDo: See if this function is used, if not then remove ~ It doesn&#8216;t
return anything
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000353-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000353-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/row.rb, line 1013</span>
1013:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dependent</span>
1014:     <span class="ruby-identifier">row_relations</span> = {}
1015:     <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">dependents</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
1016:       <span class="ruby-identifier">row_relations</span>[<span class="ruby-identifier">s</span>.<span class="ruby-identifier">id</span>] = <span class="ruby-identifier">dependent_row</span>(<span class="ruby-identifier">s</span>)
1017:     <span class="ruby-keyword kw">end</span>
1018:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000355" class="method-detail">
        <a name="M000355"></a>

        <div class="method-heading">
          <a href="#M000355" class="method-signature">
          <span class="method-name">dependent_row_ids</span><span class="method-args">(dependent_screen)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000355-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000355-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/row.rb, line 1029</span>
1029:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dependent_row_ids</span>(<span class="ruby-identifier">dependent_screen</span>)
1030:     <span class="ruby-identifier">dependent_custom_fields</span> = <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">relation_types</span>(<span class="ruby-identifier">dependent_screen</span>)
1031:     <span class="ruby-identifier">dependent_custom_fields</span>.<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cf</span><span class="ruby-operator">|</span>
1032:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">cf</span>
1033:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span> <span class="ruby-keyword kw">then</span> 
1034:         <span class="ruby-identifier">ref_cell_value</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">cf</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">value</span>
1035:         <span class="ruby-identifier">ref_row_id</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>.<span class="ruby-identifier">cell_ref_row_id</span>(<span class="ruby-identifier">ref_cell_value</span>)
1036:         <span class="ruby-identifier">ref_row_id</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ref_row_id</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
1037:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">LeftRight</span> <span class="ruby-keyword kw">then</span> 
1038:         <span class="ruby-identifier">ref_cell_value</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">cf</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">value</span>
1039:         <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">LeftRight</span>.<span class="ruby-identifier">cell_ref_row_ids</span>(<span class="ruby-identifier">ref_cell_value</span>) 
1040:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Parameter</span> <span class="ruby-keyword kw">then</span>
1041:         <span class="ruby-comment cmt">#~TODO Implement missing</span>
1042:         <span class="ruby-keyword kw">nil</span>
1043:       <span class="ruby-keyword kw">end</span>
1044:     <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>
1045:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000356" class="method-detail">
        <a name="M000356"></a>

        <div class="method-heading">
          <a href="#M000356" class="method-signature">
          <span class="method-name">dependent_row_ids</span><span class="method-args">(dependencies_screen, relate_cells = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000356-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000356-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/row.rb, line 1047</span>
1047:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dependent_row_ids</span>(<span class="ruby-identifier">dependencies_screen</span>, <span class="ruby-identifier">relate_cells</span> = <span class="ruby-keyword kw">nil</span>)
1048:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">relate_cells</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">relate_cells</span>[<span class="ruby-value">0</span>]
1049:       <span class="ruby-comment cmt"># Use the pre-specified cells</span>
1050:       <span class="ruby-identifier">custom_fields</span> = [<span class="ruby-identifier">relate_cells</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">custom_field</span>]
1051:     <span class="ruby-keyword kw">else</span>
1052:       <span class="ruby-identifier">relate_cells</span> = []
1053:       <span class="ruby-identifier">custom_fields</span> = <span class="ruby-identifier">dependencies_screen</span>.<span class="ruby-identifier">relation_types</span>(<span class="ruby-identifier">screen</span>) 
1054: 
1055:       <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cf</span><span class="ruby-operator">|</span>
1056:         <span class="ruby-comment cmt"># Load all cells into memory</span>
1057:         <span class="ruby-identifier">limit</span> = <span class="ruby-value">100</span>
1058:         <span class="ruby-identifier">offset</span> = <span class="ruby-value">0</span>
1059: 
1060:         <span class="ruby-keyword kw">begin</span>
1061:           <span class="ruby-identifier">refered_cells</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
1062:             <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">limit</span>,
1063:             <span class="ruby-identifier">:offset</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">offset</span>,
1064:             <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;cells.id&quot;</span>,
1065:             <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:row</span>],
1066:             <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span>  [<span class="ruby-value str">&quot;rows.screen_id = ? and cells.field_id = ? &quot;</span>,
1067:               <span class="ruby-identifier">dependencies_screen</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">cf</span>.<span class="ruby-identifier">id</span>]
1068:           )
1069: 
1070:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">refered_cells</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">refered_cells</span>.<span class="ruby-identifier">empty?</span>
1071: 
1072:           <span class="ruby-identifier">relate_cells</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">refered_cells</span>
1073: 
1074:           <span class="ruby-identifier">offset</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">limit</span>
1075:         <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">while</span> <span class="ruby-keyword kw">true</span>
1076:       <span class="ruby-keyword kw">end</span>
1077:     <span class="ruby-keyword kw">end</span>
1078: 
1079:     <span class="ruby-comment cmt"># Filter the cell a relation</span>
1080:     <span class="ruby-identifier">dependencies_row_ids</span> = []
1081: 
1082:     <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cf</span><span class="ruby-operator">|</span>
1083:       <span class="ruby-identifier">dependencies_row_ids</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">cf</span>
1084:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span> <span class="ruby-keyword kw">then</span>
1085:         <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>.<span class="ruby-identifier">relation_row_ids</span>(<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">:id</span>], <span class="ruby-identifier">relate_cells</span>)
1086:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">LeftRight</span> <span class="ruby-keyword kw">then</span>
1087:         <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">LeftRight</span>.<span class="ruby-identifier">relation_row_ids</span>(<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">:id</span>], <span class="ruby-identifier">relate_cells</span>)
1088:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Parameter</span> <span class="ruby-keyword kw">then</span>
1089:         <span class="ruby-comment cmt">#~TODO Implement missing</span>
1090:         []
1091:       <span class="ruby-keyword kw">end</span> <span class="ruby-operator">||</span> []
1092:     <span class="ruby-keyword kw">end</span>
1093: 
1094:     <span class="ruby-identifier">dependencies_row_ids</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>
1095:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000338" class="method-detail">
        <a name="M000338"></a>

        <div class="method-heading">
          <a href="#M000338" class="method-signature">
          <span class="method-name">description</span><span class="method-args">(custom_field_ids = [])</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000338-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000338-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 874</span>
874:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">description</span>(<span class="ruby-identifier">custom_field_ids</span> = [])
875:     <span class="ruby-ivar">@descriptions</span> <span class="ruby-operator">||=</span> {}
876: 
877:     <span class="ruby-identifier">custom_field_ids</span> = [<span class="ruby-identifier">custom_field_ids</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">to_i</span>}
878:     <span class="ruby-identifier">hash_key</span> = <span class="ruby-identifier">custom_field_ids</span>.<span class="ruby-identifier">clone</span>
879: 
880:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@descriptions</span>[<span class="ruby-identifier">hash_key</span>].<span class="ruby-identifier">nil?</span>
881:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">screen</span>
882:         <span class="ruby-comment cmt"># display value in description</span>
883:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">has_scr_field?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">custom_field_ids</span>.<span class="ruby-identifier">empty?</span>
884:           <span class="ruby-ivar">@descriptions</span>[<span class="ruby-identifier">hash_key</span>] = <span class="ruby-identifier">screen_combined_code</span>()
885:         <span class="ruby-keyword kw">else</span>
886:           <span class="ruby-identifier">override_field_displayed</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">custom_field_ids</span>.<span class="ruby-identifier">empty?</span>
887: 
888:           <span class="ruby-comment cmt">#~ By default, use the custom_field_ids from the specified params, if not specified get all</span>
889:           <span class="ruby-identifier">fields</span> = <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">override_field_displayed</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">custom_field_ids</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field_id</span>) }
890: 
891:           <span class="ruby-comment cmt">#~ Use the fields config to display in description</span>
892:           <span class="ruby-identifier">fields</span> = <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">display_in_description?</span> } <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">override_field_displayed</span>
893: 
894:           <span class="ruby-comment cmt">#~ If no custom_field_ids configured, use the first custom field in the screen</span>
895:           <span class="ruby-comment cmt">#~ Only in non-development environment</span>
896:           <span class="ruby-identifier">fields</span> = <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">fields</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">0</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span>(<span class="ruby-constant">RAILS_ENV</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/development/</span>)
897: 
898:           <span class="ruby-comment cmt">#~ Don't display the fields that have been pre-filtered</span>
899:           <span class="ruby-comment cmt"># fields = fields.select{|f| !prefiltered_custom_field_ids.include?(f.custom_field_id) }</span>
900: 
901:           <span class="ruby-identifier">descrs</span> = <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">field_description_value</span>(<span class="ruby-identifier">f</span>) }.<span class="ruby-identifier">compact</span>
902: 
903:           <span class="ruby-ivar">@descriptions</span>[<span class="ruby-identifier">hash_key</span>] = <span class="ruby-identifier">descrs</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span> }.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">d</span>.<span class="ruby-identifier">empty?</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot; - &quot;</span>)
904: 
905:           <span class="ruby-comment cmt"># no display in description</span>
906:           <span class="ruby-ivar">@descriptions</span>[<span class="ruby-identifier">hash_key</span>] = <span class="ruby-node">&quot;&lt;span class='missing_implementation'&gt;Please set which field to display in description for screen '#{self.screen.name}' row_id=#{self[:id]}&lt;/span&gt;&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@descriptions</span>[<span class="ruby-identifier">hash_key</span>].<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">screen</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">RevisionScreen</span>)
907:         <span class="ruby-keyword kw">end</span>
908:       <span class="ruby-keyword kw">else</span>
909:         <span class="ruby-ivar">@descriptions</span>[<span class="ruby-identifier">hash_key</span>] = <span class="ruby-constant">Screen</span>.<span class="ruby-identifier">missing_msg</span>(<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">:screen_id</span>]) <span class="ruby-operator">+</span>
910:           <span class="ruby-node">&quot;&lt;span class='missing_implementation'&gt;Please set which field to display in description for Row ID=#{self[:id]}&lt;/span&gt;&quot;</span>
911:       <span class="ruby-keyword kw">end</span>
912:     <span class="ruby-keyword kw">end</span>
913: 
914:     <span class="ruby-ivar">@descriptions</span>[<span class="ruby-identifier">hash_key</span>]
915:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000319" class="method-detail">
        <a name="M000319"></a>

        <div class="method-heading">
          <a href="#M000319" class="method-signature">
          <span class="method-name">field_cache</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000319-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000319-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 643</span>
643:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">field_cache</span>
644:     <span class="ruby-ivar">@field_cache</span> <span class="ruby-operator">||=</span> {}
645:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000337" class="method-detail">
        <a name="M000337"></a>

        <div class="method-heading">
          <a href="#M000337" class="method-signature">
          <span class="method-name">field_description_value</span><span class="method-args">(field)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000337-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000337-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 844</span>
844:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">field_description_value</span>(<span class="ruby-identifier">field</span>)
845:     <span class="ruby-ivar">@field_description_value</span> <span class="ruby-operator">||=</span> {}
846:     <span class="ruby-ivar">@field_description_value</span>[<span class="ruby-identifier">field</span>.<span class="ruby-identifier">id</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">begin</span>
847:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">screen_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">screen_id</span>
848:         <span class="ruby-identifier">descr</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">latest_revision</span>.<span class="ruby-identifier">field_description_value</span>(<span class="ruby-identifier">field</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">HeaderRow</span>) <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">latest_revision</span>.<span class="ruby-identifier">nil?</span>
849:       <span class="ruby-keyword kw">else</span>
850:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">field</span>
851:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Fields</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>
852:           <span class="ruby-identifier">c</span> = <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">field</span>.<span class="ruby-identifier">custom_field_id</span>)
853: 
854:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>
855:             <span class="ruby-identifier">descr</span> = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">custom_field</span>
856:             <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">IssueTracking</span>
857:               <span class="ruby-identifier">due_date</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">IssueTracking</span>.<span class="ruby-identifier">cell_due_date</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>)
858:               <span class="ruby-identifier">due_date</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">null_date</span> <span class="ruby-value">? </span><span class="ruby-value str">'N/A'</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">due_date</span>
859:             <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">DateTimeField</span>
860:               <span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_date</span>
861:             <span class="ruby-keyword kw">else</span>
862:               <span class="ruby-identifier">c</span>.<span class="ruby-identifier">to_text</span>.<span class="ruby-identifier">strip</span>
863:             <span class="ruby-keyword kw">end</span>
864:           <span class="ruby-keyword kw">end</span>
865:         <span class="ruby-keyword kw">else</span>
866:           <span class="ruby-identifier">descr</span> = <span class="ruby-identifier">field</span>.<span class="ruby-identifier">evaluate_value</span>(<span class="ruby-keyword kw">self</span>)
867:         <span class="ruby-keyword kw">end</span>
868:       <span class="ruby-keyword kw">end</span>
869:       
870:       <span class="ruby-identifier">descr</span>
871:     <span class="ruby-keyword kw">end</span>
872:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000331" class="method-detail">
        <a name="M000331"></a>

        <div class="method-heading">
          <a href="#M000331" class="method-signature">
          <span class="method-name">generate_xml</span><span class="method-args">(f,row_number)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000331-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000331-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 733</span>
733:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">generate_xml</span>(<span class="ruby-identifier">f</span>,<span class="ruby-identifier">row_number</span>)
734:     <span class="ruby-identifier">xml_str</span> = <span class="ruby-value str">&quot;&quot;</span>
735:     <span class="ruby-identifier">column_number</span> = <span class="ruby-value">10</span>
736:     <span class="ruby-identifier">f</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fields</span><span class="ruby-operator">|</span>
737:       <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">field_type</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Header&quot;</span>)
738:         <span class="ruby-keyword kw">next</span>
739:       <span class="ruby-keyword kw">else</span>
740:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">field_type</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Radio Button&quot;</span> <span class="ruby-operator">||</span>
741:             <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">field_type</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Check Box&quot;</span> <span class="ruby-operator">||</span>
742:             <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">field_type</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Reference&quot;</span> <span class="ruby-operator">||</span>
743:             <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">field_type</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Left Right&quot;</span> <span class="ruby-operator">||</span>
744:             <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">field_type</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Combo Box&quot;</span>
745:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">label_ids</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
746:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">field_type</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Check Box&quot;</span>
747:               <span class="ruby-identifier">all_values</span> = <span class="ruby-identifier">retrieve_checkbox_result</span>(<span class="ruby-identifier">valuecheck2</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">fields</span>))
748:             <span class="ruby-keyword kw">else</span>
749:               <span class="ruby-identifier">all_values</span> = <span class="ruby-identifier">retrieve_multi_result</span>(<span class="ruby-identifier">valuecheck</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">fields</span>))
750:             <span class="ruby-keyword kw">end</span>
751:           <span class="ruby-keyword kw">else</span>
752:             <span class="ruby-identifier">all_values</span> = <span class="ruby-identifier">retrieve_nonmulti_result</span>(<span class="ruby-identifier">valuecheck</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">fields</span>))
753:           <span class="ruby-keyword kw">end</span>
754:           <span class="ruby-identifier">all_values</span>[<span class="ruby-identifier">:cell_values</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
755:             <span class="ruby-identifier">xml_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&lt;cell&gt;\n&quot;</span>
756:             <span class="ruby-identifier">xml_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;row_id type=\&quot;integer\&quot;&gt;#{row_number}&lt;/row_id&gt;\n&quot;</span>
757:             <span class="ruby-identifier">xml_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;field_id type=\&quot;integer\&quot;&gt;#{column_number}&lt;/field_id&gt;\n&quot;</span>
758:             <span class="ruby-identifier">xml_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;value&gt;#{value}&lt;/value&gt;\n&quot;</span>
759:             <span class="ruby-identifier">xml_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&lt;/cell&gt;\n&quot;</span>
760:           <span class="ruby-keyword kw">end</span>
761:         <span class="ruby-keyword kw">else</span>
762:           <span class="ruby-identifier">xml_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&lt;cell&gt;\n&quot;</span>
763:           <span class="ruby-identifier">xml_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;row_id type=\&quot;integer\&quot;&gt;#{row_number}&lt;/row_id&gt;\n&quot;</span>
764:           <span class="ruby-identifier">xml_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;field_id type=\&quot;integer\&quot;&gt;#{column_number}&lt;/field_id&gt;\n&quot;</span>
765:           <span class="ruby-identifier">xml_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;value&gt;#{valuecheck(self, fields)} &lt;/value&gt;\n&quot;</span>
766:           <span class="ruby-identifier">xml_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&lt;/cell&gt;\n&quot;</span>
767:         <span class="ruby-keyword kw">end</span>
768:       <span class="ruby-keyword kw">end</span>
769:       <span class="ruby-identifier">column_number</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
770:     <span class="ruby-keyword kw">end</span>
771: 
772:     <span class="ruby-comment cmt">#    ----------------RemarkData----------------</span>
773: 
774:     <span class="ruby-identifier">xml_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&lt;cell&gt;\n&quot;</span>
775:     <span class="ruby-identifier">xml_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;row_id type=\&quot;integer\&quot;&gt;#{row_number}&lt;/row_id&gt;\n&quot;</span>
776:     <span class="ruby-identifier">xml_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;field_id type=\&quot;integer\&quot;&gt;#{column_number}&lt;/field_id&gt;\n&quot;</span>
777:     <span class="ruby-identifier">xml_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;value&gt;#{self.remark} &lt;/value&gt;\n&quot;</span>
778:     <span class="ruby-identifier">xml_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&lt;/cell&gt;\n&quot;</span>
779: 
780:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000329" class="method-detail">
        <a name="M000329"></a>

        <div class="method-heading">
          <a href="#M000329" class="method-signature">
          <span class="method-name">get_field_type</span><span class="method-args">(custom_field_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000329-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000329-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 719</span>
719:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_field_type</span>(<span class="ruby-identifier">custom_field_id</span>)
720:     <span class="ruby-identifier">field_type</span> = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;id = ?&quot;</span>, <span class="ruby-identifier">custom_field_id</span>]).<span class="ruby-identifier">field_type</span>.<span class="ruby-identifier">name</span>
721:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">field_type</span>
722:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000330" class="method-detail">
        <a name="M000330"></a>

        <div class="method-heading">
          <a href="#M000330" class="method-signature">
          <span class="method-name">get_image_name</span><span class="method-args">(custom_field_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000330-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000330-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 724</span>
724:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_image_name</span>(<span class="ruby-identifier">custom_field_id</span>)
725:     <span class="ruby-identifier">cell</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;row_id = ? and field_id = ?&quot;</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span> , <span class="ruby-identifier">custom_field_id</span>])
726:     <span class="ruby-identifier">image_name</span> = <span class="ruby-value str">&quot;&quot;</span>
727:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cell</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
728:       <span class="ruby-identifier">image_name</span> = <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span>
729:     <span class="ruby-keyword kw">end</span>
730:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">image_name</span>
731:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000327" class="method-detail">
        <a name="M000327"></a>

        <div class="method-heading">
          <a href="#M000327" class="method-signature">
          <span class="method-name">load_cell_hash</span><span class="method-args">(cell=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000327-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000327-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 704</span>
704:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_cell_hash</span>(<span class="ruby-identifier">cell</span>=<span class="ruby-keyword kw">nil</span>)
705:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">nil?</span>
706:       <span class="ruby-ivar">@cell_hash</span> = {}
707:       <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@cell_hash</span>[<span class="ruby-identifier">c</span>.<span class="ruby-identifier">custom_field_id</span>] = <span class="ruby-identifier">c</span>}
708:     <span class="ruby-keyword kw">else</span>
709:       <span class="ruby-ivar">@cell_hash</span> <span class="ruby-operator">||=</span> {}
710:       <span class="ruby-ivar">@cell_hash</span>[<span class="ruby-identifier">cell</span>.<span class="ruby-identifier">custom_field_id</span>] = <span class="ruby-identifier">cell</span>
711:     <span class="ruby-keyword kw">end</span>
712:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000317" class="method-detail">
        <a name="M000317"></a>

        <div class="method-heading">
          <a href="#M000317" class="method-signature">
          <span class="method-name">operation_url_options</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000317-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000317-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 635</span>
635:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">operation_url_options</span>
636:     {<span class="ruby-identifier">:ajax_relation_result_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;operation_area_#{self[:screen_id]}&quot;</span>}
637:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000350" class="method-detail">
        <a name="M000350"></a>

        <div class="method-heading">
          <a href="#M000350" class="method-signature">
          <span class="method-name">option_combined_cell</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000350-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000350-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 983</span>
983:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">option_combined_cell</span>
984:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@option_combined_cell</span>.<span class="ruby-identifier">nil?</span>
985:       <span class="ruby-identifier">ocr_field</span> = <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fields</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">OptionCombindedReference</span>) }.<span class="ruby-identifier">first</span>
986: 
987:       <span class="ruby-ivar">@option_combined_cell</span> = <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">ocr_field</span>.<span class="ruby-identifier">custom_field_id</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ocr_field</span>
988:     <span class="ruby-keyword kw">end</span>
989: 
990:     <span class="ruby-ivar">@option_combined_cell</span>
991:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000347" class="method-detail">
        <a name="M000347"></a>

        <div class="method-heading">
          <a href="#M000347" class="method-signature">
          <span class="method-name">option_combined_row</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000347-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000347-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 955</span>
955:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">option_combined_row</span>
956:     <span class="ruby-identifier">ocr_row_id</span> = <span class="ruby-identifier">option_combined_row_id</span>.<span class="ruby-identifier">to_i</span>
957:     <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">ocr_row_id</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ocr_row_id</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
958:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000346" class="method-detail">
        <a name="M000346"></a>

        <div class="method-heading">
          <a href="#M000346" class="method-signature">
          <span class="method-name">option_combined_row_id</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000346-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000346-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 945</span>
945:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">option_combined_row_id</span>
946:     <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@option_combined_row_id</span>
947:       <span class="ruby-identifier">ocr_cell</span> = <span class="ruby-identifier">option_combined_cell</span>
948: 
949:       <span class="ruby-ivar">@option_combined_row_id</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">OptionCombindedReference</span>.<span class="ruby-identifier">cell_scr_row_id</span>(<span class="ruby-identifier">ocr_cell</span>.<span class="ruby-identifier">value</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ocr_cell</span>
950:     <span class="ruby-keyword kw">end</span>
951: 
952:     <span class="ruby-ivar">@option_combined_row_id</span>
953:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000318" class="method-detail">
        <a name="M000318"></a>

        <div class="method-heading">
          <a href="#M000318" class="method-signature">
          <span class="method-name">relation_url_options</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000318-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000318-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 639</span>
639:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">relation_url_options</span>
640:     {}
641:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000352" class="method-detail">
        <a name="M000352"></a>

        <div class="method-heading">
          <a href="#M000352" class="method-signature">
          <span class="method-name">relations</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
~ ToDo: See if this function is used, if not then remove ~ The hash
doesn&#8216;t support the + operator. ~ <a
href="Row.html#M000353">dependent</a> and <a
href="Row.html#M000354">dependencies</a> are (might be) hashes
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000352-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000352-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/row.rb, line 1007</span>
1007:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">relations</span>
1008:     <span class="ruby-identifier">dependent</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dependencies</span>
1009:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000336" class="method-detail">
        <a name="M000336"></a>

        <div class="method-heading">
          <a href="#M000336" class="method-signature">
          <span class="method-name">retrieve_checkbox_result</span><span class="method-args">(all_values)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000336-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000336-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 830</span>
830:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">retrieve_checkbox_result</span>(<span class="ruby-identifier">all_values</span>) <span class="ruby-comment cmt"># Use in generate xml(cross-tab) for use in PDF reporting</span>
831:     <span class="ruby-identifier">cell_values</span> = <span class="ruby-value str">&quot;False&quot;</span>
832:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">all_values</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&amp;nbsp;&quot;</span>
833:       <span class="ruby-identifier">all_values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
834:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;-1&quot;</span>
835:           <span class="ruby-identifier">cell_values</span> = <span class="ruby-value str">&quot;True&quot;</span>
836:         <span class="ruby-keyword kw">end</span>
837:       <span class="ruby-keyword kw">end</span>
838:     <span class="ruby-keyword kw">end</span>
839: 
840:     <span class="ruby-comment cmt">#return value</span>
841:     {<span class="ruby-identifier">:cell_values</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cell_values</span>}
842:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000335" class="method-detail">
        <a name="M000335"></a>

        <div class="method-heading">
          <a href="#M000335" class="method-signature">
          <span class="method-name">retrieve_multi_result</span><span class="method-args">(all_values)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000335-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000335-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 816</span>
816:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">retrieve_multi_result</span>(<span class="ruby-identifier">all_values</span>)   <span class="ruby-comment cmt"># Use in generate xml(cross-tab) for use in PDF reporting</span>
817:     <span class="ruby-identifier">cell_values</span> = []
818:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">all_values</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&amp;nbsp;&quot;</span>
819:       <span class="ruby-identifier">all_values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
820:         <span class="ruby-identifier">cell_values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Caption</span>.<span class="ruby-identifier">find_by_label_id</span>(<span class="ruby-identifier">r</span>).<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>
821:       <span class="ruby-keyword kw">end</span>
822:     <span class="ruby-keyword kw">else</span>
823:       <span class="ruby-identifier">cell_values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">all_values</span>
824:     <span class="ruby-keyword kw">end</span>
825: 
826:     <span class="ruby-comment cmt">#return value</span>
827:     {<span class="ruby-identifier">:cell_values</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cell_values</span>}
828:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000334" class="method-detail">
        <a name="M000334"></a>

        <div class="method-heading">
          <a href="#M000334" class="method-signature">
          <span class="method-name">retrieve_nonmulti_result</span><span class="method-args">(all_values)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000334-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000334-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 802</span>
802:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">retrieve_nonmulti_result</span>(<span class="ruby-identifier">all_values</span>) <span class="ruby-comment cmt"># Use in generate xml(cross-tab) for use in PDF reporting</span>
803:     <span class="ruby-identifier">cell_values</span> = []
804:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">all_values</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span>
805:       <span class="ruby-identifier">all_values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
806:         <span class="ruby-identifier">row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">to_i</span>)
807:         <span class="ruby-identifier">cell_values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">description</span>
808:       <span class="ruby-keyword kw">end</span>
809:     <span class="ruby-keyword kw">else</span>
810:       <span class="ruby-identifier">cell_values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">all_values</span>
811:     <span class="ruby-keyword kw">end</span>
812:     
813:     {<span class="ruby-identifier">:cell_values</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cell_values</span>}
814:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000349" class="method-detail">
        <a name="M000349"></a>

        <div class="method-heading">
          <a href="#M000349" class="method-signature">
          <span class="method-name">screen_combined_cell</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000349-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000349-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 973</span>
973:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">screen_combined_cell</span>()
974:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@screen_combined_cell</span>.<span class="ruby-identifier">nil?</span>
975:       <span class="ruby-identifier">scr_field</span> = <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fields</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">ScreenCombindedReference</span>) }.<span class="ruby-identifier">first</span>
976: 
977:       <span class="ruby-ivar">@screen_combined_cell</span> = <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">scr_field</span>.<span class="ruby-identifier">custom_field_id</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">scr_field</span>
978:     <span class="ruby-keyword kw">end</span>
979: 
980:     <span class="ruby-ivar">@screen_combined_cell</span>
981:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000339" class="method-detail">
        <a name="M000339"></a>

        <div class="method-heading">
          <a href="#M000339" class="method-signature">
          <span class="method-name">screen_combined_code</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000339-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000339-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 917</span>
917:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">screen_combined_code</span>
918:     <span class="ruby-identifier">screen_combined_values</span>[<span class="ruby-identifier">:code</span>]
919:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000344" class="method-detail">
        <a name="M000344"></a>

        <div class="method-heading">
          <a href="#M000344" class="method-signature">
          <span class="method-name">screen_combined_option_screen_ids</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000344-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000344-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 937</span>
937:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">screen_combined_option_screen_ids</span>
938:     <span class="ruby-identifier">screen_combined_values</span>[<span class="ruby-identifier">:option_screen_ids</span>]
939:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000345" class="method-detail">
        <a name="M000345"></a>

        <div class="method-heading">
          <a href="#M000345" class="method-signature">
          <span class="method-name">screen_combined_option_screens</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000345-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000345-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 941</span>
941:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">screen_combined_option_screens</span>
942:     <span class="ruby-identifier">screen_combined_option_screen_ids</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s_id</span><span class="ruby-operator">|</span> <span class="ruby-constant">Screen</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">s_id</span>) }
943:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000343" class="method-detail">
        <a name="M000343"></a>

        <div class="method-heading">
          <a href="#M000343" class="method-signature">
          <span class="method-name">screen_combined_screen_group</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000343-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000343-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 933</span>
933:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">screen_combined_screen_group</span>
934:     <span class="ruby-identifier">screen_combined_screen_group_ids</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s_id</span><span class="ruby-operator">|</span> <span class="ruby-constant">Screen</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">s_id</span>) }
935:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000341" class="method-detail">
        <a name="M000341"></a>

        <div class="method-heading">
          <a href="#M000341" class="method-signature">
          <span class="method-name">screen_combined_screen_group_ids</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000341-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000341-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 925</span>
925:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">screen_combined_screen_group_ids</span>
926:     <span class="ruby-identifier">screen_combined_values</span>[<span class="ruby-identifier">:screen_group_ids</span>]
927:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000340" class="method-detail">
        <a name="M000340"></a>

        <div class="method-heading">
          <a href="#M000340" class="method-signature">
          <span class="method-name">screen_combined_screen_ids</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000340-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000340-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 921</span>
921:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">screen_combined_screen_ids</span>
922:     <span class="ruby-identifier">screen_combined_values</span>[<span class="ruby-identifier">:screen_ids</span>]
923:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000342" class="method-detail">
        <a name="M000342"></a>

        <div class="method-heading">
          <a href="#M000342" class="method-signature">
          <span class="method-name">screen_combined_screens</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000342-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000342-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 929</span>
929:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">screen_combined_screens</span>
930:     <span class="ruby-identifier">screen_combined_screen_ids</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s_id</span><span class="ruby-operator">|</span> <span class="ruby-constant">Screen</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">s_id</span>) }
931:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000348" class="method-detail">
        <a name="M000348"></a>

        <div class="method-heading">
          <a href="#M000348" class="method-signature">
          <span class="method-name">screen_combined_values</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000348-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000348-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 960</span>
960:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">screen_combined_values</span>
961:     <span class="ruby-ivar">@screen_combined_values</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">begin</span>
962:       <span class="ruby-identifier">scr_cell</span> = <span class="ruby-identifier">screen_combined_cell</span>
963: 
964:       {
965:         <span class="ruby-identifier">:code</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scr_cell</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">ScreenCombindedReference</span>.<span class="ruby-identifier">cell_code</span>(<span class="ruby-identifier">scr_cell</span>.<span class="ruby-identifier">value</span>),
966:         <span class="ruby-identifier">:screen_ids</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scr_cell</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span>[] <span class="ruby-operator">:</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">ScreenCombindedReference</span>.<span class="ruby-identifier">cell_screen_ids</span>(<span class="ruby-identifier">scr_cell</span>.<span class="ruby-identifier">value</span>),
967:         <span class="ruby-identifier">:screen_group_ids</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scr_cell</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span>[] <span class="ruby-operator">:</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">ScreenCombindedReference</span>.<span class="ruby-identifier">cell_screen_group_ids</span>(<span class="ruby-identifier">scr_cell</span>.<span class="ruby-identifier">value</span>),
968:         <span class="ruby-identifier">:option_screen_ids</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scr_cell</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span>[] <span class="ruby-operator">:</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">ScreenCombindedReference</span>.<span class="ruby-identifier">cell_option_screen_ids</span>(<span class="ruby-identifier">scr_cell</span>.<span class="ruby-identifier">value</span>)
969:       }
970:     <span class="ruby-keyword kw">end</span>
971:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000358" class="method-detail">
        <a name="M000358"></a>

        <div class="method-heading">
          <a href="#M000358" class="method-signature">
          <span class="method-name">select_multiple_counter_from_descr</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000358-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000358-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/row.rb, line 1118</span>
1118:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select_multiple_counter_from_descr</span>
1119:     <span class="ruby-comment cmt"># .gsub(/[^0-9]/, '').to_i </span>
1120: 
1121:     <span class="ruby-identifier">description</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span><span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">description</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/[^0-9]/</span>, <span class="ruby-value str">''</span>).<span class="ruby-identifier">to_i</span>
1122:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000320" class="method-detail">
        <a name="M000320"></a>

        <div class="method-heading">
          <a href="#M000320" class="method-signature">
          <span class="method-name">updated_at</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000320-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000320-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 647</span>
647:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">updated_at</span>
648:     <span class="ruby-ivar">@updated_at</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">begin</span>
649:       <span class="ruby-identifier">updated_dates</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">full_logs</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">full_log</span><span class="ruby-operator">|</span> <span class="ruby-identifier">full_log</span>.<span class="ruby-identifier">updated_at</span> } <span class="ruby-operator">+</span> [<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">:updated_at</span>]]
650: 
651:       <span class="ruby-keyword kw">case</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">screen</span>
652:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">HeaderScreen</span>
653:         <span class="ruby-identifier">revision_row</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">latest_revision</span>
654:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">RevisionScreen</span>
655:         <span class="ruby-identifier">revision_row</span> = <span class="ruby-keyword kw">self</span>
656:       <span class="ruby-keyword kw">end</span>
657: 
658:       <span class="ruby-identifier">updated_dates</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">revision_row</span>.<span class="ruby-identifier">full_logs</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">full_log</span><span class="ruby-operator">|</span> <span class="ruby-identifier">full_log</span>.<span class="ruby-identifier">updated_at</span> } <span class="ruby-operator">+</span> [<span class="ruby-identifier">revision_row</span>.<span class="ruby-identifier">updated_at</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">revision_row</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">revision_row</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">self</span>
659:       <span class="ruby-identifier">updated_dates</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">revision_row</span>.<span class="ruby-identifier">detail_rows</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">full_logs</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">full_log</span><span class="ruby-operator">|</span> <span class="ruby-identifier">full_log</span>.<span class="ruby-identifier">updated_at</span> } <span class="ruby-operator">+</span> [<span class="ruby-identifier">r</span>.<span class="ruby-identifier">updated_at</span>] }.<span class="ruby-identifier">flatten</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">revision_row</span>.<span class="ruby-identifier">nil?</span>
660: 
661:       <span class="ruby-identifier">updated_dates</span>.<span class="ruby-identifier">max</span>
662:     <span class="ruby-keyword kw">end</span>
663:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000326" class="method-detail">
        <a name="M000326"></a>

        <div class="method-heading">
          <a href="#M000326" class="method-signature">
          <span class="method-name">used_by?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000326-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000326-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 700</span>
700:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">used_by?</span>
701:     <span class="ruby-ivar">@used</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">in_use?</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">used?</span>
702:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000324" class="method-detail">
        <a name="M000324"></a>

        <div class="method-heading">
          <a href="#M000324" class="method-signature">
          <span class="method-name">validate</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000324-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000324-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 685</span>
685:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validate</span>
686:     <span class="ruby-identifier">validate_value</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">check_value</span>
687:     <span class="ruby-identifier">validate_mandatory</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">check_mandatory</span>
688:     <span class="ruby-identifier">validate_unique</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">check_unique</span>
689: 
690:     <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span>
691:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000332" class="method-detail">
        <a name="M000332"></a>

        <div class="method-heading">
          <a href="#M000332" class="method-signature">
          <span class="method-name">valuecheck</span><span class="method-args">(row, field)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
def prefix if (screen.class.to_s == &quot;<a
href="ListScreen.html">ListScreen</a>&quot;)
</p>
<pre>
  row_model =&quot;&quot;
</pre>
<p>
else
</p>
<pre>
  row_model = &quot;#{screen.prefix}_row&quot;.classify.constantize
</pre>
<p>
end return row_model end
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000332-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000332-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 791</span>
791:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">valuecheck</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">field</span>) <span class="ruby-comment cmt"># Use in generate xml(cross-tab) for use in PDF reporting</span>
792:     <span class="ruby-identifier">result</span> = (<span class="ruby-identifier">row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">field</span>.<span class="ruby-identifier">custom_field_id</span>).<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">field</span>.<span class="ruby-identifier">custom_field_id</span>).<span class="ruby-identifier">value</span>
793:     <span class="ruby-identifier">result</span> = <span class="ruby-identifier">result</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">&quot;&amp;&quot;</span>,<span class="ruby-value str">&quot;&amp;amp;&quot;</span>)
794:     <span class="ruby-comment cmt">#result = (result == &quot;&quot;) ? &quot;&quot; : result</span>
795:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000333" class="method-detail">
        <a name="M000333"></a>

        <div class="method-heading">
          <a href="#M000333" class="method-signature">
          <span class="method-name">valuecheck2</span><span class="method-args">(row, field)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000333-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000333-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/row.rb, line 797</span>
797:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">valuecheck2</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">field</span>) <span class="ruby-comment cmt"># Use in generate xml(cross-tab) for use in PDF reporting</span>
798:     <span class="ruby-identifier">result</span> = (<span class="ruby-identifier">row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">field</span>.<span class="ruby-identifier">custom_field_id</span>).<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">field</span>.<span class="ruby-identifier">custom_field_id</span>).<span class="ruby-identifier">value</span>
799:     <span class="ruby-identifier">result</span> = (<span class="ruby-identifier">result</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>) <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">result</span>
800:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>