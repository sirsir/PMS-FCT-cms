<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: RowsController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">RowsController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/rows_controller_rb.html">
                app/controllers/rows_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000434">code_combined_reference</a>&nbsp;&nbsp;
      <a href="#M000435">code_combined_reference_group</a>&nbsp;&nbsp;
      <a href="#M000416">create</a>&nbsp;&nbsp;
      <a href="#M000417">create_unsave_row</a>&nbsp;&nbsp;
      <a href="#M000419">destroy</a>&nbsp;&nbsp;
      <a href="#M000414">edit</a>&nbsp;&nbsp;
      <a href="#M000421">edit_header</a>&nbsp;&nbsp;
      <a href="#M000415">edit_unsave_row</a>&nbsp;&nbsp;
      <a href="#M000420">export</a>&nbsp;&nbsp;
      <a href="#M000411">fetch_row</a>&nbsp;&nbsp;
      <a href="#M000429">gen_rows_by_fields</a>&nbsp;&nbsp;
      <a href="#M000430">gen_rows_by_fields_edit</a>&nbsp;&nbsp;
      <a href="#M000431">gen_values</a>&nbsp;&nbsp;
      <a href="#M000405">get_session_row_ids</a>&nbsp;&nbsp;
      <a href="#M000410">index</a>&nbsp;&nbsp;
      <a href="#M000413">new</a>&nbsp;&nbsp;
      <a href="#M000422">new_header</a>&nbsp;&nbsp;
      <a href="#M000432">option_combined_reference</a>&nbsp;&nbsp;
      <a href="#M000433">option_combined_reference_group</a>&nbsp;&nbsp;
      <a href="#M000437">parameter</a>&nbsp;&nbsp;
      <a href="#M000408">permission_mapping</a>&nbsp;&nbsp;
      <a href="#M000439">print</a>&nbsp;&nbsp;
      <a href="#M000426">quick_add</a>&nbsp;&nbsp;
      <a href="#M000427">quick_search</a>&nbsp;&nbsp;
      <a href="#M000436">reference_attribute</a>&nbsp;&nbsp;
      <a href="#M000425">relations</a>&nbsp;&nbsp;
      <a href="#M000428">reload_comboref</a>&nbsp;&nbsp;
      <a href="#M000438">save_full_log</a>&nbsp;&nbsp;
      <a href="#M000409">screen_from_action</a>&nbsp;&nbsp;
      <a href="#M000407">screen_from_action</a>&nbsp;&nbsp;
      <a href="#M000423">search</a>&nbsp;&nbsp;
      <a href="#M000412">show</a>&nbsp;&nbsp;
      <a href="#M000424">special_search</a>&nbsp;&nbsp;
      <a href="#M000406">store_session_row_ids</a>&nbsp;&nbsp;
      <a href="#M000418">update</a>&nbsp;&nbsp;
      <a href="#M000440">update_cell_calendar</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000405" class="method-detail">
        <a name="M000405"></a>

        <div class="method-heading">
          <a href="#M000405" class="method-signature">
          <span class="method-name">get_session_row_ids</span><span class="method-args">(session_id, screen_id, purge = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000405-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000405-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 8</span>
 8:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_session_row_ids</span>(<span class="ruby-identifier">session_id</span>, <span class="ruby-identifier">screen_id</span>, <span class="ruby-identifier">purge</span> = <span class="ruby-keyword kw">false</span>)
 9:       <span class="ruby-identifier">vm</span> = <span class="ruby-constant">VirtualMemory</span><span class="ruby-operator">::</span><span class="ruby-identifier">load</span>(<span class="ruby-identifier">:session</span>, <span class="ruby-identifier">session_id</span>)
10: 
11:       <span class="ruby-identifier">vm</span>[<span class="ruby-identifier">:filtered_row_ids</span>] <span class="ruby-operator">||=</span> {}
12:       ( <span class="ruby-identifier">purge</span> <span class="ruby-value">? </span><span class="ruby-identifier">vm</span>[<span class="ruby-identifier">:filtered_row_ids</span>].<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">screen_id</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">vm</span>[<span class="ruby-identifier">:filtered_row_ids</span>][<span class="ruby-identifier">screen_id</span>]) <span class="ruby-operator">||</span> []
13:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000407" class="method-detail">
        <a name="M000407"></a>

        <div class="method-heading">
          <a href="#M000407" class="method-signature">
          <span class="method-name">screen_from_action</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000407-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000407-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 24</span>
24:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">screen_from_action</span>(<span class="ruby-identifier">params</span>)
25:       <span class="ruby-identifier">action</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:action</span>].<span class="ruby-identifier">to_sym</span>
26: 
27:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:screen_id</span>].<span class="ruby-identifier">nil?</span>
28:         <span class="ruby-identifier">screen</span> = <span class="ruby-constant">Screen</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:screen_id</span>])
29:       <span class="ruby-keyword kw">elsif</span> [<span class="ruby-identifier">:index</span>, <span class="ruby-identifier">:search</span>, <span class="ruby-identifier">:new</span>, <span class="ruby-identifier">:print</span>, <span class="ruby-identifier">:export</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">action</span>)
30:         <span class="ruby-identifier">screen</span> = <span class="ruby-constant">Screen</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
31:       <span class="ruby-keyword kw">elsif</span> [<span class="ruby-identifier">:update</span>, <span class="ruby-identifier">:edit</span>, <span class="ruby-identifier">:destroy</span>, <span class="ruby-identifier">:fetch_row</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">action</span>)
32:         <span class="ruby-identifier">row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
33: 
34:         <span class="ruby-identifier">screen</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">screen</span>
35:       <span class="ruby-keyword kw">end</span>
36: 
37:       <span class="ruby-identifier">screen</span>
38:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000406" class="method-detail">
        <a name="M000406"></a>

        <div class="method-heading">
          <a href="#M000406" class="method-signature">
          <span class="method-name">store_session_row_ids</span><span class="method-args">(session_id, screen_id, filtered_row_ids)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000406-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000406-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 15</span>
15:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">store_session_row_ids</span>(<span class="ruby-identifier">session_id</span>, <span class="ruby-identifier">screen_id</span>, <span class="ruby-identifier">filtered_row_ids</span>)
16:       <span class="ruby-identifier">vm</span> = <span class="ruby-constant">VirtualMemory</span><span class="ruby-operator">::</span><span class="ruby-identifier">load</span>(<span class="ruby-identifier">:session</span>, <span class="ruby-identifier">session_id</span>)
17: 
18:       <span class="ruby-identifier">vm</span>[<span class="ruby-identifier">:filtered_row_ids</span>] <span class="ruby-operator">||=</span> {}
19:       <span class="ruby-identifier">vm</span>[<span class="ruby-identifier">:filtered_row_ids</span>][<span class="ruby-identifier">screen_id</span>] = <span class="ruby-identifier">filtered_row_ids</span>
20: 
21:       <span class="ruby-constant">VirtualMemory</span><span class="ruby-operator">::</span><span class="ruby-identifier">store</span>(<span class="ruby-identifier">:session</span>, <span class="ruby-identifier">session_id</span>, <span class="ruby-identifier">vm</span>)
22:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000434" class="method-detail">
        <a name="M000434"></a>

        <div class="method-heading">
          <a href="#M000434" class="method-signature">
          <span class="method-name">code_combined_reference</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000434-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000434-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 834</span>
834:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">code_combined_reference</span>
835:     <span class="ruby-ivar">@name_prefix</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:name_prefix</span>]
836:     <span class="ruby-ivar">@row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:row_id</span>].<span class="ruby-identifier">to_i</span>)
837:     <span class="ruby-ivar">@field</span> = <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:field_id</span>].<span class="ruby-identifier">to_i</span>) <span class="ruby-comment cmt">#code_combined_ref</span>
838:     <span class="ruby-ivar">@option_flag</span> = <span class="ruby-identifier">eval</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:option_flag</span>])
839:     <span class="ruby-ivar">@selected_options</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:selected_options</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span>[] <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:selected_options</span>]
840:     <span class="ruby-ivar">@selected_options</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:selected_values</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:selected_values</span>].<span class="ruby-identifier">nil?</span>
841:     <span class="ruby-ivar">@main_index</span> = <span class="ruby-ivar">@selected_options</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span><span class="ruby-value">0</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:main_index</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
842:     <span class="ruby-ivar">@screens</span> = <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">screen_combined_screens</span>()
843:     <span class="ruby-identifier">ocr_field</span> = <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">CodeCombindedReference</span>.<span class="ruby-identifier">field_ocr_field_id</span>(<span class="ruby-ivar">@field</span>.<span class="ruby-identifier">value</span>))
844:     <span class="ruby-identifier">scr_field</span> = <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">OptionCombindedReference</span>.<span class="ruby-identifier">field_scr_field_id</span>(<span class="ruby-identifier">ocr_field</span>.<span class="ruby-identifier">value</span>))
845:     <span class="ruby-identifier">scr_row_cell_value</span> = <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">scr_field</span>.<span class="ruby-identifier">custom_field_id</span>).<span class="ruby-identifier">value</span>
846:     <span class="ruby-identifier">screen_used_as_multiply_count_index</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">ScreenCombindedReference</span>.<span class="ruby-identifier">screen_used_as_multiply_count_index</span>(<span class="ruby-identifier">scr_row_cell_value</span>)
847:     <span class="ruby-identifier">counter_row_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:counter_row_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-identifier">screen_used_as_multiply_count_index</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@selected_options</span>.<span class="ruby-identifier">size</span> <span class="ruby-value">? </span><span class="ruby-ivar">@selected_options</span>[<span class="ruby-identifier">screen_used_as_multiply_count_index</span>] <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:counter_row_id</span>].<span class="ruby-identifier">to_i</span>
848:     <span class="ruby-identifier">counter_row</span> = <span class="ruby-identifier">counter_row_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">counter_row_id</span>) <span class="ruby-comment cmt"># 2,3,4</span>
849:     <span class="ruby-ivar">@count</span> = <span class="ruby-identifier">counter_row</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">counter_row</span>.<span class="ruby-identifier">select_multiple_counter_from_descr</span>
850: 
851: 
852:     <span class="ruby-ivar">@size</span> = <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">screen_combined_screen_ids</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> ((<span class="ruby-ivar">@row</span>.<span class="ruby-identifier">screen_combined_screen_group_ids</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">screen_combined_screen_ids</span>.<span class="ruby-identifier">size</span>) <span class="ruby-operator">*</span> <span class="ruby-ivar">@count</span>)
853:     <span class="ruby-ivar">@is_group</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:is_group</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">false</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">eval</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:is_group</span>])
854:     <span class="ruby-identifier">last_selected</span> = <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:last_selected</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/true/i</span>).<span class="ruby-identifier">nil?</span>
855:     <span class="ruby-identifier">options</span> = <span class="ruby-ivar">@field</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">options</span>(<span class="ruby-ivar">@row</span>, <span class="ruby-ivar">@field</span>, <span class="ruby-ivar">@selected_options</span>,<span class="ruby-operator">!</span><span class="ruby-identifier">last_selected</span> )
856:     <span class="ruby-ivar">@available_options</span> = [<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:available_options</span>]]
857:     <span class="ruby-ivar">@ocr_row</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:selected_row</span>]
858:     <span class="ruby-ivar">@relate_model_rows</span> = [<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:selected_row</span>]]
859:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">CodeCombindedReference</span>.<span class="ruby-identifier">field_display_as</span>(<span class="ruby-ivar">@field</span>.<span class="ruby-identifier">value</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">:model_for_sale</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">last_selected</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-identifier">:selected_row</span>].<span class="ruby-identifier">nil?</span>
860:       <span class="ruby-ivar">@relate_model_rows</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">OptionCombindedReference</span>.<span class="ruby-identifier">related_model_rows</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:selected_row</span>], <span class="ruby-ivar">@selected_options</span>, <span class="ruby-ivar">@field</span>.<span class="ruby-identifier">source_field</span>)
861:       <span class="ruby-ivar">@model_options</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">OptionCombindedReference</span>.<span class="ruby-identifier">model_options</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:selected_row</span>], <span class="ruby-ivar">@selected_options</span>, <span class="ruby-ivar">@field</span>.<span class="ruby-identifier">source_field</span>)
862:     <span class="ruby-keyword kw">end</span>
863:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
864:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
865:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@screens</span> }
866:     <span class="ruby-keyword kw">end</span>
867:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000435" class="method-detail">
        <a name="M000435"></a>

        <div class="method-heading">
          <a href="#M000435" class="method-signature">
          <span class="method-name">code_combined_reference_group</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000435-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000435-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 869</span>
869:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">code_combined_reference_group</span>
870:     <span class="ruby-ivar">@row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:row_id</span>].<span class="ruby-identifier">to_i</span>)
871:     <span class="ruby-ivar">@field</span> = <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:field_id</span>].<span class="ruby-identifier">to_i</span>) <span class="ruby-comment cmt">#code_combined_ref</span>
872:     <span class="ruby-ivar">@option_flag</span> = <span class="ruby-identifier">eval</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:option_flag</span>])
873:     <span class="ruby-ivar">@selected_options</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:selected_options</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span>[] <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:selected_options</span>]
874:     <span class="ruby-ivar">@selected_options</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:selected_values</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:selected_values</span>].<span class="ruby-identifier">nil?</span>
875:     <span class="ruby-ivar">@screens</span> = <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">screen_combined_screens</span>()
876:     <span class="ruby-ivar">@size</span> = <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">screen_combined_screen_group_ids</span>.<span class="ruby-identifier">size</span>
877:     <span class="ruby-ivar">@is_group</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:is_group</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">false</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">eval</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:is_group</span>])
878:     <span class="ruby-identifier">last_selected</span> = <span class="ruby-operator">!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:last_selected</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/true/i</span>).<span class="ruby-identifier">nil?</span>
879:     <span class="ruby-identifier">options</span> = <span class="ruby-ivar">@field</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">options</span>(<span class="ruby-ivar">@row</span>, <span class="ruby-ivar">@field</span>, <span class="ruby-ivar">@selected_options</span>,<span class="ruby-operator">!</span><span class="ruby-identifier">last_selected</span> )
880:     <span class="ruby-ivar">@available_options</span> = [<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:available_options</span>]]
881:     <span class="ruby-ivar">@selected_row</span> = [<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:selected_row</span>]]
882:     <span class="ruby-ivar">@relate_model_rows</span> = [<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:selected_row</span>]]
883: 
884:     <span class="ruby-ivar">@scr_row</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:scr_row_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:scr_row_id</span>].<span class="ruby-identifier">to_i</span>) <span class="ruby-comment cmt"># CB</span>
885: 
886:     <span class="ruby-identifier">ocr_field</span> = <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">CodeCombindedReference</span>.<span class="ruby-identifier">field_ocr_field_id</span>(<span class="ruby-ivar">@field</span>.<span class="ruby-identifier">value</span>))
887:     <span class="ruby-identifier">scr_field</span> = <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">OptionCombindedReference</span>.<span class="ruby-identifier">field_scr_field_id</span>(<span class="ruby-identifier">ocr_field</span>.<span class="ruby-identifier">value</span>))
888:     <span class="ruby-identifier">scr_row_cell_value</span> = <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">scr_field</span>.<span class="ruby-identifier">custom_field_id</span>).<span class="ruby-identifier">value</span>
889:     <span class="ruby-identifier">screen_used_as_multiply_count_index</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">ScreenCombindedReference</span>.<span class="ruby-identifier">screen_used_as_multiply_count_index</span>(<span class="ruby-identifier">scr_row_cell_value</span>)
890:     <span class="ruby-identifier">counter_row_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:counter_row_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-identifier">screen_used_as_multiply_count_index</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@selected_options</span>.<span class="ruby-identifier">size</span> <span class="ruby-value">? </span><span class="ruby-ivar">@selected_options</span>[<span class="ruby-identifier">screen_used_as_multiply_count_index</span>] <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:counter_row_id</span>].<span class="ruby-identifier">to_i</span>
891:     <span class="ruby-ivar">@counter_row</span> = <span class="ruby-identifier">counter_row_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">counter_row_id</span>) <span class="ruby-comment cmt"># 2,3,4</span>
892:     <span class="ruby-ivar">@count</span> = <span class="ruby-ivar">@counter_row</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:count</span>] <span class="ruby-operator">:</span> <span class="ruby-ivar">@counter_row</span>.<span class="ruby-identifier">select_multiple_counter_from_descr</span>
893: 
894:     <span class="ruby-ivar">@group_index</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:group_index</span>].<span class="ruby-identifier">to_i</span>
895:     <span class="ruby-ivar">@group_series</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:group_series</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:group_series</span>].<span class="ruby-identifier">to_i</span>
896:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
897:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
898:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@count</span> }
899:     <span class="ruby-keyword kw">end</span>
900:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000416" class="method-detail">
        <a name="M000416"></a>

        <div class="method-heading">
          <a href="#M000416" class="method-signature">
          <span class="method-name">create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
POST /rows POST /rows.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000416-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000416-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 282</span>
282:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>
283:     <span class="ruby-identifier">date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-value str">&quot;%Y%m%d&quot;</span>)
284:     <span class="ruby-identifier">time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-value str">&quot;%H:%M:%S&quot;</span>)
285:     <span class="ruby-identifier">screen</span> = <span class="ruby-constant">Screen</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:screen_id</span>])
286:     <span class="ruby-identifier">fulllog_value</span> = {}
287: 
288:     <span class="ruby-identifier">row_attr</span> = {}
289:     <span class="ruby-identifier">row_attr</span>[<span class="ruby-identifier">:screen_id</span>] = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:screen_id</span>)
290:     <span class="ruby-identifier">row_attr</span>[<span class="ruby-identifier">:remark</span>] = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:remark</span>)
291:     <span class="ruby-ivar">@form_content_reuse</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:form_content_reuse</span>]
292: 
293:     <span class="ruby-identifier">row_model</span> = <span class="ruby-node">&quot;#{params[:type]}&quot;</span>.<span class="ruby-identifier">classify</span>.<span class="ruby-identifier">constantize</span>
294:     <span class="ruby-ivar">@row</span> = <span class="ruby-identifier">row_model</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">row_attr</span>)
295: 
296:     <span class="ruby-identifier">cells</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:cells</span>) <span class="ruby-operator">||</span> {}
297: 
298:     <span class="ruby-comment cmt"># Get the binary data of the uploaded file</span>
299:     <span class="ruby-comment cmt">#~ ToDo: Get the binary data for multiple the uploaded files</span>
300:     <span class="ruby-identifier">file</span> = <span class="ruby-identifier">cells</span>[<span class="ruby-identifier">params</span>[<span class="ruby-value str">'custom_field_id_of_file'</span>]]
301:     <span class="ruby-identifier">cells</span>[<span class="ruby-identifier">params</span>[<span class="ruby-value str">'custom_field_id_of_file'</span>]] = <span class="ruby-constant">Upload</span>.<span class="ruby-identifier">file_save</span>(<span class="ruby-identifier">file</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">file</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">empty?</span>
302: 
303:     <span class="ruby-comment cmt"># Force saving cells for searchable field</span>
304:     <span class="ruby-identifier">field_ids_of_searchable</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:field_ids_of_searchable</span>]
305:     <span class="ruby-identifier">field_ids_of_searchable</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f_id</span><span class="ruby-operator">|</span>
306:       <span class="ruby-identifier">cells</span>[<span class="ruby-node">&quot;#{f_id}&quot;</span>] = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;screen_quick_search_text_#{f_id}&quot;</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">empty?</span>
307:     <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">field_ids_of_searchable</span>.<span class="ruby-identifier">nil?</span>
308:     
309:     <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field_id</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
310:       <span class="ruby-identifier">cell</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:field_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">field_id</span>, <span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">value</span>)
311:       <span class="ruby-identifier">custom_filed</span> = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">field_id</span>)
312: 
313:       <span class="ruby-identifier">fulllog_value</span>[<span class="ruby-identifier">field_id</span>.<span class="ruby-identifier">to_i</span>] = <span class="ruby-identifier">change_type_of_value</span>(<span class="ruby-identifier">custom_filed</span>, <span class="ruby-identifier">cell</span>)
314: 
315:       <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">cells</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cell</span>
316:       <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">load_cell_hash</span>(<span class="ruby-identifier">cell</span>)
317:     <span class="ruby-keyword kw">end</span>
318:     
319:     <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
320:       <span class="ruby-identifier">date_time_range</span> = {}
321:       <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
322:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">field</span>
323:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">AutoNumbering</span>
324:           <span class="ruby-identifier">auto_numbering_text</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">AutoNumbering</span>.<span class="ruby-identifier">increase</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">field_id</span>, <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">cells</span>)
325:           <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">AutoNumbering</span>.<span class="ruby-identifier">set_cell_text</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>, <span class="ruby-identifier">auto_numbering_text</span>)
326:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Calendar</span>
327:           <span class="ruby-identifier">null_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">null_date</span>
328:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">monthly_format?</span>
329:             <span class="ruby-identifier">selected_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:year</span>].<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">null_date</span>.<span class="ruby-identifier">month</span>, <span class="ruby-identifier">null_date</span>.<span class="ruby-identifier">day</span>)
330:             <span class="ruby-identifier">selected_date</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">DateTimeField</span>.<span class="ruby-identifier">begin_of_period</span>(<span class="ruby-identifier">selected_date</span>, <span class="ruby-identifier">:year</span>)
331:             <span class="ruby-identifier">new_hash</span> = {<span class="ruby-identifier">:selected_date</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">selected_date</span>.<span class="ruby-identifier">to_date</span>.<span class="ruby-identifier">to_s</span>}
332:             <span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-identifier">new_hash</span>)
333:           <span class="ruby-keyword kw">end</span>
334:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">DateTimeRange</span>
335:           <span class="ruby-identifier">date_time_range</span> = {<span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:from</span>], <span class="ruby-identifier">:to</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:to</span>]}
336:           <span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span> = <span class="ruby-keyword kw">nil</span>
337:         <span class="ruby-keyword kw">end</span>
338:       <span class="ruby-keyword kw">end</span>
339: 
340:       <span class="ruby-comment cmt"># ToDo: Move this code to a client base code</span>
341:       <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">auto_close_new_visit_action</span>(<span class="ruby-identifier">screen</span>, <span class="ruby-identifier">cells</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">client_code</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/susbkk/</span>
342: 
343:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">save</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">all?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span> }
344:         <span class="ruby-identifier">save_full_log</span> <span class="ruby-identifier">:created</span>, <span class="ruby-value">1</span>, <span class="ruby-identifier">fulllog_value</span>
345: 
346:         <span class="ruby-comment cmt"># ToDo: Move this code to a client base code</span>
347:         <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">set_customer_first_p_o</span>(<span class="ruby-identifier">screen</span>, <span class="ruby-identifier">cells</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">client_code</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/susbkk/</span>
348: 
349:         <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
350:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">field</span>
351:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Calendar</span>
352:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">monthly_format?</span>
353:               <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Calendar</span>.<span class="ruby-identifier">create_detail_rows</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:selected_date</span>], <span class="ruby-identifier">c</span>.<span class="ruby-identifier">field</span>.<span class="ruby-identifier">detail_screen</span>.<span class="ruby-identifier">id</span>)
354:             <span class="ruby-keyword kw">end</span>
355:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">DateTimeRange</span>
356:             <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">DateTimeRange</span>.<span class="ruby-identifier">create_date_time_range_values</span>(<span class="ruby-identifier">c</span>, <span class="ruby-identifier">date_time_range</span>)
357:           <span class="ruby-keyword kw">end</span>
358:         <span class="ruby-keyword kw">end</span>
359:         
360:       <span class="ruby-keyword kw">end</span>
361:     <span class="ruby-keyword kw">end</span>
362: 
363:     <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">reload_uncached_association</span>
364: 
365:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
366:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># create.html.erb</span>
367:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@row</span> }
368:     <span class="ruby-keyword kw">end</span>
369:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000417" class="method-detail">
        <a name="M000417"></a>

        <div class="method-heading">
          <a href="#M000417" class="method-signature">
          <span class="method-name">create_unsave_row</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
POST /rows POST /rows.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000417-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000417-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 373</span>
373:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_unsave_row</span>
374:     <span class="ruby-ivar">@row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:screen_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:screen_id</span>],<span class="ruby-identifier">:remark</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remark</span>].<span class="ruby-identifier">to_yaml</span>)
375:     <span class="ruby-ivar">@cells</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:cells</span>]
376:     <span class="ruby-ivar">@cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field_id</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
377:       <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:row_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:field_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">field_id</span>, <span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_yaml</span>)
378:     <span class="ruby-keyword kw">end</span>
379:     <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;rows&quot;</span>, <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;create&quot;</span>}
380:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000419" class="method-detail">
        <a name="M000419"></a>

        <div class="method-heading">
          <a href="#M000419" class="method-signature">
          <span class="method-name">destroy</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
DELETE /rows/1 DELETE /rows/1.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000419-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000419-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 524</span>
524:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy</span>
525:     <span class="ruby-ivar">@row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
526:     <span class="ruby-identifier">screen</span> = <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">screen</span>
527:     <span class="ruby-identifier">last_log</span> = <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">full_logs</span>.<span class="ruby-identifier">last</span>
528:     <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">destroy</span>
529: 
530:     <span class="ruby-identifier">log_seq_no</span> = <span class="ruby-identifier">last_log</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">last_log</span>.<span class="ruby-identifier">seq_no</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
531: 
532:     (<span class="ruby-identifier">save_full_log</span> <span class="ruby-identifier">:deleted</span>, <span class="ruby-identifier">log_seq_no</span>)
533:     
534:     <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">reload_uncached_association</span>
535: 
536:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
537:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># destroy.html.erb</span>
538:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@row</span> }
539:     <span class="ruby-keyword kw">end</span>
540:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000414" class="method-detail">
        <a name="M000414"></a>

        <div class="method-heading">
          <a href="#M000414" class="method-signature">
          <span class="method-name">edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
GET /rows/edit/1
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000414-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000414-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 242</span>
242:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit</span>
243:     <span class="ruby-ivar">@screen</span> = <span class="ruby-identifier">session</span>.<span class="ruby-identifier">active_screen</span>
244:     <span class="ruby-ivar">@action_source</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:action_source</span>]
245:     <span class="ruby-ivar">@filtered_reference</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:filtered_reference</span>] <span class="ruby-operator">||</span> {}
246:           <span class="ruby-ivar">@row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
247:     <span class="ruby-ivar">@pageno</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:pageno</span>]
248: 
249:     <span class="ruby-identifier">custom_field_ids</span> = []
250:     <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
251:       <span class="ruby-identifier">custom_field_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">custom_field_id</span>
252:     <span class="ruby-keyword kw">end</span>
253:     <span class="ruby-identifier">custom_field_ids</span>.<span class="ruby-identifier">compact!</span> <span class="ruby-comment cmt"># Custom_field_id of datainfo is alway null</span>
254:     <span class="ruby-comment cmt">#@gen_rows, @gen_values = gen_rows_by_fields_edit(@row,custom_field_ids)    </span>
255:     
256:     <span class="ruby-identifier">custom_fields</span> = <span class="ruby-identifier">custom_field_ids</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">cid</span><span class="ruby-operator">|</span> <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">cid</span>)}
257:     <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">cf</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@detail_screen_id</span> = <span class="ruby-identifier">cf</span>.<span class="ruby-identifier">detail_screen_id</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cf</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Calendar</span>) }
258:       
259:     <span class="ruby-ivar">@users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_active_users</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">has_loginfield?</span>
260:     <span class="ruby-ivar">@own_row</span> = <span class="ruby-keyword kw">true</span>
261:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">get_staff_ref_field_id</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
262:       <span class="ruby-ivar">@staff_row</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value str">'user'</span>].<span class="ruby-identifier">staff_row</span>
263:       <span class="ruby-ivar">@staff_ref_field_id</span> = <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">get_staff_ref_field_id</span>
264:       <span class="ruby-ivar">@own_row</span> = <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">belongs_to?</span>(<span class="ruby-ivar">@staff_row</span>.<span class="ruby-identifier">id</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@staff_row</span>
265:     <span class="ruby-keyword kw">end</span>
266:     <span class="ruby-ivar">@readonly</span> = <span class="ruby-operator">!</span><span class="ruby-ivar">@staff_row</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@row</span>.<span class="ruby-identifier">belongs_to?</span>(<span class="ruby-ivar">@staff_row</span>.<span class="ruby-identifier">id</span>)
267:     <span class="ruby-ivar">@readonly</span> <span class="ruby-operator">&amp;&amp;=</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@row</span>.<span class="ruby-identifier">screen</span>.<span class="ruby-identifier">allow_action?</span>(<span class="ruby-identifier">:edit</span>)
268:     
269:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
270:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># edit.html.erb</span>
271:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@row</span> }
272:     <span class="ruby-keyword kw">end</span>
273:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000421" class="method-detail">
        <a name="M000421"></a>

        <div class="method-heading">
          <a href="#M000421" class="method-signature">
          <span class="method-name">edit_header</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000421-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000421-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 547</span>
547:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_header</span>
548:     <span class="ruby-ivar">@row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
549:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000415" class="method-detail">
        <a name="M000415"></a>

        <div class="method-heading">
          <a href="#M000415" class="method-signature">
          <span class="method-name">edit_unsave_row</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
GET /rows/edit/1
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000415-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000415-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 276</span>
276:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_unsave_row</span>
277:     <span class="ruby-comment cmt">#</span>
278:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000420" class="method-detail">
        <a name="M000420"></a>

        <div class="method-heading">
          <a href="#M000420" class="method-signature">
          <span class="method-name">export</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000420-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000420-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 542</span>
542:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">export</span>
543:     <span class="ruby-comment cmt"># redirect to report controller</span>
544:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:controller=</span><span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;reports&quot;</span>, <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;export&quot;</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>], <span class="ruby-identifier">:action_source</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:action_source</span>]
545:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000411" class="method-detail">
        <a name="M000411"></a>

        <div class="method-heading">
          <a href="#M000411" class="method-signature">
          <span class="method-name">fetch_row</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
GET /rows/fetch_row/1 GET /rows/fetch_row/1.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000411-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000411-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 187</span>
187:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fetch_row</span>
188:     <span class="ruby-identifier">row_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>].<span class="ruby-identifier">to_i</span>
189: 
190:     <span class="ruby-ivar">@row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">row_id</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:cells</span>])
191: 
192:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">screen</span>.<span class="ruby-identifier">get_staff_ref_field_id</span>
193:       <span class="ruby-ivar">@staff_row</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value str">'user'</span>].<span class="ruby-identifier">staff_row</span>
194:     <span class="ruby-keyword kw">end</span>
195:     <span class="ruby-ivar">@readonly</span> = <span class="ruby-operator">!</span><span class="ruby-ivar">@staff_row</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@row</span>.<span class="ruby-identifier">belongs_to?</span>(<span class="ruby-ivar">@staff_row</span>.<span class="ruby-identifier">id</span>)
196: 
197:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
198:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># fetch_row.html.erb</span>
199:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@row</span> }
200:     <span class="ruby-keyword kw">end</span>
201:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000429" class="method-detail">
        <a name="M000429"></a>

        <div class="method-heading">
          <a href="#M000429" class="method-signature">
          <span class="method-name">gen_rows_by_fields</span><span class="method-args">(rows,custom_field_field_ids)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000429-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000429-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 736</span>
736:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">gen_rows_by_fields</span>(<span class="ruby-identifier">rows</span>,<span class="ruby-identifier">custom_field_field_ids</span>)
737:     <span class="ruby-identifier">gen_rows</span> = {}
738:     <span class="ruby-identifier">row_ids</span> = []
739:     <span class="ruby-identifier">cell_values</span> = []
740:     <span class="ruby-identifier">all_values</span> = {}
741:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">is_a?</span><span class="ruby-constant">Row</span>
742:       <span class="ruby-identifier">row_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">id</span>
743:     <span class="ruby-keyword kw">else</span>
744:       <span class="ruby-identifier">row_ids</span> = <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">id</span> }
745:     <span class="ruby-keyword kw">end</span>
746: 
747:     <span class="ruby-identifier">cells</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;row_id in (?) and field_id in (?)&quot;</span>, <span class="ruby-identifier">row_ids</span>, <span class="ruby-identifier">custom_field_field_ids</span>])
748:     <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
749:       <span class="ruby-identifier">cell_values</span> = []
750:       <span class="ruby-identifier">row_id</span> = <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">row_id</span>
751:       <span class="ruby-identifier">custom_field_id</span> = <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">field_id</span>
752:       <span class="ruby-identifier">gen_rows</span>[<span class="ruby-identifier">row_id</span>] = {} <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">gen_rows</span>[<span class="ruby-identifier">row_id</span>].<span class="ruby-identifier">nil?</span>
753:       <span class="ruby-identifier">gen_rows</span>[<span class="ruby-identifier">row_id</span>][<span class="ruby-identifier">custom_field_id</span>] = <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;&amp;nbsp;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span>
754:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">HashWithIndifferentAccess</span>)
755:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
756:           <span class="ruby-identifier">cell_values</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> }.<span class="ruby-identifier">compact</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
757:         <span class="ruby-keyword kw">else</span>
758:           <span class="ruby-identifier">cell_values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
759:         <span class="ruby-keyword kw">end</span>
760:       <span class="ruby-keyword kw">end</span>
761:       <span class="ruby-identifier">all_values</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">gen_values</span>(<span class="ruby-identifier">cell_values</span>)) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cell_values</span> <span class="ruby-operator">!=</span> []
762:     <span class="ruby-keyword kw">end</span>
763:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">gen_rows</span>, <span class="ruby-identifier">all_values</span>
764:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000430" class="method-detail">
        <a name="M000430"></a>

        <div class="method-heading">
          <a href="#M000430" class="method-signature">
          <span class="method-name">gen_rows_by_fields_edit</span><span class="method-args">(rows,custom_field_field_ids)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000430-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000430-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 766</span>
766:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">gen_rows_by_fields_edit</span>(<span class="ruby-identifier">rows</span>,<span class="ruby-identifier">custom_field_field_ids</span>)
767:     <span class="ruby-identifier">gen_rows</span> = {}
768:     <span class="ruby-identifier">row_ids</span> = []
769:     <span class="ruby-identifier">cell_values</span> = []
770:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">is_a?</span><span class="ruby-constant">Row</span>
771:       <span class="ruby-identifier">row_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">id</span>
772:     <span class="ruby-keyword kw">else</span>
773:       <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span>  <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
774:         <span class="ruby-identifier">row_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">id</span>
775:       <span class="ruby-keyword kw">end</span>
776:     <span class="ruby-keyword kw">end</span>
777: 
778:     <span class="ruby-identifier">cells</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;row_id in (?) and field_id in (?)&quot;</span>, <span class="ruby-identifier">row_ids</span>, <span class="ruby-identifier">custom_field_field_ids</span>])
779:     <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
780:       <span class="ruby-identifier">row_id</span> = <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">row_id</span>
781:       <span class="ruby-identifier">custom_field_id</span> = <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">field_id</span>
782:       <span class="ruby-identifier">gen_rows</span>[<span class="ruby-identifier">row_id</span>] = {} <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">gen_rows</span>[<span class="ruby-identifier">row_id</span>].<span class="ruby-identifier">nil?</span>
783:       <span class="ruby-identifier">gen_rows</span>[<span class="ruby-identifier">row_id</span>][<span class="ruby-identifier">custom_field_id</span>] = <span class="ruby-identifier">cell</span>
784:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">HashWithIndifferentAccess</span>)
785:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
786:           <span class="ruby-identifier">cell_values</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> }.<span class="ruby-identifier">compact</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
787:         <span class="ruby-keyword kw">else</span>
788:           <span class="ruby-identifier">cell_values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
789:         <span class="ruby-keyword kw">end</span>
790:       <span class="ruby-keyword kw">end</span>
791:     <span class="ruby-keyword kw">end</span>
792:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">gen_rows</span>, <span class="ruby-identifier">gen_values</span>(<span class="ruby-identifier">cell_values</span>)
793:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000431" class="method-detail">
        <a name="M000431"></a>

        <div class="method-heading">
          <a href="#M000431" class="method-signature">
          <span class="method-name">gen_values</span><span class="method-args">(rows)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000431-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000431-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 795</span>
795:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">gen_values</span>(<span class="ruby-identifier">rows</span>)
796:     <span class="ruby-identifier">gen_rows</span> = {}
797:     <span class="ruby-identifier">cells</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;row_id in (?) and field_id = 186&quot;</span>, <span class="ruby-identifier">rows</span>])
798:     <span class="ruby-identifier">row_id</span> = <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;,&quot;</span>)
799:     <span class="ruby-identifier">gen_rows</span>[<span class="ruby-identifier">row_id</span>] = <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
800:       <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;&amp;nbsp;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">gen_rows</span>[<span class="ruby-identifier">row_id</span>].<span class="ruby-identifier">nil?</span>
801:     <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;, &quot;</span>)
802:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">gen_rows</span>
803:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000410" class="method-detail">
        <a name="M000410"></a>

        <div class="method-heading">
          <a href="#M000410" class="method-signature">
          <span class="method-name">index</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
GET /rows GET /rows.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000410-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000410-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 60</span>
 60:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">index</span>
 61:     <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:search_filter_info</span>] = {}
 62:     <span class="ruby-ivar">@row_pattern</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:row_pattern_id</span>].<span class="ruby-identifier">to_i</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:row_pattern_id</span>].<span class="ruby-identifier">nil?</span>
 63:     <span class="ruby-ivar">@row_ids</span> = []
 64:     <span class="ruby-ivar">@screen</span> = <span class="ruby-identifier">session</span>.<span class="ruby-identifier">active_screen</span>
 65:     <span class="ruby-ivar">@action_source</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:action_source</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;index&quot;</span>
 66:     <span class="ruby-ivar">@g_other</span> = <span class="ruby-constant">Label</span>.<span class="ruby-identifier">descr_by_name</span>(<span class="ruby-value str">&quot;G_Other&quot;</span>)
 67:     <span class="ruby-ivar">@filtered_reference</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:custom_fields</span>] <span class="ruby-operator">||</span> {}
 68:     <span class="ruby-identifier">rpp</span> = <span class="ruby-constant">ApplicationController</span>.<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">rows_per_page</span>
 69:     <span class="ruby-ivar">@pageno</span> = (<span class="ruby-operator">!</span><span class="ruby-ivar">@action_source</span>.<span class="ruby-identifier">include?</span><span class="ruby-value str">&quot;page_&quot;</span>) <span class="ruby-operator">?</span> <span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:pageno</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">&quot;/&quot;</span>,<span class="ruby-value str">&quot;&quot;</span>)
 70:     
 71:     <span class="ruby-identifier">display_flag_label</span> = <span class="ruby-constant">Label</span>.<span class="ruby-identifier">descr_by_name</span>(<span class="ruby-value str">&quot;G_List&quot;</span>)
 72:     <span class="ruby-ivar">@fields</span> = []
 73:     <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
 74:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">display_in_screen?</span>(<span class="ruby-identifier">display_flag_label</span>)
 75:         <span class="ruby-ivar">@fields</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">field</span>
 76:       <span class="ruby-keyword kw">end</span>
 77:     <span class="ruby-keyword kw">end</span>
 78:     
 79:     <span class="ruby-ivar">@readonly</span> = <span class="ruby-operator">!</span><span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">screen</span>.<span class="ruby-identifier">allow_action?</span>(<span class="ruby-identifier">:edit</span>)
 80: 
 81:     <span class="ruby-ivar">@filtered_reference</span>.<span class="ruby-identifier">delete_if</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
 82:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">value</span>
 83:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
 84:         <span class="ruby-identifier">value</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
 85:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span>
 86:         <span class="ruby-identifier">value</span>.<span class="ruby-identifier">delete_if</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'status'</span> }.<span class="ruby-identifier">empty?</span>
 87:       <span class="ruby-keyword kw">end</span>
 88:     <span class="ruby-keyword kw">end</span>
 89: 
 90:     <span class="ruby-keyword kw">case</span> <span class="ruby-ivar">@action_source</span>
 91:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;index&quot;</span>
 92:       <span class="ruby-identifier">options</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">filter_by_custom_fields</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>].<span class="ruby-identifier">to_i</span>, {}, <span class="ruby-value str">&quot;index&quot;</span>, <span class="ruby-keyword kw">false</span>)
 93: 
 94:       <span class="ruby-ivar">@row_ids</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:filtered_row_ids</span>]
 95:       <span class="ruby-ivar">@row_pattern</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:row_pattern_id</span>]) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:row_pattern_id</span>].<span class="ruby-identifier">nil?</span>
 96:       <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:sort_field_id_order</span>] = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:sort_field_id_order</span>]
 97:       <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:filtered_reference</span>] = <span class="ruby-ivar">@filtered_reference</span>
 98:       <span class="ruby-constant">RowsController</span>.<span class="ruby-identifier">store_session_row_ids</span>(<span class="ruby-identifier">session</span>.<span class="ruby-identifier">session_id</span>, <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">id</span>, <span class="ruby-ivar">@row_ids</span>)
 99:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;search&quot;</span>, <span class="ruby-value str">&quot;page_search&quot;</span>, <span class="ruby-value str">&quot;page_index&quot;</span>, <span class="ruby-value str">&quot;relations&quot;</span>     
100:     
101:       <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:search_filter_info</span>] = {}
102:       <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:custom_fields</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-ivar">@filtered_reference</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:filtered_reference</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:filtered_reference</span>] = <span class="ruby-ivar">@filtered_reference</span>
103:       
104:       <span class="ruby-ivar">@filtered_reference</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">other</span><span class="ruby-operator">|</span>
105:         <span class="ruby-identifier">fieldName</span> = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">key</span>).<span class="ruby-identifier">name</span>
106:         <span class="ruby-identifier">fieldType</span> = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">key</span>).<span class="ruby-identifier">type</span>
107:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">fieldType</span>
108:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;CustomFields::TextField&quot;</span>
109:           <span class="ruby-identifier">fieldValue</span> = <span class="ruby-identifier">other</span>
110:           <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:search_filter_info</span>][<span class="ruby-identifier">fieldName</span>] = <span class="ruby-identifier">fieldValue</span>
111:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;CustomFields::Reference&quot;</span>
112:           <span class="ruby-identifier">fieldValue</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:row_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">values</span>}).<span class="ruby-identifier">value</span>
113:           <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:search_filter_info</span>][<span class="ruby-identifier">fieldName</span>] = <span class="ruby-identifier">fieldValue</span>
114:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;CustomFields::DateTimeField&quot;</span>
115:           <span class="ruby-identifier">count</span> = <span class="ruby-identifier">other</span>.<span class="ruby-identifier">length</span>
116:           <span class="ruby-identifier">i</span>=<span class="ruby-value">0</span>
117:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">i</span> <span class="ruby-keyword kw">in</span> <span class="ruby-value">0</span><span class="ruby-operator">..</span>(<span class="ruby-identifier">count</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>)
118:             <span class="ruby-identifier">fieldDate</span> = <span class="ruby-identifier">other</span>.<span class="ruby-identifier">keys</span>[<span class="ruby-identifier">i</span>]
119:             <span class="ruby-identifier">fieldValue</span> = <span class="ruby-identifier">other</span>.<span class="ruby-identifier">values</span>[<span class="ruby-identifier">i</span>]
120:             <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:search_filter_info</span>][<span class="ruby-identifier">fieldDate</span>] = <span class="ruby-identifier">fieldValue</span>
121:           <span class="ruby-keyword kw">end</span>
122:         <span class="ruby-keyword kw">else</span>
123:           <span class="ruby-identifier">fieldValue</span> = <span class="ruby-identifier">other</span>
124:           <span class="ruby-identifier">a</span>=<span class="ruby-value">10</span>
125:         <span class="ruby-keyword kw">end</span>
126:       <span class="ruby-keyword kw">end</span>
127: 
128: 
129:       <span class="ruby-identifier">screen_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:request_id</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">id</span>
130:       <span class="ruby-identifier">purge</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:request_id</span>].<span class="ruby-identifier">nil?</span>
131:       <span class="ruby-ivar">@row_ids</span> = <span class="ruby-constant">RowsController</span>.<span class="ruby-identifier">get_session_row_ids</span>(<span class="ruby-identifier">session</span>.<span class="ruby-identifier">session_id</span>, <span class="ruby-identifier">screen_id</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">purge</span>)
132: 
133:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:sort_field_id</span>)
134:         <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:sort_field_id_order</span>] = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">reorder_field_sorting</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:sort_field_id_order</span>], <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sort_field_id</span>])
135:         
136:         <span class="ruby-ivar">@row_ids</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">sort</span>(<span class="ruby-ivar">@row_ids</span>, <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:sort_field_id_order</span>])
137:         
138:         <span class="ruby-constant">RowsController</span>.<span class="ruby-identifier">store_session_row_ids</span>(<span class="ruby-identifier">session</span>.<span class="ruby-identifier">session_id</span>, <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">id</span>, <span class="ruby-ivar">@row_ids</span>)
139:       <span class="ruby-keyword kw">end</span>
140:     <span class="ruby-keyword kw">end</span>
141:     
142:     <span class="ruby-ivar">@sort_field_id_order</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:sort_field_id_order</span>]
143: 
144:     <span class="ruby-ivar">@row_ids</span> <span class="ruby-operator">||=</span> []
145:     
146:     <span class="ruby-ivar">@row_count</span> = <span class="ruby-ivar">@row_ids</span>.<span class="ruby-identifier">size</span>
147: 
148:     <span class="ruby-comment cmt">#Page generator</span>
149:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@action_source</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;relations&quot;</span>
150:       <span class="ruby-identifier">pageno_from</span>, <span class="ruby-identifier">pageno_to</span> = <span class="ruby-value">0</span>, <span class="ruby-value">4</span>
151:     <span class="ruby-keyword kw">else</span>
152:       <span class="ruby-identifier">pageno_from</span> = (<span class="ruby-identifier">rpp</span><span class="ruby-operator">*</span>(<span class="ruby-ivar">@pageno</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>))
153:       <span class="ruby-identifier">pageno_to</span> = ((<span class="ruby-identifier">rpp</span><span class="ruby-operator">*</span><span class="ruby-ivar">@pageno</span>.<span class="ruby-identifier">to_i</span>)<span class="ruby-operator">-</span><span class="ruby-value">1</span>)
154: 
155:       <span class="ruby-ivar">@maxpage</span> = (<span class="ruby-ivar">@row_count</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">rpp</span>).<span class="ruby-identifier">ceil</span>
156:     <span class="ruby-keyword kw">end</span>
157:     
158:     <span class="ruby-ivar">@row_ids</span> = <span class="ruby-ivar">@row_ids</span>[<span class="ruby-identifier">pageno_from</span><span class="ruby-operator">..</span><span class="ruby-identifier">pageno_to</span>] <span class="ruby-operator">||</span> []
159:     
160:     <span class="ruby-ivar">@rows</span> = <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">rows</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
161:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {
162:         <span class="ruby-identifier">:rows</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@row_ids</span> }
163:       }
164:     )
165: 
166:     <span class="ruby-ivar">@rows</span>.<span class="ruby-identifier">sort!</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@row_ids</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">a</span>.<span class="ruby-identifier">id</span>) <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-ivar">@row_ids</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">b</span>.<span class="ruby-identifier">id</span>)}
167: 
168:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">get_staff_ref_field_id</span>
169:       <span class="ruby-ivar">@staff_row</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value str">'user'</span>].<span class="ruby-identifier">staff_row</span>
170:     <span class="ruby-keyword kw">end</span>
171: 
172:     <span class="ruby-comment cmt">#~ ToDo: Push all code to the Row model</span>
173:     <span class="ruby-comment cmt"># Onlt the @screen and @rows should be used to</span>
174:     <span class="ruby-comment cmt"># render the view</span>
175:     <span class="ruby-comment cmt"># </span>
176:     <span class="ruby-comment cmt"># @screen = Screen.find(params[:screen_id])</span>
177:     <span class="ruby-comment cmt"># @rows = Row.find_index(params)</span>
178: 
179:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
180:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># index.html.erb</span>
181:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@rows</span> }
182:     <span class="ruby-keyword kw">end</span>
183:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000413" class="method-detail">
        <a name="M000413"></a>

        <div class="method-heading">
          <a href="#M000413" class="method-signature">
          <span class="method-name">new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
GET /rows/new GET /rows/new.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000413-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000413-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 221</span>
221:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new</span>
222:     <span class="ruby-ivar">@sort_field_id_order</span> = []
223:     <span class="ruby-ivar">@screen</span> = <span class="ruby-constant">Screen</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
224:     <span class="ruby-ivar">@users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_active_users</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">has_loginfield?</span>
225:           <span class="ruby-ivar">@action_source</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:action_source</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;index&quot;</span>
226:           <span class="ruby-ivar">@filtered_reference</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:filtered_reference</span>] <span class="ruby-operator">||</span> {}
227:           <span class="ruby-identifier">row_model</span> = <span class="ruby-node">&quot;#{@screen.prefix}_row&quot;</span>.<span class="ruby-identifier">classify</span>.<span class="ruby-identifier">constantize</span>
228:           <span class="ruby-ivar">@row</span> = <span class="ruby-identifier">row_model</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:screen_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">row_model</span>)
229:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">get_staff_ref_field_id</span>
230:       <span class="ruby-ivar">@staff_row</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value str">'user'</span>].<span class="ruby-identifier">staff_row</span>
231:       <span class="ruby-ivar">@staff_ref_field_id</span> = <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">get_staff_ref_field_id</span>
232:     <span class="ruby-keyword kw">end</span>
233:     <span class="ruby-ivar">@gen_rows</span> = <span class="ruby-keyword kw">nil</span>
234: 
235:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
236:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># new.html.erb</span>
237:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@row</span> }
238:     <span class="ruby-keyword kw">end</span>
239:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000422" class="method-detail">
        <a name="M000422"></a>

        <div class="method-heading">
          <a href="#M000422" class="method-signature">
          <span class="method-name">new_header</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000422-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000422-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 551</span>
551:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new_header</span>
552:     <span class="ruby-ivar">@screen</span> = <span class="ruby-identifier">session</span>.<span class="ruby-identifier">active_screen</span>
553:     <span class="ruby-ivar">@row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:screen_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">id</span>)
554:     <span class="ruby-ivar">@cell</span> = [] <span class="ruby-comment cmt">#=&gt; declare for using &quot;&gt;&gt;&quot; syntax</span>
555:     <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
556:       <span class="ruby-ivar">@cell</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:field_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field_id</span>)
557:     <span class="ruby-keyword kw">end</span>
558:           
559:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
560:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># new.html.erb</span>
561:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@row</span> }
562:     <span class="ruby-keyword kw">end</span>
563:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000432" class="method-detail">
        <a name="M000432"></a>

        <div class="method-heading">
          <a href="#M000432" class="method-signature">
          <span class="method-name">option_combined_reference</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000432-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000432-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 805</span>
805:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">option_combined_reference</span>()
806:     <span class="ruby-comment cmt"># filter master data with product type?</span>
807:     <span class="ruby-ivar">@scr_row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:row_id</span>].<span class="ruby-identifier">to_i</span>)
808:     <span class="ruby-ivar">@field</span> = <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:field_id</span>].<span class="ruby-identifier">to_i</span>)
809: 
810:     <span class="ruby-ivar">@screen_options</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">ScreenCombindedReference</span>.<span class="ruby-identifier">screen_combined_reference_rows</span>(<span class="ruby-ivar">@scr_row</span>)
811:     
812:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
813:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
814:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@screens</span> }
815:     <span class="ruby-keyword kw">end</span>
816:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000433" class="method-detail">
        <a name="M000433"></a>

        <div class="method-heading">
          <a href="#M000433" class="method-signature">
          <span class="method-name">option_combined_reference_group</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000433-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000433-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 818</span>
818:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">option_combined_reference_group</span>()
819:     <span class="ruby-comment cmt"># row_id =&gt; count</span>
820:     <span class="ruby-comment cmt"># group_row_id =&gt; group</span>
821:     <span class="ruby-identifier">row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:row_id</span>].<span class="ruby-identifier">to_i</span>)
822:     <span class="ruby-identifier">group_row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:group_row_id</span>].<span class="ruby-identifier">to_i</span>)
823:     <span class="ruby-ivar">@index</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:index</span>].<span class="ruby-identifier">to_i</span>
824:     <span class="ruby-ivar">@field</span> = <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:field_id</span>].<span class="ruby-identifier">to_i</span>)
825:     <span class="ruby-ivar">@count</span> =  <span class="ruby-identifier">row</span>.<span class="ruby-identifier">select_multiple_counter_from_descr</span>
826:     <span class="ruby-ivar">@screen_options</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">ScreenCombindedReference</span>.<span class="ruby-identifier">screen_combined_reference_rows</span>(<span class="ruby-identifier">group_row</span>)
827: 
828:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
829:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
830:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@screens</span> }
831:     <span class="ruby-keyword kw">end</span>
832:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000437" class="method-detail">
        <a name="M000437"></a>

        <div class="method-heading">
          <a href="#M000437" class="method-signature">
          <span class="method-name">parameter</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000437-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000437-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 934</span>
934:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parameter</span>()
935:     <span class="ruby-ivar">@field</span> = <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:field_id</span>].<span class="ruby-identifier">to_i</span>)
936:     <span class="ruby-identifier">date_value</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:date_value</span>]
937: 
938:     <span class="ruby-ivar">@result_value</span> = <span class="ruby-ivar">@field</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">evaluate_value</span>(<span class="ruby-identifier">date_value</span>)
939:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
940:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
941:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@field</span> }
942:     <span class="ruby-keyword kw">end</span>
943:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000408" class="method-detail">
        <a name="M000408"></a>

        <div class="method-heading">
          <a href="#M000408" class="method-signature">
          <span class="method-name">permission_mapping</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000408-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000408-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 41</span>
41:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">permission_mapping</span>
42:     <span class="ruby-keyword kw">super</span>.<span class="ruby-identifier">merge</span>(
43:       {
44:         <span class="ruby-value str">'reference_attribute'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'index'</span>,
45:         <span class="ruby-value str">'option_combined_reference'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'edit'</span>,
46:         <span class="ruby-value str">'option_combined_reference_group'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'edit'</span>,
47:         <span class="ruby-value str">'code_combined_reference'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'edit'</span>,
48:         <span class="ruby-value str">'code_combined_reference_group'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'edit'</span>,
49:         <span class="ruby-value str">'parameter'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'index'</span>
50:       }
51:     )
52:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000439" class="method-detail">
        <a name="M000439"></a>

        <div class="method-heading">
          <a href="#M000439" class="method-signature">
          <span class="method-name">print</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000439-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000439-source">
<pre>
      <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 953</span>
 953:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">print</span>
 954:     <span class="ruby-comment cmt">#    @screen = session.active_screen</span>
 955:     <span class="ruby-ivar">@screen</span> = <span class="ruby-constant">Screen</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
 956:     <span class="ruby-ivar">@row_ids</span> = <span class="ruby-constant">RowsController</span>.<span class="ruby-identifier">get_session_row_ids</span>(<span class="ruby-identifier">session</span>.<span class="ruby-identifier">session_id</span>, <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">id</span>, <span class="ruby-keyword kw">true</span>)
 957:     <span class="ruby-ivar">@action_source</span> = <span class="ruby-value str">&quot;print&quot;</span>
 958:     <span class="ruby-comment cmt">#    @g_other = Label.descr_by_name(&quot;G_Other&quot;)</span>
 959:     <span class="ruby-comment cmt">#    @filtered_reference = params[:custom_fields] || {}</span>
 960: 
 961:     <span class="ruby-ivar">@current_user</span> = <span class="ruby-constant">ApplicationController</span>.<span class="ruby-identifier">current_user</span>
 962: 
 963:     <span class="ruby-comment cmt">#     rpp = ApplicationController.current_user.rows_per_page</span>
 964:     <span class="ruby-comment cmt">#     @pageno = (!@action_source.include?&quot;page_&quot;) ? 1 : params[:pageno].gsub(&quot;/&quot;,&quot;&quot;)</span>
 965: 
 966:     <span class="ruby-identifier">display_flag_label</span> = <span class="ruby-constant">Label</span>.<span class="ruby-identifier">descr_by_name</span>(<span class="ruby-value str">&quot;G_List&quot;</span>)
 967:     <span class="ruby-ivar">@fields</span> = []
 968:     <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
 969:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">display_in_screen?</span>(<span class="ruby-identifier">display_flag_label</span>)
 970:         <span class="ruby-ivar">@fields</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">field</span>
 971:       <span class="ruby-keyword kw">end</span>
 972:     <span class="ruby-keyword kw">end</span>
 973: 
 974:     <span class="ruby-comment cmt">#    options = Row.filter_by_custom_fields(params[:id].to_i, {}, &quot;index&quot;, false)</span>
 975:     <span class="ruby-comment cmt">#</span>
 976:     <span class="ruby-comment cmt">#    @row_ids = options[:filtered_row_ids]</span>
 977:     <span class="ruby-comment cmt">#    session[:sort_field_id_order] = options[:sort_field_id_order]</span>
 978:     <span class="ruby-comment cmt">#</span>
 979:     <span class="ruby-comment cmt">#    RowsController.store_session_row_ids(session.session_id, @screen.id, @row_ids)</span>
 980:     <span class="ruby-comment cmt">#</span>
 981:     <span class="ruby-ivar">@sort_field_id_order</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:sort_field_id_order</span>]
 982:     <span class="ruby-comment cmt">#    @row_ids ||= []</span>
 983: 
 984:     <span class="ruby-comment cmt">#     @row_count = @row_ids.size</span>
 985: 
 986: 
 987:     <span class="ruby-comment cmt">#    pageno_from = (rpp*(@pageno.to_i-1))</span>
 988:     <span class="ruby-comment cmt">#    pageno_to = ((rpp*@pageno.to_i)-1)</span>
 989:     <span class="ruby-comment cmt">#</span>
 990:     <span class="ruby-comment cmt">#    @maxpage = (@row_count.to_f / rpp).ceil</span>
 991: 
 992:     <span class="ruby-comment cmt">#    @row_ids = @row_ids[pageno_from..pageno_to] || []</span>
 993: 
 994:     <span class="ruby-ivar">@rows</span> = <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">rows</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
 995:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {
 996:         <span class="ruby-identifier">:rows</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@row_ids</span> }
 997:       }
 998:     )
 999: 
1000:     <span class="ruby-ivar">@rows</span>.<span class="ruby-identifier">sort!</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@row_ids</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">a</span>.<span class="ruby-identifier">id</span>) <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-ivar">@row_ids</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">b</span>.<span class="ruby-identifier">id</span>)}
1001: 
1002:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
1003:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># print.html.erb</span>
1004:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@rows</span> }
1005:     <span class="ruby-keyword kw">end</span>
1006:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000426" class="method-detail">
        <a name="M000426"></a>

        <div class="method-heading">
          <a href="#M000426" class="method-signature">
          <span class="method-name">quick_add</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000426-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000426-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 665</span>
665:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">quick_add</span>
666:     <span class="ruby-comment cmt"># ToDo: Input values for the 'Mandetory' fields</span>
667:     <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Hard coded CustomField name 'name'&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">RAILS_ENV</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/susbkk/</span>
668: 
669:     <span class="ruby-ivar">@custom_field_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:custom_field_id</span>]
670:     <span class="ruby-ivar">@screen</span> = <span class="ruby-constant">Screen</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:screen_id</span>])
671:     <span class="ruby-ivar">@name_value</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:value</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
672:     <span class="ruby-ivar">@result_row_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:result_row_id</span>]
673:     <span class="ruby-identifier">name_cf</span> = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;name = ?&quot;</span>, <span class="ruby-value str">&quot;name&quot;</span>])
674:     <span class="ruby-identifier">row_model</span> = <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">&quot;Screen&quot;</span>, <span class="ruby-value str">&quot;Row&quot;</span>).<span class="ruby-identifier">constantize</span>
675:     <span class="ruby-identifier">row</span> = <span class="ruby-identifier">row_model</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:screen_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:remark</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&quot;</span>)
676:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">save</span>
677:       <span class="ruby-identifier">row_id</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">id</span>
678:       <span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
679:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fields</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>)
680:           <span class="ruby-identifier">cf_id</span> = <span class="ruby-identifier">field</span>.<span class="ruby-identifier">custom_field_id</span>
681:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cf_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">name_cf</span>.<span class="ruby-identifier">id</span>
682:             <span class="ruby-ivar">@cell</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:row_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">row_id</span>, <span class="ruby-identifier">:field_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cf_id</span>, <span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@name_value</span>)
683:           <span class="ruby-keyword kw">else</span>
684:             <span class="ruby-ivar">@cell</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:row_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">row_id</span>, <span class="ruby-identifier">:field_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cf_id</span>, <span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&quot;</span>)
685:           <span class="ruby-keyword kw">end</span>
686:           <span class="ruby-ivar">@cell</span>.<span class="ruby-identifier">save</span>
687:         <span class="ruby-keyword kw">end</span>
688:       <span class="ruby-keyword kw">end</span>
689:       <span class="ruby-ivar">@cell</span>.<span class="ruby-identifier">value</span> = <span class="ruby-identifier">row_id</span>.<span class="ruby-identifier">to_s</span>
690:     <span class="ruby-keyword kw">end</span>
691:     
692:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
693:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
694:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">row</span> }
695:     <span class="ruby-keyword kw">end</span>
696:     
697:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000427" class="method-detail">
        <a name="M000427"></a>

        <div class="method-heading">
          <a href="#M000427" class="method-signature">
          <span class="method-name">quick_search</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000427-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000427-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 699</span>
699:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">quick_search</span>
700:       
701:     <span class="ruby-identifier">screen</span> = <span class="ruby-constant">Screen</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:screen_id</span>].<span class="ruby-identifier">to_i</span>)
702:     <span class="ruby-identifier">text</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:text</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>
703:     <span class="ruby-ivar">@result</span> = <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">find_by_row_desctiption</span>(<span class="ruby-identifier">text</span>, <span class="ruby-ivar">@@user</span>[<span class="ruby-identifier">:login</span>])
704:     <span class="ruby-ivar">@input_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:input_id</span>].<span class="ruby-identifier">to_s</span>
705:     <span class="ruby-ivar">@result_row_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:result_row_id</span>]
706:     <span class="ruby-ivar">@relate_to</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:relate_to</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
707:     <span class="ruby-ivar">@from_cf_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:from_cf_id</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
708:     <span class="ruby-ivar">@field</span> = <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:field_id</span>].<span class="ruby-identifier">to_i</span>)
709:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
710:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
711:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@rows</span> }
712:     <span class="ruby-keyword kw">end</span>
713:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000436" class="method-detail">
        <a name="M000436"></a>

        <div class="method-heading">
          <a href="#M000436" class="method-signature">
          <span class="method-name">reference_attribute</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000436-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000436-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 902</span>
902:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reference_attribute</span>
903:     <span class="ruby-ivar">@field</span> = <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:field_id</span>].<span class="ruby-identifier">to_i</span>)
904:     <span class="ruby-identifier">source_field</span> = <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:source_field_id</span>].<span class="ruby-identifier">to_i</span>)
905:     <span class="ruby-identifier">row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:row_id</span>].<span class="ruby-identifier">to_i</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:row_id</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
906:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@field</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fields</span><span class="ruby-operator">::</span><span class="ruby-constant">ReferenceAttribute</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">row</span>.<span class="ruby-identifier">nil?</span>
907:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">source_field</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fields</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span>)
908:         <span class="ruby-identifier">cell</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">source_field</span>.<span class="ruby-identifier">custom_field_id</span>)
909:         <span class="ruby-ivar">@result_value</span> = <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">to_html</span>
910:       <span class="ruby-keyword kw">else</span>
911:         <span class="ruby-ivar">@result_value</span> = <span class="ruby-identifier">source_field</span>.<span class="ruby-identifier">evaluate_value</span>(<span class="ruby-identifier">row</span>)
912:       <span class="ruby-keyword kw">end</span>
913:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@field</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fields</span><span class="ruby-operator">::</span><span class="ruby-constant">CodeCombindedReferenceAttribute</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">row</span>.<span class="ruby-identifier">nil?</span>
914:       <span class="ruby-identifier">active_field</span> = <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:active_field_id</span>].<span class="ruby-identifier">to_i</span>) <span class="ruby-comment cmt">#ccr_field</span>
915:       <span class="ruby-ivar">@selected_options</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:selected_options</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span>[] <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:selected_options</span>]
916:       <span class="ruby-ivar">@selected_options</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:selected_value</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:selected_value</span>].<span class="ruby-identifier">nil?</span>
917:       <span class="ruby-identifier">options</span> = <span class="ruby-identifier">active_field</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">options</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">active_field</span>, <span class="ruby-ivar">@selected_options</span>, <span class="ruby-keyword kw">false</span>)
918:       <span class="ruby-identifier">relate_model_rows</span> = []
919:       <span class="ruby-identifier">relate_model_rows</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:selected_row</span>]
920:       <span class="ruby-identifier">relate_model_rows</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">OptionCombindedReference</span>.<span class="ruby-identifier">related_model_rows</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:selected_row</span>], <span class="ruby-ivar">@selected_options</span>, <span class="ruby-identifier">active_field</span>.<span class="ruby-identifier">source_field</span>)
921:       <span class="ruby-ivar">@result_value</span> = <span class="ruby-value">0</span>
922:       <span class="ruby-identifier">relate_model_rows</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
923:         <span class="ruby-ivar">@result_value</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">source_field</span>.<span class="ruby-identifier">custom_field_id</span>).<span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">nil?</span>
924:       <span class="ruby-keyword kw">end</span>
925:     <span class="ruby-keyword kw">else</span>
926:       <span class="ruby-ivar">@result_value</span> = <span class="ruby-value str">&quot;&quot;</span>
927:     <span class="ruby-keyword kw">end</span>
928:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
929:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
930:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@field</span> }
931:     <span class="ruby-keyword kw">end</span>
932:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000425" class="method-detail">
        <a name="M000425"></a>

        <div class="method-heading">
          <a href="#M000425" class="method-signature">
          <span class="method-name">relations</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000425-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000425-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 645</span>
645:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">relations</span>
646:     <span class="ruby-identifier">screen</span> = <span class="ruby-constant">Screen</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:screen_id</span>].<span class="ruby-identifier">to_i</span>)
647:     <span class="ruby-ivar">@screens</span> = <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">dependencies</span>
648:   
649:     <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@screens</span>.<span class="ruby-identifier">empty?</span>
650:       <span class="ruby-ivar">@custom_fields</span> = {}
651:       <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">reference_custom_field_ids</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cf_id</span><span class="ruby-operator">|</span>
652:         <span class="ruby-ivar">@custom_fields</span>[<span class="ruby-identifier">cf_id</span>] = { <span class="ruby-identifier">:row_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>] }
653:       <span class="ruby-keyword kw">end</span>
654:       <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">scr_custom_fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">scr_cf</span><span class="ruby-operator">|</span>
655:         <span class="ruby-ivar">@custom_fields</span>[<span class="ruby-identifier">scr_cf</span>.<span class="ruby-identifier">id</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
656:       <span class="ruby-keyword kw">end</span>
657:     <span class="ruby-keyword kw">end</span>
658:       
659:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
660:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
661:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@screens</span> }
662:     <span class="ruby-keyword kw">end</span>
663:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000428" class="method-detail">
        <a name="M000428"></a>

        <div class="method-heading">
          <a href="#M000428" class="method-signature">
          <span class="method-name">reload_comboref</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000428-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000428-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 715</span>
715:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reload_comboref</span>
716:     <span class="ruby-ivar">@custom_field_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:custom_field_id</span>]
717:     <span class="ruby-identifier">cf</span> = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@custom_field_id</span>.<span class="ruby-identifier">to_i</span>)
718:     <span class="ruby-identifier">reference_row_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:value</span>].<span class="ruby-identifier">to_i</span>
719:     <span class="ruby-identifier">from_cf_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:from_cf_id</span>]
720:     <span class="ruby-identifier">filter_row_ids</span> = []
721:     <span class="ruby-identifier">cells</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
722:       <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:row</span>],
723:       <span class="ruby-identifier">:conditions</span>  =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot; rows.screen_id = ? and cells.field_id in (?) &quot;</span>,  <span class="ruby-identifier">cf</span>.<span class="ruby-identifier">screen_id</span> , <span class="ruby-identifier">from_cf_id</span>])
724:     <span class="ruby-identifier">filter_cells</span> = <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>.<span class="ruby-identifier">cell_ref_row_id</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">reference_row_id</span>}.<span class="ruby-identifier">compact</span>
725:     <span class="ruby-identifier">filter_cells</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">filter_row_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">row_id</span>}
726:       
727:     <span class="ruby-identifier">rows</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">filter_row_ids</span>)
728:     <span class="ruby-ivar">@results</span> = <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">sort</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">description</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">description</span>}
729:       
730:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
731:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
732:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@rows</span> }
733:     <span class="ruby-keyword kw">end</span>
734:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000438" class="method-detail">
        <a name="M000438"></a>

        <div class="method-heading">
          <a href="#M000438" class="method-signature">
          <span class="method-name">save_full_log</span><span class="method-args">(action, seq_no, value = {}, created_date = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000438-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000438-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 945</span>
945:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save_full_log</span> (<span class="ruby-identifier">action</span>, <span class="ruby-identifier">seq_no</span>, <span class="ruby-identifier">value</span> = {}, <span class="ruby-identifier">created_date</span> = <span class="ruby-keyword kw">nil</span>)
946:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">created_date</span>.<span class="ruby-identifier">nil?</span>
947:       <span class="ruby-constant">FullLog</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:row_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">action</span>, <span class="ruby-identifier">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">session</span>[<span class="ruby-value str">'user'</span>][<span class="ruby-value str">'login'</span>], <span class="ruby-identifier">:seq_no</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">seq_no</span>, <span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">value</span>).<span class="ruby-identifier">save</span>
948:     <span class="ruby-keyword kw">else</span>
949:       <span class="ruby-constant">FullLog</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:row_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">action</span>, <span class="ruby-identifier">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">session</span>[<span class="ruby-value str">'user'</span>][<span class="ruby-value str">'login'</span>], <span class="ruby-identifier">:seq_no</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">seq_no</span>, <span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">value</span>, <span class="ruby-identifier">:created_at</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">created_date</span> ).<span class="ruby-identifier">save</span>
950:     <span class="ruby-keyword kw">end</span>
951:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000409" class="method-detail">
        <a name="M000409"></a>

        <div class="method-heading">
          <a href="#M000409" class="method-signature">
          <span class="method-name">screen_from_action</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000409-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000409-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 54</span>
54:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">screen_from_action</span>(<span class="ruby-identifier">params</span>)
55:     <span class="ruby-constant">RowsController</span>.<span class="ruby-identifier">screen_from_action</span>(<span class="ruby-identifier">params</span>) <span class="ruby-operator">||</span> <span class="ruby-keyword kw">super</span>
56:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000423" class="method-detail">
        <a name="M000423"></a>

        <div class="method-heading">
          <a href="#M000423" class="method-signature">
          <span class="method-name">search</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000423-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000423-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 565</span>
565:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">search</span>
566:     <span class="ruby-identifier">action_source</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:action_source</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;search&quot;</span>
567:     <span class="ruby-identifier">screen_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>].<span class="ruby-identifier">to_i</span>
568:     <span class="ruby-identifier">custom_fields</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:custom_fields</span>] <span class="ruby-operator">||</span> {}
569:     <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
570:       <span class="ruby-identifier">custom_field</span> = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">key</span>})
571:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Calendar</span>)
572:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-identifier">:year</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
573:           <span class="ruby-identifier">value</span>.<span class="ruby-identifier">replace</span>({})
574:         <span class="ruby-keyword kw">else</span>
575:           <span class="ruby-identifier">null_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">null_date</span>
576:           <span class="ruby-identifier">selected_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:year</span>].<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">null_date</span>.<span class="ruby-identifier">month</span>, <span class="ruby-identifier">null_date</span>.<span class="ruby-identifier">day</span>)
577:           <span class="ruby-identifier">selected_date</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">DateTimeField</span>.<span class="ruby-identifier">begin_of_period</span>(<span class="ruby-identifier">selected_date</span>, <span class="ruby-identifier">:year</span>)
578:           <span class="ruby-identifier">new_hash</span> = {<span class="ruby-value str">'selected_date'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">selected_date</span>.<span class="ruby-identifier">to_date</span>.<span class="ruby-identifier">to_s</span>}
579:           <span class="ruby-identifier">value</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-identifier">new_hash</span>)
580:         <span class="ruby-keyword kw">end</span>
581:       <span class="ruby-keyword kw">end</span>
582:     <span class="ruby-keyword kw">end</span>
583:     <span class="ruby-ivar">@screen</span> = <span class="ruby-identifier">session</span>.<span class="ruby-identifier">active_screen</span>
584: 
585:     <span class="ruby-ivar">@filter_errors</span> = <span class="ruby-constant">Field</span>.<span class="ruby-identifier">validate_filters</span>(<span class="ruby-identifier">screen_id</span>, <span class="ruby-identifier">custom_fields</span>)
586: 
587:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@filter_errors</span>[<span class="ruby-identifier">:required</span>].<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@filter_errors</span>[<span class="ruby-identifier">:invalid</span>].<span class="ruby-identifier">empty?</span>
588:       <span class="ruby-identifier">options</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">filter</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>].<span class="ruby-identifier">to_i</span>,
589:         <span class="ruby-identifier">:custom_fields</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">custom_fields</span>,
590:         <span class="ruby-identifier">:action_source</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">action_source</span>,
591:         <span class="ruby-identifier">:include_other_user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:include_other_user</span>],
592:         <span class="ruby-identifier">:include_updated_at_filter</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:include_old_data</span>]
593:       )
594: 
595:       <span class="ruby-identifier">filtered_row_ids</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:filtered_row_ids</span>]
596:       <span class="ruby-identifier">row_pattern_id</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:row_pattern_id</span>]
597:       <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:sort_field_id_order</span>] = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:sort_field_id_order</span>]
598: 
599:       <span class="ruby-identifier">screen_id</span> = <span class="ruby-identifier">request_id</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">id</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">action_source</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;relations&quot;</span>
600:       
601:       <span class="ruby-constant">RowsController</span>.<span class="ruby-identifier">store_session_row_ids</span>(<span class="ruby-identifier">session</span>.<span class="ruby-identifier">session_id</span>, <span class="ruby-identifier">screen_id</span>, <span class="ruby-identifier">filtered_row_ids</span>)
602: 
603:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;index&quot;</span>,
604:         <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],
605:         <span class="ruby-identifier">:action_source</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">action_source</span>,
606:         <span class="ruby-identifier">:custom_fields</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">custom_fields</span>,
607:         <span class="ruby-identifier">:row_pattern_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">row_pattern_id</span>,
608:         <span class="ruby-identifier">:include_other_user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:include_other_user</span>],
609:         <span class="ruby-identifier">:request_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">request_id</span>
610:     <span class="ruby-keyword kw">else</span>
611:       <span class="ruby-ivar">@filter_errors</span>[<span class="ruby-identifier">:required</span>].<span class="ruby-identifier">to_a</span>
612:       <span class="ruby-ivar">@filter_errors</span>[<span class="ruby-identifier">:invalid</span>].<span class="ruby-identifier">to_a</span>
613: 
614:       <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
615:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># search.html.erb</span>
616:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@row</span> }
617:       <span class="ruby-keyword kw">end</span>
618:     <span class="ruby-keyword kw">end</span>
619:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000412" class="method-detail">
        <a name="M000412"></a>

        <div class="method-heading">
          <a href="#M000412" class="method-signature">
          <span class="method-name">show</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
GET /rows/1 GET /rows/1.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000412-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000412-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 205</span>
205:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show</span>
206:     <span class="ruby-ivar">@screen</span> = <span class="ruby-identifier">session</span>.<span class="ruby-identifier">active_screen</span>
207:     <span class="ruby-ivar">@row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
208: 
209:     <span class="ruby-ivar">@action_source</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:action_source</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;index&quot;</span>
210:     
211:     <span class="ruby-ivar">@readonly</span> = <span class="ruby-operator">!</span><span class="ruby-ivar">@screen</span>.<span class="ruby-identifier">screen</span>.<span class="ruby-identifier">allow_action?</span>(<span class="ruby-identifier">:edit</span>)
212: 
213:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
214:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># show.html.erb</span>
215:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@row</span> }
216:     <span class="ruby-keyword kw">end</span>
217:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000424" class="method-detail">
        <a name="M000424"></a>

        <div class="method-heading">
          <a href="#M000424" class="method-signature">
          <span class="method-name">special_search</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000424-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000424-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 621</span>
621:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">special_search</span>
622:     <span class="ruby-comment cmt"># ToDo: Defined which field/screen to use special search</span>
623:     <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Hard coded Screen name 'Customer'&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">RAILS_ENV</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/susbkk/</span>
624: 
625:     <span class="ruby-identifier">custom_fields</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:custom_fields</span>] <span class="ruby-operator">||</span> {}
626:     <span class="ruby-identifier">filtered_row_ids</span> = []
627:     <span class="ruby-identifier">custom_fields</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">screen_id</span>,<span class="ruby-identifier">cfs</span><span class="ruby-operator">|</span>
628:       <span class="ruby-identifier">screen</span> = <span class="ruby-constant">Screen</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">screen_id</span>.<span class="ruby-identifier">to_i</span>)
629:       <span class="ruby-identifier">filter_by_total_amount</span> = (<span class="ruby-identifier">screen</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Business Record&quot;</span>)
630:       <span class="ruby-identifier">filtered_row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">filter_by_special_search</span>(<span class="ruby-identifier">screen</span>,<span class="ruby-identifier">cfs</span>,<span class="ruby-identifier">filter_by_total_amount</span>)
631:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">filtered_row</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt">#nil when not have filtering</span>
632:         <span class="ruby-identifier">filtered_row_ids</span> = <span class="ruby-identifier">filtered_row_ids</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span><span class="ruby-identifier">filtered_row</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">filtered_row_ids</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">filtered_row</span>
633:       <span class="ruby-keyword kw">end</span>
634:     <span class="ruby-keyword kw">end</span>
635:     <span class="ruby-identifier">customer_screen</span> = <span class="ruby-constant">Screen</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;name = ?&quot;</span>, <span class="ruby-value str">&quot;Customer&quot;</span>])
636:     <span class="ruby-identifier">sort_session</span>(<span class="ruby-identifier">session</span>.<span class="ruby-identifier">session_id</span>, <span class="ruby-identifier">customer_screen</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">filtered_row_ids</span>)
637:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;index&quot;</span>,
638:       <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">customer_screen</span>.<span class="ruby-identifier">id</span>,
639:       <span class="ruby-identifier">:action_source</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;search&quot;</span>,
640:       <span class="ruby-identifier">:filtered_row_ids</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filtered_row_ids</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">4</span>],
641:       <span class="ruby-identifier">:include_other_user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
642: 
643:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000418" class="method-detail">
        <a name="M000418"></a>

        <div class="method-heading">
          <a href="#M000418" class="method-signature">
          <span class="method-name">update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
PUT /rows/1 PUT /rows/1.xml
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000418-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000418-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 384</span>
384:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>
385:     <span class="ruby-identifier">date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-value str">&quot;%Y%m%d&quot;</span>)
386:     <span class="ruby-identifier">time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-value str">&quot;%H:%M:%S&quot;</span>)
387:     <span class="ruby-ivar">@row</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
388:     <span class="ruby-ivar">@action_source</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:action_source</span>]
389:     <span class="ruby-identifier">screen</span> = <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">screen</span>
390: 
391:     <span class="ruby-identifier">fulllog_value</span> = {}
392:     <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">full_logs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fl</span><span class="ruby-operator">|</span>
393:       <span class="ruby-identifier">fulllog_value</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">fl</span>.<span class="ruby-identifier">value</span>)
394:     <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">full_logs</span>.<span class="ruby-identifier">nil?</span>
395: 
396:     <span class="ruby-identifier">last_log</span> = <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">full_logs</span>.<span class="ruby-identifier">last</span>
397:     <span class="ruby-identifier">log_seq_no</span> = <span class="ruby-identifier">last_log</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">last_log</span>.<span class="ruby-identifier">seq_no</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
398:     <span class="ruby-identifier">log_action</span> = <span class="ruby-identifier">last_log</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-operator">:</span><span class="ruby-identifier">created</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:modified</span>
399:     
400:     <span class="ruby-identifier">cells</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:cells</span>) <span class="ruby-operator">||</span> {}
401:     <span class="ruby-comment cmt"># Use for upload file field</span>
402:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value str">'original_path_file'</span>]
403:       <span class="ruby-identifier">file</span> = <span class="ruby-identifier">cells</span>[<span class="ruby-identifier">params</span>[<span class="ruby-value str">'custom_field_id_of_file'</span>]].<span class="ruby-identifier">to_s</span>
404:       <span class="ruby-identifier">cells</span>[<span class="ruby-identifier">params</span>[<span class="ruby-value str">'custom_field_id_of_file'</span>]] = (<span class="ruby-identifier">file</span>.<span class="ruby-identifier">empty?</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">params</span>[<span class="ruby-value str">'original_path_file'</span>] <span class="ruby-operator">:</span> <span class="ruby-constant">Upload</span>.<span class="ruby-identifier">file_save</span>(<span class="ruby-identifier">file</span>)
405:     <span class="ruby-keyword kw">end</span>
406: 
407:     <span class="ruby-comment cmt"># Check value in searchable field id null?</span>
408:     <span class="ruby-identifier">field_ids_of_searchable</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:field_ids_of_searchable</span>]
409:     <span class="ruby-identifier">field_ids_of_searchable</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f_id</span><span class="ruby-operator">|</span>
410:       <span class="ruby-identifier">cells</span>[<span class="ruby-node">&quot;#{f_id}&quot;</span>] = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;screen_quick_search_text_#{f_id}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>
411:     <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field_ids_of_searchable</span>
412:     
413:     <span class="ruby-comment cmt">#~ Create cells for new fields</span>
414:     <span class="ruby-identifier">custom_field_ids</span> = <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">field_id</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-identifier">field_id</span>.<span class="ruby-identifier">to_i</span> }
415:     <span class="ruby-identifier">current_custom_field_ids</span> = <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">field_id</span> }.<span class="ruby-identifier">uniq</span>
416:     <span class="ruby-identifier">new_custom_field_ids</span> = <span class="ruby-identifier">custom_field_ids</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">current_custom_field_ids</span>
417:     
418:     <span class="ruby-identifier">new_custom_field_ids</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cf_id</span><span class="ruby-operator">|</span>
419:       <span class="ruby-identifier">cell</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:field_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cf_id</span>, <span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>)
420:       <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">cells</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cell</span>
421:       <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">load_cell_hash</span>(<span class="ruby-identifier">cell</span>)
422:     <span class="ruby-keyword kw">end</span>
423: 
424:     <span class="ruby-comment cmt">#~ Update existing cells, and clear missing values</span>
425:     <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">screen</span>.<span class="ruby-identifier">fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
426:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">nil?</span>
427:         <span class="ruby-identifier">cell</span> = <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field_id</span>)
428:         <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span> = <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">cell</span>.<span class="ruby-identifier">custom_field_id</span>.<span class="ruby-identifier">to_s</span>)
429:         <span class="ruby-identifier">each_field_fulllog_value</span> = <span class="ruby-identifier">change_type_of_value</span>(<span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field</span>, <span class="ruby-identifier">cell</span>)
430:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">last_log</span>.<span class="ruby-identifier">nil?</span>
431:           <span class="ruby-identifier">fulllog_value</span>[<span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field_id</span>] = <span class="ruby-identifier">each_field_fulllog_value</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">each_field_fulllog_value</span>.<span class="ruby-identifier">nil?</span>
432:         <span class="ruby-keyword kw">else</span>
433:           <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">fulllog_value</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field_id</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">fulllog_value</span>[<span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field_id</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">each_field_fulllog_value</span>)
434:             <span class="ruby-identifier">fulllog_value</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field_id</span>)
435:           <span class="ruby-keyword kw">else</span>
436:             <span class="ruby-identifier">fulllog_value</span>.<span class="ruby-identifier">merge!</span>({<span class="ruby-identifier">f</span>.<span class="ruby-identifier">custom_field_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">each_field_fulllog_value</span>})
437:           <span class="ruby-keyword kw">end</span>
438:         <span class="ruby-keyword kw">end</span>
439:       <span class="ruby-keyword kw">end</span>
440:     <span class="ruby-keyword kw">end</span>
441:     <span class="ruby-identifier">date_time_range</span> = {}
442:     <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
443:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">field</span>
444:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Calendar</span>
445:         <span class="ruby-identifier">null_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">null_date</span>
446:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">monthly_format?</span>
447:           <span class="ruby-identifier">selected_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:year</span>].<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">null_date</span>.<span class="ruby-identifier">month</span>, <span class="ruby-identifier">null_date</span>.<span class="ruby-identifier">day</span>)
448:           <span class="ruby-identifier">selected_date</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">DateTimeField</span>.<span class="ruby-identifier">begin_of_period</span>(<span class="ruby-identifier">selected_date</span>, <span class="ruby-identifier">:year</span>)
449:           <span class="ruby-identifier">new_hash</span> = {<span class="ruby-identifier">:selected_date</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">selected_date</span>.<span class="ruby-identifier">to_date</span>.<span class="ruby-identifier">to_s</span>}
450:           <span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-identifier">new_hash</span>)
451:         <span class="ruby-keyword kw">end</span>
452:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">UploadImage</span>
453:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remove_image</span>].<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">field_id</span>.<span class="ruby-identifier">to_s</span>)
454:           <span class="ruby-keyword kw">begin</span>
455:             <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-node">&quot;#{RAILS_ROOT}/public/attachments/#{c.value}&quot;</span>)
456:           <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span>
457:             <span class="ruby-comment cmt"># Nothing to do</span>
458:           <span class="ruby-keyword kw">end</span>
459:           <span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span> = <span class="ruby-value str">&quot;&quot;</span>
460:         <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:remove_image</span>)
461:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">DateTimeRange</span>
462:         <span class="ruby-identifier">date_time_range</span> = {<span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:from</span>], <span class="ruby-identifier">:to</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:to</span>]}
463:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span> = <span class="ruby-keyword kw">nil</span>
464:       <span class="ruby-keyword kw">end</span>
465:     <span class="ruby-keyword kw">end</span>
466:    
467:     <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">remark</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:remark</span>)
468: 
469:     <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
470:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">save</span>
471:         <span class="ruby-comment cmt">#~ Save the cells</span>
472:         <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
473:           <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
474:         <span class="ruby-keyword kw">end</span>
475: 
476:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">fulllog_value</span>.<span class="ruby-identifier">empty?</span>
477:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">log_action</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:created</span>
478:             (<span class="ruby-identifier">save_full_log</span> <span class="ruby-identifier">log_action</span>, <span class="ruby-identifier">log_seq_no</span>, <span class="ruby-identifier">fulllog_value</span>, <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">created_at</span>)
479:           <span class="ruby-keyword kw">else</span>
480:             (<span class="ruby-identifier">save_full_log</span> <span class="ruby-identifier">log_action</span>, <span class="ruby-identifier">log_seq_no</span>, <span class="ruby-identifier">fulllog_value</span>)
481:           <span class="ruby-keyword kw">end</span>
482:         <span class="ruby-keyword kw">end</span>
483: 
484:         <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
485:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">field</span>
486:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Calendar</span>
487:             <span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
488:               <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">key</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/calendar_value_row/</span>).<span class="ruby-identifier">nil?</span>
489:                 <span class="ruby-identifier">detail_row_id</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">field</span>.<span class="ruby-identifier">get_row_id</span>(<span class="ruby-identifier">key</span>)
490:                 <span class="ruby-identifier">value</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field_id</span>,<span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
491:                   <span class="ruby-identifier">calendar_value_cell</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">:row_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">detail_row_id</span>, <span class="ruby-identifier">:field_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">field_id</span>})
492:                   <span class="ruby-identifier">calendar_value_cell</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">?
493: </span>                    <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">:row_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">detail_row_id</span>, <span class="ruby-identifier">:field_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">field_id</span> , <span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">val</span>) <span class="ruby-operator">:</span>
494:                     <span class="ruby-identifier">calendar_value_cell</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-identifier">:value</span>, <span class="ruby-identifier">val</span>)
495:                 <span class="ruby-keyword kw">end</span>
496:               <span class="ruby-keyword kw">end</span>
497:             <span class="ruby-keyword kw">end</span>
498:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Cells</span><span class="ruby-operator">::</span><span class="ruby-constant">CalendarValue</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:cell_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">id</span>}).<span class="ruby-identifier">nil?</span>
499:               <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Calendar</span>.<span class="ruby-identifier">create_detail_rows</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:selected_date</span>], <span class="ruby-identifier">c</span>.<span class="ruby-identifier">field</span>.<span class="ruby-identifier">detail_screen</span>.<span class="ruby-identifier">id</span>)
500:             <span class="ruby-keyword kw">end</span>
501:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">DateTimeRange</span>
502:             <span class="ruby-identifier">cell_date_time_range</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">date_time_range_values</span>.<span class="ruby-identifier">first</span>
503:             <span class="ruby-identifier">cell_date_time_range</span>.<span class="ruby-identifier">date_time_from</span> = <span class="ruby-identifier">date_time_range</span>[<span class="ruby-identifier">:from</span>]
504:             <span class="ruby-identifier">cell_date_time_range</span>.<span class="ruby-identifier">date_time_to</span> = <span class="ruby-identifier">date_time_range</span>[<span class="ruby-identifier">:to</span>]
505:             <span class="ruby-identifier">cell_date_time_range</span>.<span class="ruby-identifier">save</span>
506:           <span class="ruby-keyword kw">end</span>
507:         <span class="ruby-keyword kw">end</span>
508: 
509:         <span class="ruby-comment cmt"># ToDo: Save triggered like record</span>
510:         <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">set_customer_first_p_o</span>(<span class="ruby-identifier">screen</span>, <span class="ruby-ivar">@row</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">client_code</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/susbkk/</span>
511:       <span class="ruby-keyword kw">end</span>
512:     <span class="ruby-keyword kw">end</span>
513:     
514:     <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">reload_uncached_association</span>
515: 
516:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
517:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-comment cmt"># create.html.erb</span>
518:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@row</span> }
519:     <span class="ruby-keyword kw">end</span>
520:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000440" class="method-detail">
        <a name="M000440"></a>

        <div class="method-heading">
          <a href="#M000440" class="method-signature">
          <span class="method-name">update_cell_calendar</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000440-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000440-source">
<pre>
      <span class="ruby-comment cmt"># File app/controllers/rows_controller.rb, line 1008</span>
1008:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_cell_calendar</span>
1009:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value str">'detail_cell_value'</span>]
1010:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>