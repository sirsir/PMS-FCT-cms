<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Cell</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Cell</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/models/cell_rb.html">
                app/models/cell.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ActiveRecord/Base.html">
                ActiveRecord::Base
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000271">absolute_value</a>&nbsp;&nbsp;
      <a href="#M000280">combined_code</a>&nbsp;&nbsp;
      <a href="#M000274">empty?</a>&nbsp;&nbsp;
      <a href="#M000269">missing_msg</a>&nbsp;&nbsp;
      <a href="#M000281">regexp</a>&nbsp;&nbsp;
      <a href="#M000279">select_value_combined_codes</a>&nbsp;&nbsp;
      <a href="#M000278">select_value_combined_options</a>&nbsp;&nbsp;
      <a href="#M000275">select_value_options</a>&nbsp;&nbsp;
      <a href="#M000276">select_value_relation_options</a>&nbsp;&nbsp;
      <a href="#M000277">select_value_relation_options_by_id</a>&nbsp;&nbsp;
      <a href="#M000273">to_html</a>&nbsp;&nbsp;
      <a href="#M000272">to_text</a>&nbsp;&nbsp;
      <a href="#M000270">value</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000269" class="method-detail">
        <a name="M000269"></a>

        <div class="method-heading">
          <a href="#M000269" class="method-signature">
          <span class="method-name">missing_msg</span><span class="method-args">(row_id, custom_field_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000269-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000269-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/cell.rb, line 17</span>
17:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">missing_msg</span>(<span class="ruby-identifier">row_id</span>, <span class="ruby-identifier">custom_field_id</span>)
18:       <span class="ruby-node">&quot;&lt;span class='error_message'&gt;Cell with ROW_ID=#{row_id} x CUSTOM_FIELD_ID=#{custom_field_id} is missing!&lt;/span&gt;&quot;</span>
19:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000271" class="method-detail">
        <a name="M000271"></a>

        <div class="method-heading">
          <a href="#M000271" class="method-signature">
          <span class="method-name">absolute_value</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000271-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000271-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/cell.rb, line 26</span>
26:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">absolute_value</span>
27:     <span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">absolute_value</span>(<span class="ruby-identifier">value</span>)
28:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000280" class="method-detail">
        <a name="M000280"></a>

        <div class="method-heading">
          <a href="#M000280" class="method-signature">
          <span class="method-name">combined_code</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000280-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000280-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/cell.rb, line 310</span>
310:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">combined_code</span>
311:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">ScreenCombindedReference</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span>
312:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:code</span>]
313:     <span class="ruby-keyword kw">end</span>
314:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000274" class="method-detail">
        <a name="M000274"></a>

        <div class="method-heading">
          <a href="#M000274" class="method-signature">
          <span class="method-name">empty?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000274-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000274-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/cell.rb, line 43</span>
43:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">empty?</span>
44:     <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">is_empty?</span>(<span class="ruby-identifier">value</span>)
45:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000281" class="method-detail">
        <a name="M000281"></a>

        <div class="method-heading">
          <a href="#M000281" class="method-signature">
          <span class="method-name">regexp</span><span class="method-args">(index)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000281-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000281-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/cell.rb, line 316</span>
316:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">regexp</span>(<span class="ruby-identifier">index</span>)
317:     <span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">regexp</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">index</span>)
318:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000279" class="method-detail">
        <a name="M000279"></a>

        <div class="method-heading">
          <a href="#M000279" class="method-signature">
          <span class="method-name">select_value_combined_codes</span><span class="method-args">(ccr_field)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
select code_combined_reference, selected_value
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000279-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000279-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/cell.rb, line 239</span>
239:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select_value_combined_codes</span>(<span class="ruby-identifier">ccr_field</span>)
240:     <span class="ruby-identifier">selected_values</span> = []
241:     <span class="ruby-identifier">available_options</span> = []
242:     <span class="ruby-identifier">group_available_options</span> = []
243:     <span class="ruby-identifier">group_selected_values</span> = []
244:     <span class="ruby-identifier">selected_options</span> = []
245: 
246:     <span class="ruby-identifier">manual_text</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">CodeCombindedReference</span>.<span class="ruby-identifier">cell_text</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>)
247:     <span class="ruby-identifier">scr_field_id</span> = <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">ccr_field</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:field_id</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:field_id</span>]
248:     <span class="ruby-identifier">all_code_options</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;screen_id = ? &quot;</span>, <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">scr_field_id</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">screen_id</span>])
249:     
250:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">manual_text</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:scr_row_id</span>].<span class="ruby-identifier">nil?</span>
251:       <span class="ruby-identifier">selected_row</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:scr_row_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:scr_row_id</span>])
252:       <span class="ruby-identifier">selected_option_row</span> =  <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:ocr_row_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:ocr_row_id</span>])
253:       <span class="ruby-identifier">selected_opt_row_ids</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">CodeCombindedReference</span>.<span class="ruby-identifier">cell_opt_row_ids</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>)
254:       <span class="ruby-identifier">screens</span> = <span class="ruby-identifier">selected_row</span>.<span class="ruby-identifier">screen_combined_screens</span>()
255:       
256: <span class="ruby-comment cmt">#      unless self.value[:scr_row_id].nil?</span>
257: <span class="ruby-comment cmt">#        screens = selected_row.screen_combined_screen_group()</span>
258: <span class="ruby-comment cmt">#        selected_options = []</span>
259: <span class="ruby-comment cmt">#        screens.each_with_index do |screen, i|</span>
260: <span class="ruby-comment cmt">#          options = ccr_field.custom_field.options(selected_row, ccr_field, selected_options)</span>
261: <span class="ruby-comment cmt">#</span>
262: <span class="ruby-comment cmt">#          available_options[&quot;#{screen.id}_#{i}&quot;] = self.value[:selecteds][i][:row_id].nil? ? [] : options[:available_options]</span>
263: <span class="ruby-comment cmt">#          selected_values[&quot;#{screen.id}_#{i}&quot;] = self.value[:selecteds][i][:row_id].to_i</span>
264: <span class="ruby-comment cmt">#</span>
265: <span class="ruby-comment cmt">#          selected_options &lt;&lt; self.value[:selecteds][i][:row_id] unless self.value[:selecteds][i][:row_id].nil?</span>
266: <span class="ruby-comment cmt">#        end</span>
267: <span class="ruby-comment cmt">#      end</span>
268:  
269:       <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:scr_row_id</span>].<span class="ruby-identifier">nil?</span>
270:         <span class="ruby-identifier">selected</span> =  <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">CodeCombindedReference</span>.<span class="ruby-identifier">cell_selecteds</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>)
271:         <span class="ruby-identifier">selected</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span>,<span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
272:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
273:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:groups</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
274:               <span class="ruby-identifier">val</span>[<span class="ruby-identifier">:selecteds</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sel</span><span class="ruby-operator">|</span>
275:                 <span class="ruby-identifier">options</span> = <span class="ruby-identifier">ccr_field</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">options</span>(<span class="ruby-identifier">selected_row</span>, <span class="ruby-identifier">ccr_field</span>, <span class="ruby-identifier">selected_options</span>)
276:                 <span class="ruby-identifier">selected_options</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sel</span>[<span class="ruby-identifier">:row_id</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">sel</span>[<span class="ruby-identifier">:row_id</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">nil?</span>
277: 
278:                 <span class="ruby-identifier">selected_values</span> <span class="ruby-operator">&lt;&lt;</span>  <span class="ruby-identifier">sel</span>[<span class="ruby-identifier">:row_id</span>].<span class="ruby-identifier">to_i</span>
279:                 <span class="ruby-identifier">available_options</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:available_options</span>]
280:                 
281:               <span class="ruby-keyword kw">end</span> 
282:             <span class="ruby-keyword kw">end</span> 
283:           <span class="ruby-keyword kw">else</span>
284:             <span class="ruby-identifier">options</span> = <span class="ruby-identifier">ccr_field</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">options</span>(<span class="ruby-identifier">selected_row</span>, <span class="ruby-identifier">ccr_field</span>, <span class="ruby-identifier">selected_options</span>)
285:             
286:             <span class="ruby-identifier">selected_values</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:selecteds</span>][<span class="ruby-identifier">i</span>][<span class="ruby-identifier">:row_id</span>].<span class="ruby-identifier">to_i</span>)
287:             <span class="ruby-identifier">available_options</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:selecteds</span>][<span class="ruby-identifier">i</span>][<span class="ruby-identifier">:row_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span>[] <span class="ruby-operator">:</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:available_options</span>])
288: 
289:             <span class="ruby-identifier">selected_options</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:selecteds</span>][<span class="ruby-identifier">i</span>][<span class="ruby-identifier">:row_id</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>[<span class="ruby-identifier">:selecteds</span>][<span class="ruby-identifier">i</span>][<span class="ruby-identifier">:row_id</span>].<span class="ruby-identifier">nil?</span>
290:             
291:           <span class="ruby-keyword kw">end</span> 
292:         <span class="ruby-keyword kw">end</span>
293:       <span class="ruby-keyword kw">end</span>
294:       
295:     <span class="ruby-keyword kw">end</span>
296: 
297:     {
298:       <span class="ruby-identifier">:all_options=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">all_code_options</span>,
299:       <span class="ruby-identifier">:selected_row=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">selected_row</span>,
300:       <span class="ruby-identifier">:selected_option_row</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">selected_option_row</span>,
301:       <span class="ruby-identifier">:selected_option_row_ids</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">selected_opt_row_ids</span>,
302:       <span class="ruby-identifier">:screens=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">screens</span>,
303:       <span class="ruby-identifier">:selected_values=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">selected_values</span>,
304:       <span class="ruby-identifier">:available_options=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">available_options</span>,
305:       <span class="ruby-identifier">:selected_options=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">selected_options</span>,
306:       <span class="ruby-identifier">:text_value=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">CodeCombindedReference</span>.<span class="ruby-identifier">cell_text</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>)
307:     }
308:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000278" class="method-detail">
        <a name="M000278"></a>

        <div class="method-heading">
          <a href="#M000278" class="method-signature">
          <span class="method-name">select_value_combined_options</span><span class="method-args">(source_field_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
select option_combined_reference, selected_value
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000278-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000278-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/cell.rb, line 203</span>
203:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select_value_combined_options</span>(<span class="ruby-identifier">source_field_id</span>)
204:     <span class="ruby-identifier">all_options</span> = []
205:     <span class="ruby-identifier">scr_row_id</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">OptionCombindedReference</span>.<span class="ruby-identifier">cell_scr_row_id</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>)
206:     <span class="ruby-identifier">selected_options</span> = <span class="ruby-identifier">scr_row_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> [] <span class="ruby-operator">:</span> <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">scr_row_id</span>)
207:     <span class="ruby-identifier">selected_values</span> = {}
208:     <span class="ruby-identifier">selected_value_groups</span> = {}
209: 
210:     <span class="ruby-identifier">source_field</span> = <span class="ruby-constant">Field</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">source_field_id</span>.<span class="ruby-identifier">to_i</span>)
211:     <span class="ruby-identifier">rows</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;screen_id = ? &quot;</span>, <span class="ruby-identifier">source_field</span>.<span class="ruby-identifier">screen_id</span>])
212: 
213:     <span class="ruby-identifier">all_options</span> = <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">sort</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">screen_combined_code</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">screen_combined_code</span> }
214:     <span class="ruby-identifier">options</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">OptionCombindedReference</span>.<span class="ruby-identifier">cell_options</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>).<span class="ruby-identifier">flatten</span>
215:     <span class="ruby-identifier">group_options</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">OptionCombindedReference</span>.<span class="ruby-identifier">cell_groups</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>).<span class="ruby-identifier">flatten</span>
216:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">empty?</span>
217:       <span class="ruby-identifier">options</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">option</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
218:         <span class="ruby-identifier">selected_values</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">option</span>[<span class="ruby-identifier">:row_ids</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span>[] <span class="ruby-operator">:</span> <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:rows</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">option</span>[<span class="ruby-identifier">:row_ids</span>] } } )
219:       <span class="ruby-keyword kw">end</span>
220:     <span class="ruby-keyword kw">end</span>
221:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">group_options</span>.<span class="ruby-identifier">nil?</span>
222:       <span class="ruby-identifier">group_options</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group_option</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
223:         <span class="ruby-identifier">selected_value_groups</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">||=</span> []
224:         <span class="ruby-identifier">group_option</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span>, <span class="ruby-identifier">j</span><span class="ruby-operator">|</span>
225:           <span class="ruby-identifier">selected_value_groups</span>[<span class="ruby-identifier">i</span>][<span class="ruby-identifier">j</span>] = (<span class="ruby-identifier">o</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span>[] <span class="ruby-operator">:</span> <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:rows</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">o</span>[<span class="ruby-value">1</span>][<span class="ruby-identifier">:row_ids</span>]}} ))
226:         <span class="ruby-keyword kw">end</span>
227:       <span class="ruby-keyword kw">end</span>
228:     <span class="ruby-keyword kw">end</span>
229: 
230:     {
231:       <span class="ruby-identifier">:all_options=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">all_options</span> ,
232:       <span class="ruby-identifier">:assigned_options=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">selected_options</span>,
233:       <span class="ruby-identifier">:assigned_group_options=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">selected_value_groups</span>,
234:       <span class="ruby-identifier">:selected_values=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">selected_values</span>
235:     }
236:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000275" class="method-detail">
        <a name="M000275"></a>

        <div class="method-heading">
          <a href="#M000275" class="method-signature">
          <span class="method-name">select_value_options</span><span class="method-args">(relate_from=0, related_from_row_id=0)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000275-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000275-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/cell.rb, line 47</span>
 47:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select_value_options</span>(<span class="ruby-identifier">relate_from</span>=<span class="ruby-value">0</span>, <span class="ruby-identifier">related_from_row_id</span>=<span class="ruby-value">0</span>)
 48:     <span class="ruby-comment cmt">#Get selected rows</span>
 49:     <span class="ruby-keyword kw">case</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">custom_field</span>
 50:     <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span> <span class="ruby-keyword kw">then</span>
 51:       <span class="ruby-identifier">row_ids</span> = [<span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>.<span class="ruby-identifier">cell_ref_row_id</span>(<span class="ruby-identifier">value</span>)]
 52:     <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">LeftRight</span> <span class="ruby-keyword kw">then</span>
 53:       <span class="ruby-identifier">row_ids</span> = <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">LeftRight</span>.<span class="ruby-identifier">cell_ref_row_ids</span>(<span class="ruby-identifier">value</span>)
 54:     <span class="ruby-keyword kw">end</span>
 55:     
 56:     <span class="ruby-identifier">row_ids</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">0</span>)
 57: 
 58:     <span class="ruby-identifier">selected_options</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">row_ids</span> <span class="ruby-operator">||</span> [])
 59:     
 60:     <span class="ruby-comment cmt">#Get all option</span>
 61:     <span class="ruby-identifier">screen</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">screen</span>
 62:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">related_from_row_id</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">relate_from</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">then</span>
 63:       <span class="ruby-identifier">filter_row_ids</span> = []
 64:       <span class="ruby-identifier">related_cells</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
 65:           <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:row</span>],
 66:           <span class="ruby-identifier">:conditions</span>  =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot; rows.screen_id = ? and cells.field_id in (?) &quot;</span>,  <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">id</span> , <span class="ruby-identifier">relate_from</span>])
 67:       <span class="ruby-identifier">filter_cells</span> = <span class="ruby-identifier">related_cells</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>.<span class="ruby-identifier">cell_ref_row_id</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">related_from_row_id</span>}.<span class="ruby-identifier">compact</span>
 68:       <span class="ruby-identifier">filter_cells</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">filter_row_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">row_id</span>}
 69: 
 70:       <span class="ruby-identifier">all_options</span> = <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
 71:           <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:cells</span>],
 72:           <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {
 73:             <span class="ruby-identifier">:rows</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filter_row_ids</span> }
 74:           }
 75:         )
 76:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">related_from_row_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">relate_from</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">then</span>
 77:       <span class="ruby-identifier">all_options</span> = []
 78:     <span class="ruby-keyword kw">else</span>
 79:       <span class="ruby-identifier">all_options</span> = <span class="ruby-identifier">screen</span>.<span class="ruby-identifier">rows</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
 80:           <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:cells</span>]
 81:         )
 82:     <span class="ruby-keyword kw">end</span>
 83:     
 84:     <span class="ruby-identifier">relate_from</span> = <span class="ruby-identifier">relate_from</span>.<span class="ruby-identifier">to_i</span>
 85: 
 86:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">relate_from</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
 87:       <span class="ruby-identifier">field</span> = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">relate_from</span>)
 88: 
 89:       <span class="ruby-identifier">ref_cell</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,
 90:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {
 91:             <span class="ruby-identifier">:cells</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:row_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">row_id</span>, <span class="ruby-identifier">:field_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">custom_field_id</span>}
 92:         }
 93:       )
 94: 
 95:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ref_cell</span>.<span class="ruby-identifier">nil?</span>
 96:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">custom_field</span>
 97:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span> <span class="ruby-keyword kw">then</span>
 98:           <span class="ruby-identifier">my_ref_row_ids</span> = [<span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>.<span class="ruby-identifier">cell_ref_row_id</span>(<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">:value</span>])]
 99:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">LeftRight</span> <span class="ruby-keyword kw">then</span>
100:           <span class="ruby-comment cmt">#~ If it supported?</span>
101:           <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Missing implementation&quot;</span>
102:         <span class="ruby-keyword kw">end</span>
103:         
104:         <span class="ruby-identifier">all_options</span>.<span class="ruby-identifier">collect!</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
105:           <span class="ruby-identifier">cell</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">field</span>.<span class="ruby-identifier">custom_field_id</span>)
106:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">custom_field</span>
107:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span> <span class="ruby-keyword kw">then</span>
108:             <span class="ruby-identifier">opt_ref_row_ids</span> = [<span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>.<span class="ruby-identifier">cell_ref_row_id</span>(<span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span>)]
109:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">LeftRight</span> <span class="ruby-keyword kw">then</span>
110:             <span class="ruby-comment cmt">#~ If it supported?</span>
111:             <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Missing implementation&quot;</span>
112:           <span class="ruby-keyword kw">end</span>
113:           
114:           <span class="ruby-identifier">r</span> <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">my_ref_row_ids</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">opt_ref_row_ids</span>).<span class="ruby-identifier">empty?</span>
115:         <span class="ruby-keyword kw">end</span>
116:         
117:         <span class="ruby-identifier">all_options</span>.<span class="ruby-identifier">compact!</span>
118:       <span class="ruby-keyword kw">end</span>
119:     <span class="ruby-keyword kw">end</span>
120:     
121:     <span class="ruby-comment cmt"># ToDo: Trim the rows, and re-design to prevent so much rows being returned</span>
122:     <span class="ruby-comment cmt">#return value</span>
123:     {
124:       <span class="ruby-identifier">:all_options</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">all_options</span>.<span class="ruby-identifier">sort</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">description</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">description</span> }[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">199</span>],
125:       <span class="ruby-identifier">:assigned_options</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">selected_options</span>.<span class="ruby-identifier">sort</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">description</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">description</span> }
126:     }
127:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000276" class="method-detail">
        <a name="M000276"></a>

        <div class="method-heading">
          <a href="#M000276" class="method-signature">
          <span class="method-name">select_value_relation_options</span><span class="method-args">(relate_from, r_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000276-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000276-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/cell.rb, line 129</span>
129:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select_value_relation_options</span>(<span class="ruby-identifier">relate_from</span>, <span class="ruby-identifier">r_id</span>)
130:     <span class="ruby-identifier">all_options</span> = []
131:     <span class="ruby-identifier">selected_options</span> = []
132:     <span class="ruby-identifier">selected_row</span> = []
133:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r_id</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span>
134:       <span class="ruby-identifier">ref_value</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;row_id = ? and field_id = ?&quot;</span>,<span class="ruby-identifier">r_id</span>,<span class="ruby-identifier">relate_from</span>])
135:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ref_value</span>.<span class="ruby-identifier">nil?</span>
136:         <span class="ruby-identifier">row_filter_id</span> = []
137:         <span class="ruby-identifier">cf</span> = <span class="ruby-constant">CustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">field_id</span>.<span class="ruby-identifier">to_i</span>)
138:         <span class="ruby-identifier">cells</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(  <span class="ruby-identifier">:all</span>,
139:           <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:row</span>],
140:           <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'rows.screen_id = ? and cells.value like ? and cells.field_id = ?'</span>,<span class="ruby-identifier">cf</span>.<span class="ruby-identifier">screen_id</span>,<span class="ruby-identifier">ref_value</span>.<span class="ruby-identifier">value</span>,<span class="ruby-identifier">relate_from</span>])
141:         <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">row_filter_id</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">row_id</span>}
142:         <span class="ruby-identifier">cells</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(  <span class="ruby-identifier">:all</span>,
143:           <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'row_id in (?) and field_id = ?'</span>,<span class="ruby-identifier">row_filter_id</span>,<span class="ruby-identifier">cf</span>.<span class="ruby-identifier">custom_field_ids</span>[<span class="ruby-value">0</span>]],
144:           <span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;value&quot;</span>)
145:         <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">all_options</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c</span>}
146: 
147:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span>
148:           <span class="ruby-identifier">selected_row</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_i</span>)
149:           <span class="ruby-identifier">selected_row</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
150:             <span class="ruby-identifier">selected_options</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;row_id = ? and field_id = ?&quot;</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">cf</span>.<span class="ruby-identifier">custom_field_ids</span>[<span class="ruby-value">0</span>]).<span class="ruby-identifier">row_id</span> , <span class="ruby-identifier">cf</span>.<span class="ruby-identifier">custom_field_ids</span>[<span class="ruby-value">0</span>]])
151:           <span class="ruby-keyword kw">end</span>
152:         <span class="ruby-keyword kw">end</span>
153:       <span class="ruby-keyword kw">end</span>
154:     <span class="ruby-keyword kw">end</span>
155: 
156:     <span class="ruby-comment cmt">#return value</span>
157:     {
158:       <span class="ruby-identifier">:all_options</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">all_options</span>.<span class="ruby-identifier">sort</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value</span> },
159:       <span class="ruby-identifier">:assigned_options</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">selected_options</span>.<span class="ruby-identifier">sort</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value</span> }
160:     }
161:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000277" class="method-detail">
        <a name="M000277"></a>

        <div class="method-heading">
          <a href="#M000277" class="method-signature">
          <span class="method-name">select_value_relation_options_by_id</span><span class="method-args">(relate_from, r_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000277-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000277-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/cell.rb, line 163</span>
163:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select_value_relation_options_by_id</span>(<span class="ruby-identifier">relate_from</span>, <span class="ruby-identifier">r_id</span>)
164:     <span class="ruby-identifier">all_options</span> = []
165:     <span class="ruby-identifier">selected_options</span> = []
166:     <span class="ruby-identifier">selected_row</span> = []
167: 
168:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">r_id</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">empty?</span>
169:       <span class="ruby-comment cmt"># Will the code ever be reached?</span>
170:       <span class="ruby-comment cmt"># Currently haven't found a path that call the select_value_relation_options_by_id function</span>
171:       <span class="ruby-comment cmt"># while the r_id is set...</span>
172:       <span class="ruby-identifier">cells</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
173:         <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:row</span>],
174:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {
175:           <span class="ruby-identifier">:rows</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:screen</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">screen_id</span> },
176:           <span class="ruby-identifier">:cells</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:field_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">relate_from</span>}
177:         }
178:       )
179:       <span class="ruby-identifier">row_filter_id</span> = <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">row_id</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>.<span class="ruby-identifier">cell_ref_row_id</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">value</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">r_id</span> }.<span class="ruby-identifier">compact</span>
180:       
181:       <span class="ruby-identifier">cells</span> = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
182:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'row_id in (?) and field_id = ?'</span>, <span class="ruby-identifier">row_filter_id</span>, <span class="ruby-identifier">cf</span>.<span class="ruby-identifier">custom_field_ids</span>[<span class="ruby-value">0</span>]],
183:         <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;value&quot;</span>
184:       )
185:       <span class="ruby-identifier">all_options</span> = <span class="ruby-identifier">cells</span>
186: 
187:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span>
188:         <span class="ruby-identifier">selected_row</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Row</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_i</span>)
189:         <span class="ruby-identifier">selected_row</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
190:           <span class="ruby-identifier">selected_options</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;row_id = ? and field_id = ?&quot;</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">cell</span>(<span class="ruby-identifier">cf</span>.<span class="ruby-identifier">custom_field_ids</span>[<span class="ruby-value">0</span>]).<span class="ruby-identifier">row_id</span> , <span class="ruby-identifier">cf</span>.<span class="ruby-identifier">custom_field_ids</span>[<span class="ruby-value">0</span>]])
191:         <span class="ruby-keyword kw">end</span>
192:       <span class="ruby-keyword kw">end</span>
193:     <span class="ruby-keyword kw">end</span>
194: 
195:     <span class="ruby-comment cmt">#return value</span>
196:     {
197:       <span class="ruby-identifier">:all_options</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">all_options</span>.<span class="ruby-identifier">sort</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value</span> },
198:       <span class="ruby-identifier">:assigned_options</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">selected_options</span>.<span class="ruby-identifier">sort</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value</span> }
199:     }
200:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000273" class="method-detail">
        <a name="M000273"></a>

        <div class="method-heading">
          <a href="#M000273" class="method-signature">
          <span class="method-name">to_html</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000273-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000273-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/cell.rb, line 34</span>
34:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_html</span>
35:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">custom_field</span>
36:     <span class="ruby-keyword kw">when</span> <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">Calendar</span>, <span class="ruby-constant">CustomFields</span><span class="ruby-operator">::</span><span class="ruby-constant">DateTimeRange</span>
37:       <span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">html</span>(<span class="ruby-keyword kw">self</span>)
38:     <span class="ruby-keyword kw">else</span>
39:       <span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">html</span>(<span class="ruby-identifier">value</span>)
40:     <span class="ruby-keyword kw">end</span>
41:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000272" class="method-detail">
        <a name="M000272"></a>

        <div class="method-heading">
          <a href="#M000272" class="method-signature">
          <span class="method-name">to_text</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000272-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000272-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/cell.rb, line 30</span>
30:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_text</span>
31:     <span class="ruby-identifier">custom_field</span>.<span class="ruby-identifier">text</span>(<span class="ruby-identifier">value</span>)
32:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000270" class="method-detail">
        <a name="M000270"></a>

        <div class="method-heading">
          <a href="#M000270" class="method-signature">
          <span class="method-name">value</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000270-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000270-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/cell.rb, line 22</span>
22:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">value</span>
23:     (<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">:value</span>].<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">:value</span>]
24:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>